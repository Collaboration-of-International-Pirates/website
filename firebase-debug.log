[debug] [2024-01-04T22:35:46.446Z] ----------------------------------------------------------------------
[debug] [2024-01-04T22:35:46.448Z] Command:       /usr/local/bin/firebase /home/lucy/.cache/firebase/tools/lib/node_modules/firebase-tools/lib/bin/firebase emulators:start
[debug] [2024-01-04T22:35:46.448Z] CLI Version:   13.0.2
[debug] [2024-01-04T22:35:46.448Z] Platform:      linux
[debug] [2024-01-04T22:35:46.448Z] Node Version:  v18.5.0
[debug] [2024-01-04T22:35:46.449Z] Time:          Thu Jan 04 2024 22:35:46 GMT+0000 (Greenwich Mean Time)
[debug] [2024-01-04T22:35:46.449Z] ----------------------------------------------------------------------
[debug] 
[debug] [2024-01-04T22:35:46.532Z] > command requires scopes: ["email","openid","https://www.googleapis.com/auth/cloudplatformprojects.readonly","https://www.googleapis.com/auth/firebase","https://www.googleapis.com/auth/cloud-platform"]
[debug] [2024-01-04T22:35:46.533Z] > authorizing via signed-in user (maberwilliam@gmail.com)
[debug] [2024-01-04T22:35:46.567Z] openjdk version "17.0.9" 2023-10-17

[debug] [2024-01-04T22:35:46.568Z] OpenJDK Runtime Environment (build 17.0.9+9-Ubuntu-123.10)
OpenJDK 64-Bit Server VM (build 17.0.9+9-Ubuntu-123.10, mixed mode, sharing)

[debug] [2024-01-04T22:35:46.572Z] Parsed Java major version: 17
[info] i  emulators: Starting emulators: auth, functions, firestore, hosting, storage, eventarc, extensions {"metadata":{"emulator":{"name":"hub"},"message":"Starting emulators: auth, functions, firestore, hosting, storage, eventarc, extensions"}}
[debug] [2024-01-04T22:35:46.575Z] >>> [apiv2][query] GET https://firebase.googleapis.com/v1beta1/projects/ptate-df901 [none]
[debug] [2024-01-04T22:35:46.806Z] <<< [apiv2][status] GET https://firebase.googleapis.com/v1beta1/projects/ptate-df901 200
[debug] [2024-01-04T22:35:46.806Z] <<< [apiv2][body] GET https://firebase.googleapis.com/v1beta1/projects/ptate-df901 {"projectId":"ptate-df901","projectNumber":"795297920122","displayName":"pirate party","name":"projects/ptate-df901","resources":{"hostingSite":"ptate-df901","storageBucket":"ptate-df901.appspot.com","locationId":"us-central"},"state":"ACTIVE","etag":"1_d0172919-a97c-4a4b-9caa-1f6911ef4383"}
[warn] ⚠  hosting: The hosting emulator is configured but there is no hosting configuration. Have you run firebase init hosting? {"metadata":{"emulator":{"name":"hosting"},"message":"The hosting emulator is configured but there is no hosting configuration. Have you run \u001b[1mfirebase init hosting\u001b[22m?"}}
[debug] [2024-01-04T22:35:46.821Z] [logging] Logging Emulator only supports listening on one address (127.0.0.1). Not listening on ::1
[debug] [2024-01-04T22:35:46.821Z] [auth] Authentication Emulator only supports listening on one address (127.0.0.1). Not listening on ::1
[debug] [2024-01-04T22:35:46.821Z] [firestore] Firestore Emulator only supports listening on one address (127.0.0.1). Not listening on ::1
[debug] [2024-01-04T22:35:46.821Z] [firestore.websocket] websocket server for firestore only supports listening on one address (127.0.0.1). Not listening on ::1
[debug] [2024-01-04T22:35:46.822Z] [storage] Storage Emulator only supports listening on one address (127.0.0.1). Not listening on ::1
[debug] [2024-01-04T22:35:46.822Z] assigned listening specs for emulators {"user":{"hub":[{"address":"127.0.0.1","family":"IPv4","port":4400},{"address":"::1","family":"IPv6","port":4400}],"ui":[{"address":"127.0.0.1","family":"IPv4","port":4000},{"address":"::1","family":"IPv6","port":4000}],"logging":[{"address":"127.0.0.1","family":"IPv4","port":4500}],"auth":[{"address":"127.0.0.1","family":"IPv4","port":9099}],"firestore":[{"address":"127.0.0.1","family":"IPv4","port":8081}],"firestore.websocket":[{"address":"127.0.0.1","family":"IPv4","port":9150}],"storage":[{"address":"127.0.0.1","family":"IPv4","port":9199}]},"metadata":{"message":"assigned listening specs for emulators"}}
[debug] [2024-01-04T22:35:46.831Z] [hub] writing locator at /tmp/hub-ptate-df901.json
[debug] [2024-01-04T22:35:46.836Z] [Extensions] Started Extensions emulator, this is a noop.
[debug] [2024-01-04T22:35:46.837Z] [functions] Functions Emulator only supports listening on one address (127.0.0.1). Not listening on ::1
[debug] [2024-01-04T22:35:46.837Z] [eventarc] Eventarc Emulator only supports listening on one address (127.0.0.1). Not listening on ::1
[debug] [2024-01-04T22:35:46.837Z] late-assigned ports for functions and eventarc emulators {"user":{"hub":[{"address":"127.0.0.1","family":"IPv4","port":4400},{"address":"::1","family":"IPv6","port":4400}],"ui":[{"address":"127.0.0.1","family":"IPv4","port":4000},{"address":"::1","family":"IPv6","port":4000}],"logging":[{"address":"127.0.0.1","family":"IPv4","port":4500}],"auth":[{"address":"127.0.0.1","family":"IPv4","port":9099}],"firestore":[{"address":"127.0.0.1","family":"IPv4","port":8081}],"firestore.websocket":[{"address":"127.0.0.1","family":"IPv4","port":9150}],"storage":[{"address":"127.0.0.1","family":"IPv4","port":9199}],"functions":[{"address":"127.0.0.1","family":"IPv4","port":5001}],"eventarc":[{"address":"127.0.0.1","family":"IPv4","port":9299}]},"metadata":{"message":"late-assigned ports for functions and eventarc emulators"}}
[warn] ⚠  functions: The following emulators are not running, calls to these services from the Functions emulator will affect production: database, hosting, pubsub {"metadata":{"emulator":{"name":"functions"},"message":"The following emulators are not running, calls to these services from the Functions emulator will affect production: \u001b[1mdatabase, hosting, pubsub\u001b[22m"}}
[debug] [2024-01-04T22:35:46.839Z] defaultcredentials: writing to file /home/lucy/.config/firebase/maberwilliam_gmail_com_application_default_credentials.json
[debug] [2024-01-04T22:35:46.840Z] Setting GAC to /home/lucy/.config/firebase/maberwilliam_gmail_com_application_default_credentials.json {"metadata":{"emulator":{"name":"functions"},"message":"Setting GAC to /home/lucy/.config/firebase/maberwilliam_gmail_com_application_default_credentials.json"}}
[debug] [2024-01-04T22:35:46.841Z] >>> [apiv2][query] GET https://firebase.googleapis.com/v1beta1/projects/ptate-df901/adminSdkConfig [none]
[debug] [2024-01-04T22:35:47.385Z] <<< [apiv2][status] GET https://firebase.googleapis.com/v1beta1/projects/ptate-df901/adminSdkConfig 200
[debug] [2024-01-04T22:35:47.385Z] <<< [apiv2][body] GET https://firebase.googleapis.com/v1beta1/projects/ptate-df901/adminSdkConfig {"projectId":"ptate-df901","storageBucket":"ptate-df901.appspot.com","locationId":"us-central"}
[debug] [2024-01-04T22:35:47.433Z] Ignoring unsupported arg: auto_download {"metadata":{"emulator":{"name":"firestore"},"message":"Ignoring unsupported arg: auto_download"}}
[debug] [2024-01-04T22:35:47.433Z] Ignoring unsupported arg: single_project_mode_error {"metadata":{"emulator":{"name":"firestore"},"message":"Ignoring unsupported arg: single_project_mode_error"}}
[debug] [2024-01-04T22:35:47.434Z] Starting Firestore Emulator with command {"binary":"java","args":["-Dgoogle.cloud_firestore.debug_log_level=FINE","-Duser.language=en","-jar","/home/lucy/.cache/firebase/emulators/cloud-firestore-emulator-v1.18.2.jar","--host","127.0.0.1","--port",8081,"--websocket_port",9150,"--project_id","ptate-df901","--rules","/home/lucy/Code/Priaite_Party_UK/website/firestore.rules","--single_project_mode",true,"--functions_emulator","127.0.0.1:5001"],"optionalArgs":["port","webchannel_port","host","rules","websocket_port","functions_emulator","seed_from_export","project_id","single_project_mode"],"joinArgs":false} {"metadata":{"emulator":{"name":"firestore"},"message":"Starting Firestore Emulator with command {\"binary\":\"java\",\"args\":[\"-Dgoogle.cloud_firestore.debug_log_level=FINE\",\"-Duser.language=en\",\"-jar\",\"/home/lucy/.cache/firebase/emulators/cloud-firestore-emulator-v1.18.2.jar\",\"--host\",\"127.0.0.1\",\"--port\",8081,\"--websocket_port\",9150,\"--project_id\",\"ptate-df901\",\"--rules\",\"/home/lucy/Code/Priaite_Party_UK/website/firestore.rules\",\"--single_project_mode\",true,\"--functions_emulator\",\"127.0.0.1:5001\"],\"optionalArgs\":[\"port\",\"webchannel_port\",\"host\",\"rules\",\"websocket_port\",\"functions_emulator\",\"seed_from_export\",\"project_id\",\"single_project_mode\"],\"joinArgs\":false}"}}
[info] i  firestore: Firestore Emulator logging to firestore-debug.log {"metadata":{"emulator":{"name":"firestore"},"message":"Firestore Emulator logging to \u001b[1mfirestore-debug.log\u001b[22m"}}
[debug] [2024-01-04T22:35:48.217Z] Jan 04, 2024 10:35:48 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketServer start
INFO: Started WebSocket server on ws://127.0.0.1:9150
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:35:48 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketServer start\nINFO: Started WebSocket server on ws://127.0.0.1:9150\n"}}
[debug] [2024-01-04T22:35:48.230Z] API endpoint: http://127.0.0.1:8081
 {"metadata":{"emulator":{"name":"firestore"},"message":"API endpoint: http://127.0.0.1:8081\n"}}
[debug] [2024-01-04T22:35:48.231Z] If you are using a library that supports the FIRESTORE_EMULATOR_HOST environment variable, run:

   export FIRESTORE_EMULATOR_HOST=127.0.0.1:8081

Dev App Server is now running.

 {"metadata":{"emulator":{"name":"firestore"},"message":"If you are using a library that supports the FIRESTORE_EMULATOR_HOST environment variable, run:\n\n   export FIRESTORE_EMULATOR_HOST=127.0.0.1:8081\n\nDev App Server is now running.\n\n"}}
[info] ✔  firestore: Firestore Emulator UI websocket is running on 9150. {"metadata":{"emulator":{"name":"firestore"},"message":"Firestore Emulator UI websocket is running on 9150."}}
[debug] [2024-01-04T22:35:54.996Z] Ignoring unsupported arg: port {"metadata":{"emulator":{"name":"storage"},"message":"Ignoring unsupported arg: port"}}
[debug] [2024-01-04T22:35:55.995Z] Temp file directory for storage emulator: /tmp/firebase/storage/blobs {"metadata":{"emulator":{"name":"storage"},"message":"Temp file directory for storage emulator: /tmp/firebase/storage/blobs"}}
[debug] [2024-01-04T22:35:56.009Z] Ignoring unsupported arg: auto_download {"metadata":{"emulator":{"name":"ui"},"message":"Ignoring unsupported arg: auto_download"}}
[debug] [2024-01-04T22:35:56.009Z] Ignoring unsupported arg: port {"metadata":{"emulator":{"name":"ui"},"message":"Ignoring unsupported arg: port"}}
[debug] [2024-01-04T22:35:56.009Z] Starting Emulator UI with command {"binary":"node","args":["/home/lucy/.cache/firebase/emulators/ui-v1.11.7/server/server.js"],"optionalArgs":[],"joinArgs":false} {"metadata":{"emulator":{"name":"ui"},"message":"Starting Emulator UI with command {\"binary\":\"node\",\"args\":[\"/home/lucy/.cache/firebase/emulators/ui-v1.11.7/server/server.js\"],\"optionalArgs\":[],\"joinArgs\":false}"}}
[info] i  ui: Emulator UI logging to ui-debug.log {"metadata":{"emulator":{"name":"ui"},"message":"Emulator UI logging to \u001b[1mui-debug.log\u001b[22m"}}
[debug] [2024-01-04T22:35:56.175Z] Web / API server started at 127.0.0.1:4000
 {"metadata":{"emulator":{"name":"ui"},"message":"Web / API server started at 127.0.0.1:4000\n"}}
[debug] [2024-01-04T22:35:56.176Z] Web / API server started at ::1:4000
 {"metadata":{"emulator":{"name":"ui"},"message":"Web / API server started at ::1:4000\n"}}
[debug] [2024-01-04T22:35:56.278Z] [Extensions] Connecting Extensions emulator, this is a noop.
[info] i  functions: Watching "/home/lucy/Code/Priaite_Party_UK/website/functions" for Cloud Functions... {"metadata":{"emulator":{"name":"functions"},"message":"Watching \"/home/lucy/Code/Priaite_Party_UK/website/functions\" for Cloud Functions..."}}
[debug] [2024-01-04T22:35:56.289Z] Customer code is not Node
[debug] [2024-01-04T22:35:56.291Z] Customer code is not Python code.
[error] ⬢  functions: Failed to load function definition from source: FirebaseError: Could not detect language for functions at /home/lucy/Code/Priaite_Party_UK/website/functions {"metadata":{"emulator":{"name":"functions"},"message":"Failed to load function definition from source: FirebaseError: Could not detect language for functions at /home/lucy/Code/Priaite_Party_UK/website/functions"}}
[info] i  functions: Watching "/home/lucy/Code/Priaite_Party_UK/website/ppuk" for Cloud Functions... {"metadata":{"emulator":{"name":"functions"},"message":"Watching \"/home/lucy/Code/Priaite_Party_UK/website/ppuk\" for Cloud Functions..."}}
[debug] [2024-01-04T22:35:56.296Z] Validating nodejs source
[warn] ⚠  functions: Couldn't find firebase-functions package in your source code. Have you run 'npm install'? 
[debug] [2024-01-04T22:35:56.300Z] getFunctionsSDKVersion encountered error: Cannot find module 'firebase-functions'
Require stack:
- /home/lucy/.cache/firebase/tools/lib/node_modules/firebase-tools/lib/deploy/functions/runtimes/node/versioning.js
- /home/lucy/.cache/firebase/tools/lib/node_modules/firebase-tools/lib/deploy/functions/runtimes/node/index.js
- /home/lucy/.cache/firebase/tools/lib/node_modules/firebase-tools/lib/deploy/functions/runtimes/index.js
- /home/lucy/.cache/firebase/tools/lib/node_modules/firebase-tools/lib/gcp/cloudfunctions.js
- /home/lucy/.cache/firebase/tools/lib/node_modules/firebase-tools/lib/deploy/functions/backend.js
- /home/lucy/.cache/firebase/tools/lib/node_modules/firebase-tools/lib/emulator/functionsEmulatorShared.js
- /home/lucy/.cache/firebase/tools/lib/node_modules/firebase-tools/lib/emulator/functionsEmulator.js
- /home/lucy/.cache/firebase/tools/lib/node_modules/firebase-tools/lib/emulator/controller.js
- /home/lucy/.cache/firebase/tools/lib/node_modules/firebase-tools/lib/emulator/commandUtils.js
- /home/lucy/.cache/firebase/tools/lib/node_modules/firebase-tools/lib/commands/database-get.js
- /home/lucy/.cache/firebase/tools/lib/node_modules/firebase-tools/lib/commands/index.js
- /home/lucy/.cache/firebase/tools/lib/node_modules/firebase-tools/lib/index.js
- /home/lucy/.cache/firebase/tools/lib/node_modules/firebase-tools/lib/bin/firebase.js {"code":"MODULE_NOT_FOUND","requireStack":["/home/lucy/.cache/firebase/tools/lib/node_modules/firebase-tools/lib/deploy/functions/runtimes/node/versioning.js","/home/lucy/.cache/firebase/tools/lib/node_modules/firebase-tools/lib/deploy/functions/runtimes/node/index.js","/home/lucy/.cache/firebase/tools/lib/node_modules/firebase-tools/lib/deploy/functions/runtimes/index.js","/home/lucy/.cache/firebase/tools/lib/node_modules/firebase-tools/lib/gcp/cloudfunctions.js","/home/lucy/.cache/firebase/tools/lib/node_modules/firebase-tools/lib/deploy/functions/backend.js","/home/lucy/.cache/firebase/tools/lib/node_modules/firebase-tools/lib/emulator/functionsEmulatorShared.js","/home/lucy/.cache/firebase/tools/lib/node_modules/firebase-tools/lib/emulator/functionsEmulator.js","/home/lucy/.cache/firebase/tools/lib/node_modules/firebase-tools/lib/emulator/controller.js","/home/lucy/.cache/firebase/tools/lib/node_modules/firebase-tools/lib/emulator/commandUtils.js","/home/lucy/.cache/firebase/tools/lib/node_modules/firebase-tools/lib/commands/database-get.js","/home/lucy/.cache/firebase/tools/lib/node_modules/firebase-tools/lib/commands/index.js","/home/lucy/.cache/firebase/tools/lib/node_modules/firebase-tools/lib/index.js","/home/lucy/.cache/firebase/tools/lib/node_modules/firebase-tools/lib/bin/firebase.js"]}
[debug] [2024-01-04T22:35:56.302Z] checkFunctionsSDKVersion encountered error: Invalid Version:  {}
[debug] [2024-01-04T22:35:56.304Z] > [functions] package.json contents: {
  "name": "functions",
  "description": "Cloud Functions for Firebase",
  "scripts": {
    "serve": "firebase emulators:start --only functions",
    "shell": "firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log"
  },
  "engines": {
    "node": "18"
  },
  "main": "index.js",
  "dependencies": {
    "firebase-admin": "^11.8.0",
    "firebase-functions": "^4.3.1"
  },
  "devDependencies": {
    "firebase-functions-test": "^3.1.0"
  },
  "private": true
}
[debug] [2024-01-04T22:35:56.304Z] Building nodejs source
[debug] [2024-01-04T22:35:56.305Z] Failed to find version of module node: reached end of search path /home/lucy/Code/Priaite_Party_UK/website/ppuk/node_modules
[info] ✔  functions: Using node@18 from host. 
[debug] [2024-01-04T22:35:56.309Z] Could not parse firebase-functions version '' into semver. Falling back to parseTriggers.
[error] ⬢  functions: Failed to load function definition from source: FirebaseError: Error parsing triggers: Cannot find module 'firebase-functions/v2/https'
Require stack:
- /home/lucy/Code/Priaite_Party_UK/website/ppuk/index.js
- /home/lucy/.cache/firebase/tools/lib/node_modules/firebase-tools/lib/deploy/functions/runtimes/node/triggerParser.js
1) If you want to compile the package/file into executable, please pay attention to compilation warnings and specify a literal in 'require' call. 2) If you don't want to compile the package/file into executable and want to 'require' it from filesystem (likely plugin), specify an absolute path in 'require' call using process.cwd() or process.execPath.

Try running "npm install" in your functions directory before deploying. {"metadata":{"emulator":{"name":"functions"},"message":"Failed to load function definition from source: FirebaseError: Error parsing triggers: Cannot find module 'firebase-functions/v2/https'\nRequire stack:\n- /home/lucy/Code/Priaite_Party_UK/website/ppuk/index.js\n- /home/lucy/.cache/firebase/tools/lib/node_modules/firebase-tools/lib/deploy/functions/runtimes/node/triggerParser.js\n1) If you want to compile the package/file into executable, please pay attention to compilation warnings and specify a literal in 'require' call. 2) If you don't want to compile the package/file into executable and want to 'require' it from filesystem (likely plugin), specify an absolute path in 'require' call using process.cwd() or process.execPath.\n\nTry running \"npm install\" in your functions directory before deploying."}}
[info] 
┌─────────────────────────────────────────────────────────────┐
│ ✔  All emulators ready! It is now safe to connect your app. │
│ i  View Emulator UI at http://127.0.0.1:4000/               │
└─────────────────────────────────────────────────────────────┘

┌────────────────┬──────────────────────────────────┬──────────────────────────────────┐
│ Emulator       │ Host:Port                        │ View in Emulator UI              │
├────────────────┼──────────────────────────────────┼──────────────────────────────────┤
│ Authentication │ 127.0.0.1:9099                   │ http://127.0.0.1:4000/auth       │
├────────────────┼──────────────────────────────────┼──────────────────────────────────┤
│ Functions      │ 127.0.0.1:5001                   │ http://127.0.0.1:4000/functions  │
├────────────────┼──────────────────────────────────┼──────────────────────────────────┤
│ Firestore      │ 127.0.0.1:8081                   │ http://127.0.0.1:4000/firestore  │
├────────────────┼──────────────────────────────────┼──────────────────────────────────┤
│ Hosting        │ Failed to initialize (see above) │                                  │
├────────────────┼──────────────────────────────────┼──────────────────────────────────┤
│ Storage        │ 127.0.0.1:9199                   │ http://127.0.0.1:4000/storage    │
├────────────────┼──────────────────────────────────┼──────────────────────────────────┤
│ Eventarc       │ 127.0.0.1:9299                   │ n/a                              │
├────────────────┼──────────────────────────────────┼──────────────────────────────────┤
│ Extensions     │ 127.0.0.1:5001                   │ http://127.0.0.1:4000/extensions │
└────────────────┴──────────────────────────────────┴──────────────────────────────────┘
  Emulator Hub running at 127.0.0.1:4400
  Other reserved ports: 4500, 9150
┌─────────────────────────┬───────────────┬─────────────────────┐
│ Extension Instance Name │ Extension Ref │ View in Emulator UI │
└─────────────────────────┴───────────────┴─────────────────────┘
Issues? Report them at https://github.com/firebase/firebase-tools/issues and attach the *-debug.log files.
 
[debug] [2024-01-04T22:36:01.683Z] Jan 04, 2024 10:36:01 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel
INFO: Connected to new websocket client
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:36:01 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel\nINFO: Connected to new websocket client\n"}}
[debug] [2024-01-04T22:36:01.690Z] Jan 04, 2024 10:36:01 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:36:01 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2024-01-04T22:36:01.697Z] Jan 04, 2024 10:36:01 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:36:01 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2024-01-04T22:36:01.714Z] Jan 04, 2024 10:36:01 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:36:01 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2024-01-04T22:36:01.902Z] Jan 04, 2024 10:36:01 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:36:01 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected HTTP/2 connection.\n"}}
[debug] [2024-01-04T22:36:02.240Z] Jan 04, 2024 10:36:02 PM com.google.cloud.datastore.emulator.impl.util.WrappedStreamObserver onError
WARNING: Operation failed: Error compiling rules:
L122:22 Unexpected 'null'.
L122:22 mismatched input 'null' expecting IDENTIFIER
L122:27 An unsupported type identifier was used with the 'is' operator. Received null. Expected one of bool,bytes,constraint,duration,float,int,latlng,list,set,number,map,string,timestamp,path,map_diff
L122:48 mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'}
L149:40 Unexpected '='.
L149:64 mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'}
L153:3 Unexpected '}'.
com.google.cloud.datastore.core.exception.DatastoreException: Error compiling rules:
L122:22 Unexpected 'null'.
L122:22 mismatched input 'null' expecting IDENTIFIER
L122:27 An unsupported type identifier was used with the 'is' operator. Received null. Expected one of bool,bytes,constraint,duration,float,int,latlng,list,set,number,map,string,timestamp,path,map_diff
L122:48 mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'}
L149:40 Unexpected '='.
L149:64 mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'}
L153:3 Unexpected '}'.
	at com.google.cloud.datastore.emulator.impl.rules.EmulatorRulesCompiler$CompilerException.asDatastoreException(EmulatorRulesCompiler.java:115)
	at com.google.cloud.datastore.emulator.impl.rules.EmulatorRulesCompiler$EmulatorCompilationResult.checkCompilationSucceeded(EmulatorRulesCompiler.java:74)
	at com.google.cloud.datastore.emulator.impl.rules.EmulatorRulesCompiler$EmulatorCompilationResult.getAuthorizer(EmulatorRulesCompiler.java:67)
	at com.google.cloud.datastore.emulator.impl.firestore.CloudFirestoreV1.listCollectionIds(CloudFirestoreV1.java:642)
	at com.google.cloud.datastore.emulator.impl.firestore.CloudFirestoreV1Router.listCollectionIds(CloudFirestoreV1Router.java:212)
	at com.google.cloud.datastore.emulator.firestore.v1.FirestoreV1GrpcAdapter$1.lambda$listCollectionIds$12(FirestoreV1GrpcAdapter.java:201)
	at com.google.cloud.datastore.emulator.firestore.v1.FirestoreV1GrpcAdapter.unary(FirestoreV1GrpcAdapter.java:70)
	at com.google.cloud.datastore.emulator.firestore.v1.FirestoreV1GrpcAdapter$1.listCollectionIds(FirestoreV1GrpcAdapter.java:201)
	at com.google.firestore.v1.FirestoreGrpc$MethodHandlers.invoke(FirestoreGrpc.java:1199)
	at io.grpc.stub.ServerCalls$UnaryServerCallHandler$UnaryServerCallListener.onHalfClose(ServerCalls.java:182)
	at io.grpc.PartialForwardingServerCallListener.onHalfClose(PartialForwardingServerCallListener.java:35)
	at io.grpc.ForwardingServerCallListener.onHalfClose(ForwardingServerCallListener.java:23)
	at io.grpc.ForwardingServerCallListener$SimpleForwardingServerCallListener.onHalfClose(ForwardingServerCallListener.java:40)
	at io.grpc.Contexts$ContextualizedServerCallListener.onHalfClose(Contexts.java:86)
	at io.grpc.PartialForwardingServerCallListener.onHalfClose(PartialForwardingServerCallListener.java:35)
	at io.grpc.ForwardingServerCallListener.onHalfClose(ForwardingServerCallListener.java:23)
	at io.grpc.ForwardingServerCallListener$SimpleForwardingServerCallListener.onHalfClose(ForwardingServerCallListener.java:40)
	at io.grpc.Contexts$ContextualizedServerCallListener.onHalfClose(Contexts.java:86)
	at io.grpc.internal.ServerCallImpl$ServerStreamListenerImpl.halfClosed(ServerCallImpl.java:346)
	at io.grpc.internal.ServerImpl$JumpToApplicationThreadServerStreamListener$1HalfClosed.runInContext(ServerImpl.java:860)
	at io.grpc.internal.ContextRunnable.run(ContextRunnable.java:37)
	at io.grpc.internal.SerializingExecutor.run(SerializingExecutor.java:133)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:840)
Caused by: com.google.cloud.datastore.emulator.impl.rules.AutoValue_EmulatorRulesCompiler_CompilerException
	at com.google.cloud.datastore.emulator.impl.rules.EmulatorRulesCompiler$CompilerException.of(EmulatorRulesCompiler.java:101)
	... 24 more

 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:36:02 PM com.google.cloud.datastore.emulator.impl.util.WrappedStreamObserver onError\nWARNING: Operation failed: Error compiling rules:\nL122:22 Unexpected 'null'.\nL122:22 mismatched input 'null' expecting IDENTIFIER\nL122:27 An unsupported type identifier was used with the 'is' operator. Received null. Expected one of bool,bytes,constraint,duration,float,int,latlng,list,set,number,map,string,timestamp,path,map_diff\nL122:48 mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'}\nL149:40 Unexpected '='.\nL149:64 mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'}\nL153:3 Unexpected '}'.\ncom.google.cloud.datastore.core.exception.DatastoreException: Error compiling rules:\nL122:22 Unexpected 'null'.\nL122:22 mismatched input 'null' expecting IDENTIFIER\nL122:27 An unsupported type identifier was used with the 'is' operator. Received null. Expected one of bool,bytes,constraint,duration,float,int,latlng,list,set,number,map,string,timestamp,path,map_diff\nL122:48 mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'}\nL149:40 Unexpected '='.\nL149:64 mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'}\nL153:3 Unexpected '}'.\n\tat com.google.cloud.datastore.emulator.impl.rules.EmulatorRulesCompiler$CompilerException.asDatastoreException(EmulatorRulesCompiler.java:115)\n\tat com.google.cloud.datastore.emulator.impl.rules.EmulatorRulesCompiler$EmulatorCompilationResult.checkCompilationSucceeded(EmulatorRulesCompiler.java:74)\n\tat com.google.cloud.datastore.emulator.impl.rules.EmulatorRulesCompiler$EmulatorCompilationResult.getAuthorizer(EmulatorRulesCompiler.java:67)\n\tat com.google.cloud.datastore.emulator.impl.firestore.CloudFirestoreV1.listCollectionIds(CloudFirestoreV1.java:642)\n\tat com.google.cloud.datastore.emulator.impl.firestore.CloudFirestoreV1Router.listCollectionIds(CloudFirestoreV1Router.java:212)\n\tat com.google.cloud.datastore.emulator.firestore.v1.FirestoreV1GrpcAdapter$1.lambda$listCollectionIds$12(FirestoreV1GrpcAdapter.java:201)\n\tat com.google.cloud.datastore.emulator.firestore.v1.FirestoreV1GrpcAdapter.unary(FirestoreV1GrpcAdapter.java:70)\n\tat com.google.cloud.datastore.emulator.firestore.v1.FirestoreV1GrpcAdapter$1.listCollectionIds(FirestoreV1GrpcAdapter.java:201)\n\tat com.google.firestore.v1.FirestoreGrpc$MethodHandlers.invoke(FirestoreGrpc.java:1199)\n\tat io.grpc.stub.ServerCalls$UnaryServerCallHandler$UnaryServerCallListener.onHalfClose(ServerCalls.java:182)\n\tat io.grpc.PartialForwardingServerCallListener.onHalfClose(PartialForwardingServerCallListener.java:35)\n\tat io.grpc.ForwardingServerCallListener.onHalfClose(ForwardingServerCallListener.java:23)\n\tat io.grpc.ForwardingServerCallListener$SimpleForwardingServerCallListener.onHalfClose(ForwardingServerCallListener.java:40)\n\tat io.grpc.Contexts$ContextualizedServerCallListener.onHalfClose(Contexts.java:86)\n\tat io.grpc.PartialForwardingServerCallListener.onHalfClose(PartialForwardingServerCallListener.java:35)\n\tat io.grpc.ForwardingServerCallListener.onHalfClose(ForwardingServerCallListener.java:23)\n\tat io.grpc.ForwardingServerCallListener$SimpleForwardingServerCallListener.onHalfClose(ForwardingServerCallListener.java:40)\n\tat io.grpc.Contexts$ContextualizedServerCallListener.onHalfClose(Contexts.java:86)\n\tat io.grpc.internal.ServerCallImpl$ServerStreamListenerImpl.halfClosed(ServerCallImpl.java:346)\n\tat io.grpc.internal.ServerImpl$JumpToApplicationThreadServerStreamListener$1HalfClosed.runInContext(ServerImpl.java:860)\n\tat io.grpc.internal.ContextRunnable.run(ContextRunnable.java:37)\n\tat io.grpc.internal.SerializingExecutor.run(SerializingExecutor.java:133)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n\tat java.base/java.lang.Thread.run(Thread.java:840)\nCaused by: com.google.cloud.datastore.emulator.impl.rules.AutoValue_EmulatorRulesCompiler_CompilerException\n\tat com.google.cloud.datastore.emulator.impl.rules.EmulatorRulesCompiler$CompilerException.of(EmulatorRulesCompiler.java:101)\n\t... 24 more\n\n"}}
[debug] [2024-01-04T22:36:02.252Z] Jan 04, 2024 10:36:02 PM io.gapi.emulators.netty.HttpHandler$1 onError
INFO: Exception when handling request: INVALID_ARGUMENT: Error compiling rules:
L122:22 Unexpected 'null'.
L122:22 mismatched input 'null' expecting IDENTIFIER
L122:27 An unsupported type identifier was used with the 'is' operator. Received null. Expected one of bool,bytes,constraint,duration,float,int,latlng,list,set,number,map,string,timestamp,path,map_diff
L122:48 mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'}
L149:40 Unexpected '='.
L149:64 mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'}
L153:3 Unexpected '}'.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:36:02 PM io.gapi.emulators.netty.HttpHandler$1 onError\nINFO: Exception when handling request: INVALID_ARGUMENT: Error compiling rules:\nL122:22 Unexpected 'null'.\nL122:22 mismatched input 'null' expecting IDENTIFIER\nL122:27 An unsupported type identifier was used with the 'is' operator. Received null. Expected one of bool,bytes,constraint,duration,float,int,latlng,list,set,number,map,string,timestamp,path,map_diff\nL122:48 mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'}\nL149:40 Unexpected '='.\nL149:64 mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'}\nL153:3 Unexpected '}'.\n"}}
[debug] [2024-01-04T22:36:02.378Z] Jan 04, 2024 10:36:02 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:36:02 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2024-01-04T22:36:02.390Z] Jan 04, 2024 10:36:02 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed
INFO: Websocket client disconnected
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:36:02 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler channelClosed\nINFO: Websocket client disconnected\n"}}
[debug] [2024-01-04T22:36:02.393Z] Jan 04, 2024 10:36:02 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:36:02 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2024-01-04T22:36:02.398Z] Jan 04, 2024 10:36:02 PM com.google.cloud.datastore.emulator.firestore.webchannel.FirestoreV1WebChannelAdapter$FirestoreListenHandler onClose
INFO: channel closed
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:36:02 PM com.google.cloud.datastore.emulator.firestore.webchannel.FirestoreV1WebChannelAdapter$FirestoreListenHandler onClose\nINFO: channel closed\n"}}
[info] i  firestore: Change detected, updating rules... 
[debug] [2024-01-04T22:36:07.775Z] >>> [apiv2][query] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules [none]
[debug] [2024-01-04T22:36:07.778Z] >>> [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    // Other rules...\n    function isValidPhoneNumber(phone) {\n      // Define your custom logic to validate the phone number format\n      // For example, you can use regular expressions to check the format\n      // Replace the following regular expression with your own validation logic\n      return phone.matches(\"^\\\\+\\\\([0-9]+\\\\)#\\\\* [0-9]+$\");\n    }\n    function isValidEmail(email) {\n      // Define your custom logic to validate the email address format\n      // Replace the following regular expression with your own validation logic\n      return email.matches(\"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\\\.[a-zA-Z]{2,}$\");\n    }\n\n    function isValidAddress(address) {\n      // Check if the address has the required fields\n      return address is map &&\n      'addressLines' in address &&\n      'postcode' in address &&\n      'locality' in address &&\n      'regionCode' in address &&\n      address.addressLines is list && address.addressLines.size() >= 2 &&\n      address.addressLines[0] is string && \n      address.addressLines[1] is string &&\n      address.addressLines[0].size() >= 1 &&\n      address.addressLines[1].size() >= 1 &&\n      address.addressLines[0].size() <= 255 &&\n      address.addressLines[1].size() <= 255 &&\n      address.postcode is string &&\n      address.locality is string &&\n      address.regionCode is string && address.regionCode.size() == 2;\n    }\n    function isUserAdmin(uid) {\n      return get(/databases/$(database)/documents/users/$(uid)).data.role.hasAny(['admin']);\n    }\n    function isValidDOB(dob) {\n      // Define your custom logic to validate the date of birth format\n      // This is a basic example, you might want to adjust it based on your needs\n      return dob.matches(\"^\\\\d{4}-\\\\d{2}-\\\\d{2}$\");\n    }\n    function isValidFirstName(firstName) {\n      // Define your custom logic to validate the first name\n      // This is a basic example; adjust it based on your needs\n      return firstName is string && firstName.length > 0 && firstName.length < 255;\n    }\n\n    function isValidLastName(lastName) {\n      // Define your custom logic to validate the last name\n      // This is a basic example; adjust it based on your needs\n      return lastName is string && lastName.length > 0 && firstName.length < 255;\n    }\n    // User document rules\n    match /user/{userId} {\n      allow read, write: if request.auth != null && request.auth.uid == userId\n        && request.resource.data.keys().hasAll(['email', 'firstName', 'lastName', 'dob', 'address', 'phone', 'role'])\n        && request.resource.data.email is string // && isValidEmail(request.resource.data.email)\n        && request.resource.data.firstName is string //&& isValidFirstName(firstName)\n        && request.resource.data.lastName is string //&& isValidLastName(lastName)\n        && request.resource.data.dob is string && isValidDOB(request.resource.data.dob)\n        && request.resource.data.address is map && isValidAddress(request.resource.data.address)\n        && request.resource.data.phone is string && isValidPhoneNumber(request.resource.data.phone)\n        && request.resource.data.role is list && request.resource.data.role.size() == 0;\n      allow read, write: if isUserAdmin(request.auth.uid);\n    }\n\n    // Rules for /election/{electionId} path\n    match /election/{electionId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidElectionData(request.resource.data);\n\n      // Function to check if the election data is valid\n      function isValidElectionData(data) {\n        return data != null &&\n        data.keys().hasAll(['startTime', 'endTime', 'title']) &&\n        data.startTime is timestamp &&\n        data.endTime is timestamp &&\n        data.title is string &&\n        // Add additional conditions for start time, end time, and title as needed\n        isValidStartTime(data.startTime) &&\n        isValidEndTime(data.endTime) &&\n        isValidTitle(data.title);\n      }\n\n      // Function to check if the start time is valid (customize as needed)\n      function isValidStartTime(startTime) {\n        // Add your specific logic for validating the start time\n        return startTime != null && startTime.toMillis() > now();\n      }\n\n      // Function to check if the end time is valid (customize as needed)\n      function isValidEndTime(endTime) {\n        // Add your specific logic for validating the end time\n        return endTime != null && endTime.toMillis() > now();\n      }\n\n      // Function to check if the title is valid (customize as needed)\n      function isValidTitle(title) {\n        // Add your specific logic for validating the title\n        return title != null && title.matches(\"^[a-zA-Z0-9 ]+$\"); // Example: Alphanumeric with spaces\n      }\n    }\n\n    // Rules for /election/{electionId}/candidate/{candidateId} path\n    match /election/{electionId}/candidate/{candidateId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidCandidateData(request.resource.data);\n\n      // Function to check if the candidate data is valid\n      function isValidCandidateData(data) {\n        return data != null &&\n        data.keys().hasAll(['name', 'description']) &&\n        data.name is string &&\n        data.description is string &&\n        // Additional optional fields\n        (data.uid is null || data.uid is string) &&\n        (data.imageUrl is null || data.imageUrl is string);\n      }\n    }\n\n    // Rules for /election/{electionId}/vote/{userId} path\n    match /election/{electionId}/vote/{userId} {\n      allow read: if request.auth != null && request.auth.uid == userId; // Allow the user to read their own vote\n\n      allow write: if request.auth != null && isUserAdmin(request.auth.uid) &&\n      isValidVoteData(request.resource.data);\n\n      // Function to check if the vote data is valid\n      function isValidVoteData(data) {\n        return data != null &&\n        data.keys().hasAll(['candidateIds']) &&\n        data.candidateIds is list &&\n        isValidCandidateIds(data.candidateIds);\n        // Add additional conditions if needed (e.g., checking if the candidateIds are valid)\n      }\n\n      // Function to check if the candidateIds are valid\n      function isValidCandidateIds(candidateIds) {\n        // Add your specific logic for validating the list of candidateIds\n        // For example, ensure that each candidateId is a string\n        return candidateIds is list &&\n        candidateIds.size() > 0 &&\n        candidateIds.every(candidateId => candidateId is string);\n      }\n    }\n\n  }\n}\n"}]}}
[debug] [2024-01-04T22:36:07.787Z] Jan 04, 2024 10:36:07 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:36:07 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2024-01-04T22:36:07.955Z] <<< [apiv2][status] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules 200
[debug] [2024-01-04T22:36:07.955Z] <<< [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":122,"column":22,"currentOffset":5537,"endOffset":5540},"description":"Unexpected 'null'.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":122,"column":22,"currentOffset":5537,"endOffset":5540},"description":"mismatched input 'null' expecting IDENTIFIER","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":122,"column":27,"currentOffset":5542,"endOffset":5543},"description":"An unsupported type identifier was used with the 'is' operator. Received null. Expected one of bool,bytes,constraint,duration,float,int,latlng,list,set,number,map,string,timestamp,path,map_diff","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":122,"column":48,"currentOffset":5563,"endOffset":5563},"description":"mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":149,"column":40,"currentOffset":6712,"endOffset":6712},"description":"Unexpected '='.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":149,"column":64,"currentOffset":6736,"endOffset":6736},"description":"mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":153,"column":3,"currentOffset":6756,"endOffset":6756},"description":"Unexpected '}'.","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:122:22 - ERROR Unexpected 'null'. 
[warn] ⚠  firestore.rules:122:22 - ERROR mismatched input 'null' expecting IDENTIFIER 
[warn] ⚠  firestore.rules:122:27 - ERROR An unsupported type identifier was used with the 'is' operator. Received null. Expected one of bool,bytes,constraint,duration,float,int,latlng,list,set,number,map,string,timestamp,path,map_diff 
[warn] ⚠  firestore.rules:122:48 - ERROR mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'} 
[warn] ⚠  firestore.rules:149:40 - ERROR Unexpected '='. 
[warn] ⚠  firestore.rules:149:64 - ERROR mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'} 
[warn] ⚠  firestore.rules:153:3 - ERROR Unexpected '}'. 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2024-01-04T22:36:49.864Z] >>> [apiv2][query] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules [none]
[debug] [2024-01-04T22:36:49.865Z] >>> [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    // Other rules...\n    function isValidPhoneNumber(phone) {\n      // Define your custom logic to validate the phone number format\n      // For example, you can use regular expressions to check the format\n      // Replace the following regular expression with your own validation logic\n      return phone.matches(\"^\\\\+\\\\([0-9]+\\\\)#\\\\* [0-9]+$\");\n    }\n    function isValidEmail(email) {\n      // Define your custom logic to validate the email address format\n      // Replace the following regular expression with your own validation logic\n      return email.matches(\"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\\\.[a-zA-Z]{2,}$\");\n    }\n\n    function isValidAddress(address) {\n      // Check if the address has the required fields\n      return address is map &&\n      'addressLines' in address &&\n      'postcode' in address &&\n      'locality' in address &&\n      'regionCode' in address &&\n      address.addressLines is list && address.addressLines.size() >= 2 &&\n      address.addressLines[0] is string && \n      address.addressLines[1] is string &&\n      address.addressLines[0].size() >= 1 &&\n      address.addressLines[1].size() >= 1 &&\n      address.addressLines[0].size() <= 255 &&\n      address.addressLines[1].size() <= 255 &&\n      address.postcode is string &&\n      address.locality is string &&\n      address.regionCode is string && address.regionCode.size() == 2;\n    }\n    function isUserAdmin(uid) {\n      return get(/databases/$(database)/documents/users/$(uid)).data.role.hasAny(['admin']);\n    }\n    function isValidDOB(dob) {\n      // Define your custom logic to validate the date of birth format\n      // This is a basic example, you might want to adjust it based on your needs\n      return dob.matches(\"^\\\\d{4}-\\\\d{2}-\\\\d{2}$\");\n    }\n    function isValidFirstName(firstName) {\n      // Define your custom logic to validate the first name\n      // This is a basic example; adjust it based on your needs\n      return firstName is string && firstName.length > 0 && firstName.length < 255;\n    }\n\n    function isValidLastName(lastName) {\n      // Define your custom logic to validate the last name\n      // This is a basic example; adjust it based on your needs\n      return lastName is string && lastName.length > 0 && firstName.length < 255;\n    }\n    // User document rules\n    match /user/{userId} {\n      allow read, write: if request.auth != null && request.auth.uid == userId\n        && request.resource.data.keys().hasAll(['email', 'firstName', 'lastName', 'dob', 'address', 'phone', 'role'])\n        && request.resource.data.email is string // && isValidEmail(request.resource.data.email)\n        && request.resource.data.firstName is string //&& isValidFirstName(firstName)\n        && request.resource.data.lastName is string //&& isValidLastName(lastName)\n        && request.resource.data.dob is string && isValidDOB(request.resource.data.dob)\n        && request.resource.data.address is map && isValidAddress(request.resource.data.address)\n        && request.resource.data.phone is string && isValidPhoneNumber(request.resource.data.phone)\n        && request.resource.data.role is list && request.resource.data.role.size() == 0;\n      allow read, write: if isUserAdmin(request.auth.uid);\n    }\n\n    // Rules for /election/{electionId} path\n    match /election/{electionId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidElectionData(request.resource.data);\n\n      // Function to check if the election data is valid\n      function isValidElectionData(data) {\n        return data != null &&\n        data.keys().hasAll(['startTime', 'endTime', 'title']) &&\n        data.startTime is timestamp &&\n        data.endTime is timestamp &&\n        data.title is string &&\n        // Add additional conditions for start time, end time, and title as needed\n        isValidStartTime(data.startTime) &&\n        isValidEndTime(data.endTime) &&\n        isValidTitle(data.title);\n      }\n\n      // Function to check if the start time is valid (customize as needed)\n      function isValidStartTime(startTime) {\n        // Add your specific logic for validating the start time\n        return startTime != null && startTime.toMillis() > now();\n      }\n\n      // Function to check if the end time is valid (customize as needed)\n      function isValidEndTime(endTime) {\n        // Add your specific logic for validating the end time\n        return endTime != null && endTime.toMillis() > now();\n      }\n\n      // Function to check if the title is valid (customize as needed)\n      function isValidTitle(title) {\n        // Add your specific logic for validating the title\n        return title != null && title.matches(\"^[a-zA-Z0-9 ]+$\"); // Example: Alphanumeric with spaces\n      }\n    }\n\n    // Rules for /election/{electionId}/candidate/{candidateId} path\n    match /election/{electionId}/candidate/{candidateId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidCandidateData(request.resource.data);\n\n      // Function to check if the candidate data is valid\n      function isValidCandidateData(data) {\n        return data != null &&\n        data.keys().hasAll(['name', 'description']) &&\n        data.name is string &&\n        data.description is string;\n      }\n    }\n\n    // Rules for /election/{electionId}/vote/{userId} path\n    match /election/{electionId}/vote/{userId} {\n      allow read: if request.auth != null && request.auth.uid == userId; // Allow the user to read their own vote\n\n      allow write: if request.auth != null && isUserAdmin(request.auth.uid) &&\n      isValidVoteData(request.resource.data);\n\n      // Function to check if the vote data is valid\n      function isValidVoteData(data) {\n        return data != null &&\n        data.keys().hasAll(['candidateIds']) &&\n        data.candidateIds is list &&\n        isValidCandidateIds(data.candidateIds);\n        // Add additional conditions if needed (e.g., checking if the candidateIds are valid)\n      }\n\n      // Function to check if the candidateIds are valid\n      function isValidCandidateIds(candidateIds) {\n        // Add your specific logic for validating the list of candidateIds\n        // For example, ensure that each candidateId is a string\n        return candidateIds is list &&\n        candidateIds.size() > 0 &&\n        candidateIds.every(candidateId => candidateId is string);\n      }\n    }\n\n  }\n}\n"}]}}
[debug] [2024-01-04T22:36:49.877Z] Jan 04, 2024 10:36:49 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:36:49 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2024-01-04T22:36:49.955Z] <<< [apiv2][status] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules 200
[debug] [2024-01-04T22:36:49.955Z] <<< [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":146,"column":40,"currentOffset":6560,"endOffset":6560},"description":"Unexpected '='.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":146,"column":64,"currentOffset":6584,"endOffset":6584},"description":"mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":151,"column":1,"currentOffset":6606,"endOffset":6606},"description":"Unexpected '}'.","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:146:40 - ERROR Unexpected '='. 
[warn] ⚠  firestore.rules:146:64 - ERROR mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'} 
[warn] ⚠  firestore.rules:151:1 - ERROR Unexpected '}'. 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2024-01-04T22:37:36.653Z] >>> [apiv2][query] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules [none]
[debug] [2024-01-04T22:37:36.654Z] >>> [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    // Other rules...\n    function isValidPhoneNumber(phone) {\n      // Define your custom logic to validate the phone number format\n      // For example, you can use regular expressions to check the format\n      // Replace the following regular expression with your own validation logic\n      return phone.matches(\"^\\\\+\\\\([0-9]+\\\\)#\\\\* [0-9]+$\");\n    }\n    function isValidEmail(email) {\n      // Define your custom logic to validate the email address format\n      // Replace the following regular expression with your own validation logic\n      return email.matches(\"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\\\.[a-zA-Z]{2,}$\");\n    }\n\n    function isValidAddress(address) {\n      // Check if the address has the required fields\n      return address is map &&\n      'addressLines' in address &&\n      'postcode' in address &&\n      'locality' in address &&\n      'regionCode' in address &&\n      address.addressLines is list && address.addressLines.size() >= 2 &&\n      address.addressLines[0] is string && \n      address.addressLines[1] is string &&\n      address.addressLines[0].size() >= 1 &&\n      address.addressLines[1].size() >= 1 &&\n      address.addressLines[0].size() <= 255 &&\n      address.addressLines[1].size() <= 255 &&\n      address.postcode is string &&\n      address.locality is string &&\n      address.regionCode is string && address.regionCode.size() == 2;\n    }\n    function isUserAdmin(uid) {\n      return get(/databases/$(database)/documents/users/$(uid)).data.role.hasAny(['admin']);\n    }\n    function isValidDOB(dob) {\n      // Define your custom logic to validate the date of birth format\n      // This is a basic example, you might want to adjust it based on your needs\n      return dob.matches(\"^\\\\d{4}-\\\\d{2}-\\\\d{2}$\");\n    }\n    function isValidFirstName(firstName) {\n      // Define your custom logic to validate the first name\n      // This is a basic example; adjust it based on your needs\n      return firstName is string && firstName.length > 0 && firstName.length < 255;\n    }\n\n    function isValidLastName(lastName) {\n      // Define your custom logic to validate the last name\n      // This is a basic example; adjust it based on your needs\n      return lastName is string && lastName.length > 0 && firstName.length < 255;\n    }\n    // User document rules\n    match /user/{userId} {\n      allow read, write: if request.auth != null && request.auth.uid == userId\n        && request.resource.data.keys().hasAll(['email', 'firstName', 'lastName', 'dob', 'address', 'phone', 'role'])\n        && request.resource.data.email is string // && isValidEmail(request.resource.data.email)\n        && request.resource.data.firstName is string //&& isValidFirstName(firstName)\n        && request.resource.data.lastName is string //&& isValidLastName(lastName)\n        && request.resource.data.dob is string && isValidDOB(request.resource.data.dob)\n        && request.resource.data.address is map && isValidAddress(request.resource.data.address)\n        && request.resource.data.phone is string && isValidPhoneNumber(request.resource.data.phone)\n        && request.resource.data.role is list && request.resource.data.role.size() == 0;\n      allow read, write: if isUserAdmin(request.auth.uid);\n    }\n\n    // Rules for /election/{electionId} path\n    match /election/{electionId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidElectionData(request.resource.data);\n\n      // Function to check if the election data is valid\n      function isValidElectionData(data) {\n        return data != null &&\n        data.keys().hasAll(['startTime', 'endTime', 'title']) &&\n        data.startTime is timestamp &&\n        data.endTime is timestamp &&\n        data.title is string &&\n        // Add additional conditions for start time, end time, and title as needed\n        isValidStartTime(data.startTime) &&\n        isValidEndTime(data.endTime) &&\n        isValidTitle(data.title);\n      }\n\n      // Function to check if the start time is valid (customize as needed)\n      function isValidStartTime(startTime) {\n        // Add your specific logic for validating the start time\n        return startTime != null && startTime.toMillis() > now();\n      }\n\n      // Function to check if the end time is valid (customize as needed)\n      function isValidEndTime(endTime) {\n        // Add your specific logic for validating the end time\n        return endTime != null && endTime.toMillis() > now();\n      }\n\n      // Function to check if the title is valid (customize as needed)\n      function isValidTitle(title) {\n        // Add your specific logic for validating the title\n        return title != null && title.matches(\"^[a-zA-Z0-9 ]+$\"); // Example: Alphanumeric with spaces\n      }\n    }\n\n    // Rules for /election/{electionId}/candidate/{candidateId} path\n    match /election/{electionId}/candidate/{candidateId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidCandidateData(request.resource.data);\n\n      // Function to check if the candidate data is valid\n      function isValidCandidateData(data) {\n        return data != null &&\n        data.keys().hasAll(['name', 'description']) &&\n        data.name is string &&\n        data.description is string;\n      }\n    }\n\n    // Rules for /election/{electionId}/vote/{userId} path\n    match /election/{electionId}/vote/{userId} {\n      allow read: if request.auth != null && request.auth.uid == userId; // Allow the user to read their own vote\n\n      allow write: if request.auth != null && isUserAdmin(request.auth.uid) &&\n      isValidVoteData(request.resource.data);\n\n      // Function to check if the vote data is valid\n      function isValidVoteData(data) {\n        return data != null &&\n        data.keys().hasAll(['candidateIds']) &&\n        data.candidateIds is list &&\n        isValidCandidateIds(data.candidateIds);\n        // Add additional conditions if needed (e.g., checking if the candidateIds are valid)\n      }\n\n      // Function to check if the candidateIds are valid\n      function isValidCandidateIds(candidateIds) {\n        // Add your specific logic for validating the list of candidateIds\n        // For example, ensure that each candidateId is a string\n        return candidateIds is list &&\n        candidateIds.size() > 0 ;\n        // &&\n        // candidateIds.every(candidateId => candidateId is string);\n      }\n    }\n\n  }\n}\n"}]}}
[debug] [2024-01-04T22:37:36.656Z] Jan 04, 2024 10:37:36 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:37:36 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2024-01-04T22:37:37.118Z] <<< [apiv2][status] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules 200
[debug] [2024-01-04T22:37:37.118Z] <<< [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":12,"column":14,"currentOffset":457,"endOffset":468},"description":"Unused function: isValidEmail.","severity":"WARNING"},{"sourcePosition":{"fileName":"security.rules","line":44,"column":14,"currentOffset":1852,"endOffset":1867},"description":"Unused function: isValidFirstName.","severity":"WARNING"},{"sourcePosition":{"fileName":"security.rules","line":50,"column":14,"currentOffset":2111,"endOffset":2125},"description":"Unused function: isValidLastName.","severity":"WARNING"},{"sourcePosition":{"fileName":"security.rules","line":53,"column":59,"currentOffset":2321,"endOffset":2329},"description":"Invalid variable name: firstName.","severity":"WARNING"},{"sourcePosition":{"fileName":"security.rules","line":92,"column":60,"currentOffset":4344,"endOffset":4346},"description":"Invalid function name: now.","severity":"WARNING"},{"sourcePosition":{"fileName":"security.rules","line":98,"column":56,"currentOffset":4593,"endOffset":4595},"description":"Invalid function name: now.","severity":"WARNING"}]}
[warn] ⚠  firestore.rules:12:14 - WARNING Unused function: isValidEmail. 
[warn] ⚠  firestore.rules:44:14 - WARNING Unused function: isValidFirstName. 
[warn] ⚠  firestore.rules:50:14 - WARNING Unused function: isValidLastName. 
[warn] ⚠  firestore.rules:53:59 - WARNING Invalid variable name: firstName. 
[warn] ⚠  firestore.rules:92:60 - WARNING Invalid function name: now. 
[warn] ⚠  firestore.rules:98:56 - WARNING Invalid function name: now. 
[info] ✔  firestore: Rules updated. 
[debug] [2024-01-04T22:37:56.995Z] Jan 04, 2024 10:37:56 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel
INFO: Connected to new websocket client
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:37:56 PM com.google.cloud.datastore.emulator.firestore.websocket.WebSocketChannelHandler initChannel\nINFO: Connected to new websocket client\n"}}
[debug] [2024-01-04T22:37:57.017Z] Jan 04, 2024 10:37:57 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:37:57 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2024-01-04T22:37:57.089Z] Jan 04, 2024 10:37:57 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:37:57 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2024-01-04T22:38:17.166Z] Jan 04, 2024 10:38:17 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:38:17 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2024-01-04T22:38:43.941Z] Jan 04, 2024 10:38:43 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:38:43 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[info] i  firestore: Change detected, updating rules... 
[debug] [2024-01-04T22:39:05.744Z] >>> [apiv2][query] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules [none]
[debug] [2024-01-04T22:39:05.744Z] >>> [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    // Other rules...\n    function isValidPhoneNumber(phone) {\n      // Define your custom logic to validate the phone number format\n      // For example, you can use regular expressions to check the format\n      // Replace the following regular expression with your own validation logic\n      return phone.matches(\"^\\\\+\\\\([0-9]+\\\\)#\\\\* [0-9]+$\");\n    }\n    function isValidEmail(email) {\n      // Define your custom logic to validate the email address format\n      // Replace the following regular expression with your own validation logic\n      return email.matches(\"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\\\.[a-zA-Z]{2,}$\");\n    }\n\n    function isValidAddress(address) {\n      // Check if the address has the required fields\n      return address is map &&\n      'addressLines' in address &&\n      'postcode' in address &&\n      'locality' in address &&\n      'regionCode' in address &&\n      address.addressLines is list && address.addressLines.size() >= 2 &&\n      address.addressLines[0] is string && \n      address.addressLines[1] is string &&\n      address.addressLines[0].size() >= 1 &&\n      address.addressLines[1].size() >= 1 &&\n      address.addressLines[0].size() <= 255 &&\n      address.addressLines[1].size() <= 255 &&\n      address.postcode is string &&\n      address.locality is string &&\n      address.regionCode is string && address.regionCode.size() == 2;\n    }\n    function isUserAdmin(uid) {\n      return get(/databases/$(database)/documents/users/$(uid)).data.role.hasAny(['admin']);\n    }\n    function isValidDOB(dob) {\n      // Define your custom logic to validate the date of birth format\n      // This is a basic example, you might want to adjust it based on your needs\n      return dob.matches(\"^\\\\d{4}-\\\\d{2}-\\\\d{2}$\");\n    }\n    function isValidFirstName(firstName) {\n      // Define your custom logic to validate the first name\n      // This is a basic example; adjust it based on your needs\n      return firstName is string && firstName.length > 0 && firstName.length < 255;\n    }\n\n    function isValidLastName(lastName) {\n      // Define your custom logic to validate the last name\n      // This is a basic example; adjust it based on your needs\n      return lastName is string && lastName.length > 0 && firstName.length < 255;\n    }\n    // User document rules\n    match /user/{userId} {\n      allow read, write: if request.auth != null && request.auth.uid == userId\n        && request.resource.data.keys().hasAll(['email', 'firstName', 'lastName', 'dob', 'address', 'phone', 'role'])\n        && request.resource.data.email is string // && isValidEmail(request.resource.data.email)\n        && request.resource.data.firstName is string //&& isValidFirstName(firstName)\n        && request.resource.data.lastName is string //&& isValidLastName(lastName)\n        && request.resource.data.dob is string && isValidDOB(request.resource.data.dob)\n        && request.resource.data.address is map && isValidAddress(request.resource.data.address)\n        && request.resource.data.phone is string && isValidPhoneNumber(request.resource.data.phone)\n        && request.resource.data.role is list && request.resource.data.role.size() == 0;\n      allow read, write: if isUserAdmin(request.auth.uid);\n    }\n\n    // Rules for /election/{electionId} path\n    match /election/{electionId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidElectionData(request.resource.data);\n\n      // Function to check if the election data is valid\n      function isValidElectionData(data) {\n        return data != null &&\n        data.keys().hasAll(['startTime', 'endTime', 'title']) &&\n        data.startTime is timestamp &&\n        data.endTime is timestamp &&\n        data.title is string &&\n        // Add additional conditions for start time, end time, and title as needed\n        isValidStartTime(data.startTime) &&\n        isValidEndTime(data.endTime) &&\n        isValidTitle(data.title);\n      }\n\n      // Function to check if the start time is valid (customize as needed)\n      function isValidStartTime(startTime) {\n        // Add your specific logic for validating the start time\n        return startTime != null && startTime.toMillis() > now();\n      }\n\n      // Function to check if the end time is valid (customize as needed)\n      function isValidEndTime(endTime) {\n        // Add your specific logic for validating the end time\n        return endTime != null && endTime.toMillis() > now();\n      }\n\n      // Function to check if the title is valid (customize as needed)\n      function isValidTitle(title) {\n        // Add your specific logic for validating the title\n        return title != null && title.matches(\"^[a-zA-Z0-9 ]+$\"); // Example: Alphanumeric with spaces\n      }\n    }\n\n    // Rules for /election/{electionId}/candidate/{candidateId} path\n    match /election/{electionId}/candidate/{candidateId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidCandidateData(request.resource.data);\n\n      // Function to check if the candidate data is valid\n      function isValidCandidateData(data) {\n        return data != null &&\n        data.keys().hasAll(['name', 'description']) &&\n        data.name is string &&\n        data.description is string;\n      }\n    }\n\n    // Rules for /election/{electionId}/vote/{userId} path\n    match /election/{electionId}/vote/{userId} {\n      allow read: if request.auth != null && request.auth.uid == userId; // Allow the user to read their own vote\n\n      allow write: if request.auth != null && isUserAdmin(request.auth.uid) &&\n      isValidVoteData(request.resource.data);\n\n      // Function to check if the vote data is valid\n      function isValidVoteData(data) {\n        return data != null &&\n        data.keys().hasAll(['candidateIds']) &&\n        data.candidateIds is list &&\n        isValidCandidateIds(data.candidateIds);\n        // Add additional conditions if needed (e.g., checking if the candidateIds are valid)\n      }\n\n      // Function to check if the candidateIds are valid\n      function isValidCandidateIds(candidateIds) {\n        // Add your specific logic for validating the list of candidateIds\n        // For example, ensure that each candidateId is a string\n        return candidateIds is list &&\n        candidateIds.size() > 0 ;\n        // &&\n        candidateIds.every(candidateId => candidateId is string);\n      }\n    }\n\n  }\n}\n"}]}}
[debug] [2024-01-04T22:39:05.747Z] Jan 04, 2024 10:39:05 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:39:05 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2024-01-04T22:39:05.788Z] <<< [apiv2][status] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules 200
[debug] [2024-01-04T22:39:05.788Z] <<< [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":147,"column":9,"currentOffset":6542,"endOffset":6553},"description":"mismatched input 'candidateIds' expecting '}'","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":152,"column":1,"currentOffset":6619,"endOffset":6619},"description":"Unexpected '}'.","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:147:9 - ERROR mismatched input 'candidateIds' expecting '}' 
[warn] ⚠  firestore.rules:152:1 - ERROR Unexpected '}'. 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2024-01-04T22:39:08.141Z] >>> [apiv2][query] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules [none]
[debug] [2024-01-04T22:39:08.141Z] >>> [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    // Other rules...\n    function isValidPhoneNumber(phone) {\n      // Define your custom logic to validate the phone number format\n      // For example, you can use regular expressions to check the format\n      // Replace the following regular expression with your own validation logic\n      return phone.matches(\"^\\\\+\\\\([0-9]+\\\\)#\\\\* [0-9]+$\");\n    }\n    function isValidEmail(email) {\n      // Define your custom logic to validate the email address format\n      // Replace the following regular expression with your own validation logic\n      return email.matches(\"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\\\.[a-zA-Z]{2,}$\");\n    }\n\n    function isValidAddress(address) {\n      // Check if the address has the required fields\n      return address is map &&\n      'addressLines' in address &&\n      'postcode' in address &&\n      'locality' in address &&\n      'regionCode' in address &&\n      address.addressLines is list && address.addressLines.size() >= 2 &&\n      address.addressLines[0] is string && \n      address.addressLines[1] is string &&\n      address.addressLines[0].size() >= 1 &&\n      address.addressLines[1].size() >= 1 &&\n      address.addressLines[0].size() <= 255 &&\n      address.addressLines[1].size() <= 255 &&\n      address.postcode is string &&\n      address.locality is string &&\n      address.regionCode is string && address.regionCode.size() == 2;\n    }\n    function isUserAdmin(uid) {\n      return get(/databases/$(database)/documents/users/$(uid)).data.role.hasAny(['admin']);\n    }\n    function isValidDOB(dob) {\n      // Define your custom logic to validate the date of birth format\n      // This is a basic example, you might want to adjust it based on your needs\n      return dob.matches(\"^\\\\d{4}-\\\\d{2}-\\\\d{2}$\");\n    }\n    function isValidFirstName(firstName) {\n      // Define your custom logic to validate the first name\n      // This is a basic example; adjust it based on your needs\n      return firstName is string && firstName.length > 0 && firstName.length < 255;\n    }\n\n    function isValidLastName(lastName) {\n      // Define your custom logic to validate the last name\n      // This is a basic example; adjust it based on your needs\n      return lastName is string && lastName.length > 0 && firstName.length < 255;\n    }\n    // User document rules\n    match /user/{userId} {\n      allow read, write: if request.auth != null && request.auth.uid == userId\n        && request.resource.data.keys().hasAll(['email', 'firstName', 'lastName', 'dob', 'address', 'phone', 'role'])\n        && request.resource.data.email is string // && isValidEmail(request.resource.data.email)\n        && request.resource.data.firstName is string //&& isValidFirstName(firstName)\n        && request.resource.data.lastName is string //&& isValidLastName(lastName)\n        && request.resource.data.dob is string && isValidDOB(request.resource.data.dob)\n        && request.resource.data.address is map && isValidAddress(request.resource.data.address)\n        && request.resource.data.phone is string && isValidPhoneNumber(request.resource.data.phone)\n        && request.resource.data.role is list && request.resource.data.role.size() == 0;\n      allow read, write: if isUserAdmin(request.auth.uid);\n    }\n\n    // Rules for /election/{electionId} path\n    match /election/{electionId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidElectionData(request.resource.data);\n\n      // Function to check if the election data is valid\n      function isValidElectionData(data) {\n        return data != null &&\n        data.keys().hasAll(['startTime', 'endTime', 'title']) &&\n        data.startTime is timestamp &&\n        data.endTime is timestamp &&\n        data.title is string &&\n        // Add additional conditions for start time, end time, and title as needed\n        isValidStartTime(data.startTime) &&\n        isValidEndTime(data.endTime) &&\n        isValidTitle(data.title);\n      }\n\n      // Function to check if the start time is valid (customize as needed)\n      function isValidStartTime(startTime) {\n        // Add your specific logic for validating the start time\n        return startTime != null && startTime.toMillis() > now();\n      }\n\n      // Function to check if the end time is valid (customize as needed)\n      function isValidEndTime(endTime) {\n        // Add your specific logic for validating the end time\n        return endTime != null && endTime.toMillis() > now();\n      }\n\n      // Function to check if the title is valid (customize as needed)\n      function isValidTitle(title) {\n        // Add your specific logic for validating the title\n        return title != null && title.matches(\"^[a-zA-Z0-9 ]+$\"); // Example: Alphanumeric with spaces\n      }\n    }\n\n    // Rules for /election/{electionId}/candidate/{candidateId} path\n    match /election/{electionId}/candidate/{candidateId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidCandidateData(request.resource.data);\n\n      // Function to check if the candidate data is valid\n      function isValidCandidateData(data) {\n        return data != null &&\n        data.keys().hasAll(['name', 'description']) &&\n        data.name is string &&\n        data.description is string;\n      }\n    }\n\n    // Rules for /election/{electionId}/vote/{userId} path\n    match /election/{electionId}/vote/{userId} {\n      allow read: if request.auth != null && request.auth.uid == userId; // Allow the user to read their own vote\n\n      allow write: if request.auth != null && isUserAdmin(request.auth.uid) &&\n      isValidVoteData(request.resource.data);\n\n      // Function to check if the vote data is valid\n      function isValidVoteData(data) {\n        return data != null &&\n        data.keys().hasAll(['candidateIds']) &&\n        data.candidateIds is list &&\n        isValidCandidateIds(data.candidateIds);\n        // Add additional conditions if needed (e.g., checking if the candidateIds are valid)\n      }\n\n      // Function to check if the candidateIds are valid\n      function isValidCandidateIds(candidateIds) {\n        // Add your specific logic for validating the list of candidateIds\n        // For example, ensure that each candidateId is a string\n        return candidateIds is list &&\n        candidateIds.size() > 0 ;\n        // &&\n        candidateIds.every(candidateId => candidateId is string);\n      }\n    }\n\n  }\n}\n"}]}}
[debug] [2024-01-04T22:39:08.171Z] Jan 04, 2024 10:39:08 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:39:08 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2024-01-04T22:39:08.255Z] <<< [apiv2][status] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules 200
[debug] [2024-01-04T22:39:08.255Z] <<< [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":147,"column":9,"currentOffset":6542,"endOffset":6553},"description":"mismatched input 'candidateIds' expecting '}'","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":152,"column":1,"currentOffset":6619,"endOffset":6619},"description":"Unexpected '}'.","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:147:9 - ERROR mismatched input 'candidateIds' expecting '}' 
[warn] ⚠  firestore.rules:152:1 - ERROR Unexpected '}'. 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2024-01-04T22:39:47.469Z] >>> [apiv2][query] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules [none]
[debug] [2024-01-04T22:39:47.469Z] >>> [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    // Other rules...\n    function isValidPhoneNumber(phone) {\n      // Define your custom logic to validate the phone number format\n      // For example, you can use regular expressions to check the format\n      // Replace the following regular expression with your own validation logic\n      return phone.matches(\"^\\\\+\\\\([0-9]+\\\\)#\\\\* [0-9]+$\");\n    }\n    function isValidEmail(email) {\n      // Define your custom logic to validate the email address format\n      // Replace the following regular expression with your own validation logic\n      return email.matches(\"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\\\.[a-zA-Z]{2,}$\");\n    }\n\n    function isValidAddress(address) {\n      // Check if the address has the required fields\n      return address is map &&\n      'addressLines' in address &&\n      'postcode' in address &&\n      'locality' in address &&\n      'regionCode' in address &&\n      address.addressLines is list && address.addressLines.size() >= 2 &&\n      address.addressLines[0] is string && \n      address.addressLines[1] is string &&\n      address.addressLines[0].size() >= 1 &&\n      address.addressLines[1].size() >= 1 &&\n      address.addressLines[0].size() <= 255 &&\n      address.addressLines[1].size() <= 255 &&\n      address.postcode is string &&\n      address.locality is string &&\n      address.regionCode is string && address.regionCode.size() == 2;\n    }\n    function isUserAdmin(uid) {\n      return get(/databases/$(database)/documents/users/$(uid)).data.role.hasAny(['admin']);\n    }\n    function isValidDOB(dob) {\n      // Define your custom logic to validate the date of birth format\n      // This is a basic example, you might want to adjust it based on your needs\n      return dob.matches(\"^\\\\d{4}-\\\\d{2}-\\\\d{2}$\");\n    }\n    function isValidFirstName(firstName) {\n      // Define your custom logic to validate the first name\n      // This is a basic example; adjust it based on your needs\n      return firstName is string && firstName.length > 0 && firstName.length < 255;\n    }\n\n    function isValidLastName(lastName) {\n      // Define your custom logic to validate the last name\n      // This is a basic example; adjust it based on your needs\n      return lastName is string && lastName.length > 0 && firstName.length < 255;\n    }\n    // User document rules\n    match /user/{userId} {\n      allow read, write: if request.auth != null && request.auth.uid == userId\n        && request.resource.data.keys().hasAll(['email', 'firstName', 'lastName', 'dob', 'address', 'phone', 'role'])\n        && request.resource.data.email is string // && isValidEmail(request.resource.data.email)\n        && request.resource.data.firstName is string //&& isValidFirstName(firstName)\n        && request.resource.data.lastName is string //&& isValidLastName(lastName)\n        && request.resource.data.dob is string && isValidDOB(request.resource.data.dob)\n        && request.resource.data.address is map && isValidAddress(request.resource.data.address)\n        && request.resource.data.phone is string && isValidPhoneNumber(request.resource.data.phone)\n        && request.resource.data.role is list && request.resource.data.role.size() == 0;\n      allow read, write: if isUserAdmin(request.auth.uid);\n    }\n\n    // Rules for /election/{electionId} path\n    match /election/{electionId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidElectionData(request.resource.data);\n\n      // Function to check if the election data is valid\n      function isValidElectionData(data) {\n        return data != null &&\n        data.keys().hasAll(['startTime', 'endTime', 'title']) &&\n        data.startTime is timestamp &&\n        data.endTime is timestamp &&\n        data.title is string &&\n        // Add additional conditions for start time, end time, and title as needed\n        isValidStartTime(data.startTime) &&\n        isValidEndTime(data.endTime) &&\n        isValidTitle(data.title);\n      }\n\n      // Function to check if the start time is valid (customize as needed)\n      function isValidStartTime(startTime) {\n        // Add your specific logic for validating the start time\n        return startTime != null && startTime.toMillis() > now();\n      }\n\n      // Function to check if the end time is valid (customize as needed)\n      function isValidEndTime(endTime) {\n        // Add your specific logic for validating the end time\n        return endTime != null && endTime.toMillis() > now();\n      }\n\n      // Function to check if the title is valid (customize as needed)\n      function isValidTitle(title) {\n        // Add your specific logic for validating the title\n        return title != null && title.matches(\"^[a-zA-Z0-9 ]+$\"); // Example: Alphanumeric with spaces\n      }\n    }\n\n    // Rules for /election/{electionId}/candidate/{candidateId} path\n    match /election/{electionId}/candidate/{candidateId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidCandidateData(request.resource.data);\n\n      // Function to check if the candidate data is valid\n      function isValidCandidateData(data) {\n        return data != null &&\n        data.keys().hasAll(['name', 'description']) &&\n        data.name is string &&\n        data.description is string;\n      }\n    }\n\n    // Rules for /election/{electionId}/vote/{userId} path\n    match /election/{electionId}/vote/{userId} {\n      allow read: if request.auth != null && request.auth.uid == userId; // Allow the user to read their own vote\n\n      allow write: if request.auth != null && isUserAdmin(request.auth.uid) &&\n      isValidVoteData(request.resource.data);\n\n      // Function to check if the vote data is valid\n      function isValidVoteData(data) {\n        return data != null &&\n        data.keys().hasAll(['candidateIds']) &&\n        data.candidateIds is list &&\n        isValidCandidateIds(data.candidateIds);\n        // Add additional conditions if needed (e.g., checking if the candidateIds are valid)\n      }\n\n      // Function to check if the candidateIds are valid\n      function isValidCandidateIds(candidateIds) {\n  // Add your specific logic for validating the list of candidateIds\n  // For example, ensure that each candidateId is a string\n  return candidateIds is list &&\n    candidateIds.size() > 0 &&\n    candidateIds.every(candidateId => candidateId is string);\n}\n    }\n\n  }\n}\n"}]}}
[debug] [2024-01-04T22:39:47.471Z] Jan 04, 2024 10:39:47 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:39:47 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2024-01-04T22:39:47.508Z] <<< [apiv2][status] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules 200
[debug] [2024-01-04T22:39:47.508Z] <<< [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":146,"column":36,"currentOffset":6534,"endOffset":6534},"description":"Unexpected '='.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":146,"column":60,"currentOffset":6558,"endOffset":6558},"description":"mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":151,"column":1,"currentOffset":6574,"endOffset":6574},"description":"Unexpected '}'.","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:146:36 - ERROR Unexpected '='. 
[warn] ⚠  firestore.rules:146:60 - ERROR mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'} 
[warn] ⚠  firestore.rules:151:1 - ERROR Unexpected '}'. 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2024-01-04T22:39:52.531Z] >>> [apiv2][query] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules [none]
[debug] [2024-01-04T22:39:52.531Z] >>> [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    // Other rules...\n    function isValidPhoneNumber(phone) {\n      // Define your custom logic to validate the phone number format\n      // For example, you can use regular expressions to check the format\n      // Replace the following regular expression with your own validation logic\n      return phone.matches(\"^\\\\+\\\\([0-9]+\\\\)#\\\\* [0-9]+$\");\n    }\n    function isValidEmail(email) {\n      // Define your custom logic to validate the email address format\n      // Replace the following regular expression with your own validation logic\n      return email.matches(\"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\\\.[a-zA-Z]{2,}$\");\n    }\n\n    function isValidAddress(address) {\n      // Check if the address has the required fields\n      return address is map &&\n      'addressLines' in address &&\n      'postcode' in address &&\n      'locality' in address &&\n      'regionCode' in address &&\n      address.addressLines is list && address.addressLines.size() >= 2 &&\n      address.addressLines[0] is string && \n      address.addressLines[1] is string &&\n      address.addressLines[0].size() >= 1 &&\n      address.addressLines[1].size() >= 1 &&\n      address.addressLines[0].size() <= 255 &&\n      address.addressLines[1].size() <= 255 &&\n      address.postcode is string &&\n      address.locality is string &&\n      address.regionCode is string && address.regionCode.size() == 2;\n    }\n    function isUserAdmin(uid) {\n      return get(/databases/$(database)/documents/users/$(uid)).data.role.hasAny(['admin']);\n    }\n    function isValidDOB(dob) {\n      // Define your custom logic to validate the date of birth format\n      // This is a basic example, you might want to adjust it based on your needs\n      return dob.matches(\"^\\\\d{4}-\\\\d{2}-\\\\d{2}$\");\n    }\n    function isValidFirstName(firstName) {\n      // Define your custom logic to validate the first name\n      // This is a basic example; adjust it based on your needs\n      return firstName is string && firstName.length > 0 && firstName.length < 255;\n    }\n\n    function isValidLastName(lastName) {\n      // Define your custom logic to validate the last name\n      // This is a basic example; adjust it based on your needs\n      return lastName is string && lastName.length > 0 && firstName.length < 255;\n    }\n    // User document rules\n    match /user/{userId} {\n      allow read, write: if request.auth != null && request.auth.uid == userId\n        && request.resource.data.keys().hasAll(['email', 'firstName', 'lastName', 'dob', 'address', 'phone', 'role'])\n        && request.resource.data.email is string // && isValidEmail(request.resource.data.email)\n        && request.resource.data.firstName is string //&& isValidFirstName(firstName)\n        && request.resource.data.lastName is string //&& isValidLastName(lastName)\n        && request.resource.data.dob is string && isValidDOB(request.resource.data.dob)\n        && request.resource.data.address is map && isValidAddress(request.resource.data.address)\n        && request.resource.data.phone is string && isValidPhoneNumber(request.resource.data.phone)\n        && request.resource.data.role is list && request.resource.data.role.size() == 0;\n      allow read, write: if isUserAdmin(request.auth.uid);\n    }\n\n    // Rules for /election/{electionId} path\n    match /election/{electionId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidElectionData(request.resource.data);\n\n      // Function to check if the election data is valid\n      function isValidElectionData(data) {\n        return data != null &&\n        data.keys().hasAll(['startTime', 'endTime', 'title']) &&\n        data.startTime is timestamp &&\n        data.endTime is timestamp &&\n        data.title is string &&\n        // Add additional conditions for start time, end time, and title as needed\n        isValidStartTime(data.startTime) &&\n        isValidEndTime(data.endTime) &&\n        isValidTitle(data.title);\n      }\n\n      // Function to check if the start time is valid (customize as needed)\n      function isValidStartTime(startTime) {\n        // Add your specific logic for validating the start time\n        return startTime != null && startTime.toMillis() > now();\n      }\n\n      // Function to check if the end time is valid (customize as needed)\n      function isValidEndTime(endTime) {\n        // Add your specific logic for validating the end time\n        return endTime != null && endTime.toMillis() > now();\n      }\n\n      // Function to check if the title is valid (customize as needed)\n      function isValidTitle(title) {\n        // Add your specific logic for validating the title\n        return title != null && title.matches(\"^[a-zA-Z0-9 ]+$\"); // Example: Alphanumeric with spaces\n      }\n    }\n\n    // Rules for /election/{electionId}/candidate/{candidateId} path\n    match /election/{electionId}/candidate/{candidateId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidCandidateData(request.resource.data);\n\n      // Function to check if the candidate data is valid\n      function isValidCandidateData(data) {\n        return data != null &&\n        data.keys().hasAll(['name', 'description']) &&\n        data.name is string &&\n        data.description is string;\n      }\n    }\n\n    // Rules for /election/{electionId}/vote/{userId} path\n    match /election/{electionId}/vote/{userId} {\n      allow read: if request.auth != null && request.auth.uid == userId; // Allow the user to read their own vote\n\n      allow write: if request.auth != null && isUserAdmin(request.auth.uid) &&\n      isValidVoteData(request.resource.data);\n\n      // Function to check if the vote data is valid\n      function isValidVoteData(data) {\n        return data != null &&\n        data.keys().hasAll(['candidateIds']) &&\n        data.candidateIds is list &&\n        isValidCandidateIds(data.candidateIds);\n        // Add additional conditions if needed (e.g., checking if the candidateIds are valid)\n      }\n\n      // Function to check if the candidateIds are valid\n      function isValidCandidateIds(candidateIds) {\n  // Add your specific logic for validating the list of candidateIds\n  // For example, ensure that each candidateId is a string\n  return candidateIds is list &&\n    candidateIds.size() > 0 &&\n    candidateIds.every(candidateId => candidateId is string);\n}\n    }\n\n  }\n}\n"}]}}
[debug] [2024-01-04T22:39:52.538Z] Jan 04, 2024 10:39:52 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:39:52 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2024-01-04T22:39:52.641Z] <<< [apiv2][status] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules 200
[debug] [2024-01-04T22:39:52.642Z] <<< [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":146,"column":36,"currentOffset":6534,"endOffset":6534},"description":"Unexpected '='.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":146,"column":60,"currentOffset":6558,"endOffset":6558},"description":"mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":151,"column":1,"currentOffset":6574,"endOffset":6574},"description":"Unexpected '}'.","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:146:36 - ERROR Unexpected '='. 
[warn] ⚠  firestore.rules:146:60 - ERROR mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'} 
[warn] ⚠  firestore.rules:151:1 - ERROR Unexpected '}'. 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2024-01-04T22:39:53.261Z] >>> [apiv2][query] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules [none]
[debug] [2024-01-04T22:39:53.261Z] >>> [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    // Other rules...\n    function isValidPhoneNumber(phone) {\n      // Define your custom logic to validate the phone number format\n      // For example, you can use regular expressions to check the format\n      // Replace the following regular expression with your own validation logic\n      return phone.matches(\"^\\\\+\\\\([0-9]+\\\\)#\\\\* [0-9]+$\");\n    }\n    function isValidEmail(email) {\n      // Define your custom logic to validate the email address format\n      // Replace the following regular expression with your own validation logic\n      return email.matches(\"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\\\.[a-zA-Z]{2,}$\");\n    }\n\n    function isValidAddress(address) {\n      // Check if the address has the required fields\n      return address is map &&\n      'addressLines' in address &&\n      'postcode' in address &&\n      'locality' in address &&\n      'regionCode' in address &&\n      address.addressLines is list && address.addressLines.size() >= 2 &&\n      address.addressLines[0] is string && \n      address.addressLines[1] is string &&\n      address.addressLines[0].size() >= 1 &&\n      address.addressLines[1].size() >= 1 &&\n      address.addressLines[0].size() <= 255 &&\n      address.addressLines[1].size() <= 255 &&\n      address.postcode is string &&\n      address.locality is string &&\n      address.regionCode is string && address.regionCode.size() == 2;\n    }\n    function isUserAdmin(uid) {\n      return get(/databases/$(database)/documents/users/$(uid)).data.role.hasAny(['admin']);\n    }\n    function isValidDOB(dob) {\n      // Define your custom logic to validate the date of birth format\n      // This is a basic example, you might want to adjust it based on your needs\n      return dob.matches(\"^\\\\d{4}-\\\\d{2}-\\\\d{2}$\");\n    }\n    function isValidFirstName(firstName) {\n      // Define your custom logic to validate the first name\n      // This is a basic example; adjust it based on your needs\n      return firstName is string && firstName.length > 0 && firstName.length < 255;\n    }\n\n    function isValidLastName(lastName) {\n      // Define your custom logic to validate the last name\n      // This is a basic example; adjust it based on your needs\n      return lastName is string && lastName.length > 0 && firstName.length < 255;\n    }\n    // User document rules\n    match /user/{userId} {\n      allow read, write: if request.auth != null && request.auth.uid == userId\n        && request.resource.data.keys().hasAll(['email', 'firstName', 'lastName', 'dob', 'address', 'phone', 'role'])\n        && request.resource.data.email is string // && isValidEmail(request.resource.data.email)\n        && request.resource.data.firstName is string //&& isValidFirstName(firstName)\n        && request.resource.data.lastName is string //&& isValidLastName(lastName)\n        && request.resource.data.dob is string && isValidDOB(request.resource.data.dob)\n        && request.resource.data.address is map && isValidAddress(request.resource.data.address)\n        && request.resource.data.phone is string && isValidPhoneNumber(request.resource.data.phone)\n        && request.resource.data.role is list && request.resource.data.role.size() == 0;\n      allow read, write: if isUserAdmin(request.auth.uid);\n    }\n\n    // Rules for /election/{electionId} path\n    match /election/{electionId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidElectionData(request.resource.data);\n\n      // Function to check if the election data is valid\n      function isValidElectionData(data) {\n        return data != null &&\n        data.keys().hasAll(['startTime', 'endTime', 'title']) &&\n        data.startTime is timestamp &&\n        data.endTime is timestamp &&\n        data.title is string &&\n        // Add additional conditions for start time, end time, and title as needed\n        isValidStartTime(data.startTime) &&\n        isValidEndTime(data.endTime) &&\n        isValidTitle(data.title);\n      }\n\n      // Function to check if the start time is valid (customize as needed)\n      function isValidStartTime(startTime) {\n        // Add your specific logic for validating the start time\n        return startTime != null && startTime.toMillis() > now();\n      }\n\n      // Function to check if the end time is valid (customize as needed)\n      function isValidEndTime(endTime) {\n        // Add your specific logic for validating the end time\n        return endTime != null && endTime.toMillis() > now();\n      }\n\n      // Function to check if the title is valid (customize as needed)\n      function isValidTitle(title) {\n        // Add your specific logic for validating the title\n        return title != null && title.matches(\"^[a-zA-Z0-9 ]+$\"); // Example: Alphanumeric with spaces\n      }\n    }\n\n    // Rules for /election/{electionId}/candidate/{candidateId} path\n    match /election/{electionId}/candidate/{candidateId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidCandidateData(request.resource.data);\n\n      // Function to check if the candidate data is valid\n      function isValidCandidateData(data) {\n        return data != null &&\n        data.keys().hasAll(['name', 'description']) &&\n        data.name is string &&\n        data.description is string;\n      }\n    }\n\n    // Rules for /election/{electionId}/vote/{userId} path\n    match /election/{electionId}/vote/{userId} {\n      allow read: if request.auth != null && request.auth.uid == userId; // Allow the user to read their own vote\n\n      allow write: if request.auth != null && isUserAdmin(request.auth.uid) &&\n      isValidVoteData(request.resource.data);\n\n      // Function to check if the vote data is valid\n      function isValidVoteData(data) {\n        return data != null &&\n        data.keys().hasAll(['candidateIds']) &&\n        data.candidateIds is list &&\n        isValidCandidateIds(data.candidateIds);\n        // Add additional conditions if needed (e.g., checking if the candidateIds are valid)\n      }\n\n      // Function to check if the candidateIds are valid\n      function isValidCandidateIds(candidateIds) {\n  // Add your specific logic for validating the list of candidateIds\n  // For example, ensure that each candidateId is a string\n  return candidateIds is list &&\n    candidateIds.size() > 0 &&\n    candidateIds.every(candidateId => candidateId is string);\n}\n    }\n\n  }\n}\n"}]}}
[debug] [2024-01-04T22:39:53.263Z] Jan 04, 2024 10:39:53 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:39:53 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2024-01-04T22:39:53.297Z] <<< [apiv2][status] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules 200
[debug] [2024-01-04T22:39:53.298Z] <<< [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":146,"column":36,"currentOffset":6534,"endOffset":6534},"description":"Unexpected '='.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":146,"column":60,"currentOffset":6558,"endOffset":6558},"description":"mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":151,"column":1,"currentOffset":6574,"endOffset":6574},"description":"Unexpected '}'.","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:146:36 - ERROR Unexpected '='. 
[warn] ⚠  firestore.rules:146:60 - ERROR mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'} 
[warn] ⚠  firestore.rules:151:1 - ERROR Unexpected '}'. 
[info] ✔  firestore: Rules updated. 
[debug] [2024-01-04T22:40:00.959Z] Jan 04, 2024 10:40:00 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:40:00 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[info] i  firestore: Change detected, updating rules... 
[debug] [2024-01-04T22:40:22.092Z] >>> [apiv2][query] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules [none]
[debug] [2024-01-04T22:40:22.092Z] >>> [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    // Other rules...\n    function isValidPhoneNumber(phone) {\n      // Define your custom logic to validate the phone number format\n      // For example, you can use regular expressions to check the format\n      // Replace the following regular expression with your own validation logic\n      return phone.matches(\"^\\\\+\\\\([0-9]+\\\\)#\\\\* [0-9]+$\");\n    }\n    function isValidEmail(email) {\n      // Define your custom logic to validate the email address format\n      // Replace the following regular expression with your own validation logic\n      return email.matches(\"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\\\.[a-zA-Z]{2,}$\");\n    }\n\n    function isValidAddress(address) {\n      // Check if the address has the required fields\n      return address is map &&\n      'addressLines' in address &&\n      'postcode' in address &&\n      'locality' in address &&\n      'regionCode' in address &&\n      address.addressLines is list && address.addressLines.size() >= 2 &&\n      address.addressLines[0] is string && \n      address.addressLines[1] is string &&\n      address.addressLines[0].size() >= 1 &&\n      address.addressLines[1].size() >= 1 &&\n      address.addressLines[0].size() <= 255 &&\n      address.addressLines[1].size() <= 255 &&\n      address.postcode is string &&\n      address.locality is string &&\n      address.regionCode is string && address.regionCode.size() == 2;\n    }\n    function isUserAdmin(uid) {\n      return get(/databases/$(database)/documents/users/$(uid)).data.role.hasAny(['admin']);\n    }\n    function isValidDOB(dob) {\n      // Define your custom logic to validate the date of birth format\n      // This is a basic example, you might want to adjust it based on your needs\n      return dob.matches(\"^\\\\d{4}-\\\\d{2}-\\\\d{2}$\");\n    }\n    function isValidFirstName(firstName) {\n      // Define your custom logic to validate the first name\n      // This is a basic example; adjust it based on your needs\n      return firstName is string && firstName.length > 0 && firstName.length < 255;\n    }\n\n    function isValidLastName(lastName) {\n      // Define your custom logic to validate the last name\n      // This is a basic example; adjust it based on your needs\n      return lastName is string && lastName.length > 0 && firstName.length < 255;\n    }\n    // User document rules\n    match /user/{userId} {\n      allow read, write: if request.auth != null && request.auth.uid == userId\n        && request.resource.data.keys().hasAll(['email', 'firstName', 'lastName', 'dob', 'address', 'phone', 'role'])\n        && request.resource.data.email is string // && isValidEmail(request.resource.data.email)\n        && request.resource.data.firstName is string //&& isValidFirstName(firstName)\n        && request.resource.data.lastName is string //&& isValidLastName(lastName)\n        && request.resource.data.dob is string && isValidDOB(request.resource.data.dob)\n        && request.resource.data.address is map && isValidAddress(request.resource.data.address)\n        && request.resource.data.phone is string && isValidPhoneNumber(request.resource.data.phone)\n        && request.resource.data.role is list && request.resource.data.role.size() == 0;\n      allow read, write: if isUserAdmin(request.auth.uid);\n    }\n\n    // Rules for /election/{electionId} path\n    match /election/{electionId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidElectionData(request.resource.data);\n\n      // Function to check if the election data is valid\n      function isValidElectionData(data) {\n        return data != null &&\n        data.keys().hasAll(['startTime', 'endTime', 'title']) &&\n        data.startTime is timestamp &&\n        data.endTime is timestamp &&\n        data.title is string &&\n        // Add additional conditions for start time, end time, and title as needed\n        isValidStartTime(data.startTime) &&\n        isValidEndTime(data.endTime) &&\n        isValidTitle(data.title);\n      }\n\n      // Function to check if the start time is valid (customize as needed)\n      function isValidStartTime(startTime) {\n        // Add your specific logic for validating the start time\n        return startTime != null && startTime.toMillis() > now();\n      }\n\n      // Function to check if the end time is valid (customize as needed)\n      function isValidEndTime(endTime) {\n        // Add your specific logic for validating the end time\n        return endTime != null && endTime.toMillis() > now();\n      }\n\n      // Function to check if the title is valid (customize as needed)\n      function isValidTitle(title) {\n        // Add your specific logic for validating the title\n        return title != null && title.matches(\"^[a-zA-Z0-9 ]+$\"); // Example: Alphanumeric with spaces\n      }\n    }\n\n    // Rules for /election/{electionId}/candidate/{candidateId} path\n    match /election/{electionId}/candidate/{candidateId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidCandidateData(request.resource.data);\n\n      // Function to check if the candidate data is valid\n      function isValidCandidateData(data) {\n        return data != null &&\n        data.keys().hasAll(['name', 'description']) &&\n        data.name is string &&\n        data.description is string;\n      }\n    }\n\n    // Rules for /election/{electionId}/vote/{userId} path\n    match /election/{electionId}/vote/{userId} {\n      allow read: if request.auth != null && request.auth.uid == userId; // Allow the user to read their own vote\n\n      allow write: if request.auth != null && isUserAdmin(request.auth.uid) &&\n      isValidVoteData(request.resource.data);\n\n      // Function to check if the vote data is valid\n      function isValidVoteData(data) {\n        return data != null &&\n        data.keys().hasAll(['candidateIds']) &&\n        data.candidateIds is list &&\n        isValidCandidateIds(data.candidateIds);\n        // Add additional conditions if needed (e.g., checking if the candidateIds are valid)\n      }\n\n      // Function to check if the candidateIds are valid\n      function isValidCandidateIds(candidateIds) {\n  // Add your specific logic for validating the list of candidateIds\n  // For example, ensure that each candidateId is a string\n  return candidateIds is list &&\n    candidateIds.size() > 0 &&\n    candidateIds.every(candidateId => candidateId is string);\n}\n    }\n\n  }\n}\n"}]}}
[debug] [2024-01-04T22:40:22.100Z] Jan 04, 2024 10:40:22 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:40:22 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2024-01-04T22:40:22.212Z] <<< [apiv2][status] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules 200
[debug] [2024-01-04T22:40:22.212Z] <<< [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":146,"column":36,"currentOffset":6534,"endOffset":6534},"description":"Unexpected '='.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":146,"column":60,"currentOffset":6558,"endOffset":6558},"description":"mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":151,"column":1,"currentOffset":6574,"endOffset":6574},"description":"Unexpected '}'.","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:146:36 - ERROR Unexpected '='. 
[warn] ⚠  firestore.rules:146:60 - ERROR mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'} 
[warn] ⚠  firestore.rules:151:1 - ERROR Unexpected '}'. 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2024-01-04T22:40:45.943Z] >>> [apiv2][query] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules [none]
[debug] [2024-01-04T22:40:45.944Z] >>> [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    // Other rules...\n    function isValidPhoneNumber(phone) {\n      // Define your custom logic to validate the phone number format\n      // For example, you can use regular expressions to check the format\n      // Replace the following regular expression with your own validation logic\n      return phone.matches(\"^\\\\+\\\\([0-9]+\\\\)#\\\\* [0-9]+$\");\n    }\n    function isValidEmail(email) {\n      // Define your custom logic to validate the email address format\n      // Replace the following regular expression with your own validation logic\n      return email.matches(\"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\\\.[a-zA-Z]{2,}$\");\n    }\n\n    function isValidAddress(address) {\n      // Check if the address has the required fields\n      return address is map &&\n      'addressLines' in address &&\n      'postcode' in address &&\n      'locality' in address &&\n      'regionCode' in address &&\n      address.addressLines is list && address.addressLines.size() >= 2 &&\n      address.addressLines[0] is string && \n      address.addressLines[1] is string &&\n      address.addressLines[0].size() >= 1 &&\n      address.addressLines[1].size() >= 1 &&\n      address.addressLines[0].size() <= 255 &&\n      address.addressLines[1].size() <= 255 &&\n      address.postcode is string &&\n      address.locality is string &&\n      address.regionCode is string && address.regionCode.size() == 2;\n    }\n    function isUserAdmin(uid) {\n      return get(/databases/$(database)/documents/users/$(uid)).data.role.hasAny(['admin']);\n    }\n    function isValidDOB(dob) {\n      // Define your custom logic to validate the date of birth format\n      // This is a basic example, you might want to adjust it based on your needs\n      return dob.matches(\"^\\\\d{4}-\\\\d{2}-\\\\d{2}$\");\n    }\n    function isValidFirstName(firstName) {\n      // Define your custom logic to validate the first name\n      // This is a basic example; adjust it based on your needs\n      return firstName is string && firstName.length > 0 && firstName.length < 255;\n    }\n\n    function isValidLastName(lastName) {\n      // Define your custom logic to validate the last name\n      // This is a basic example; adjust it based on your needs\n      return lastName is string && lastName.length > 0 && firstName.length < 255;\n    }\n    // User document rules\n    match /user/{userId} {\n      allow read, write: if request.auth != null && request.auth.uid == userId\n        && request.resource.data.keys().hasAll(['email', 'firstName', 'lastName', 'dob', 'address', 'phone', 'role'])\n        && request.resource.data.email is string // && isValidEmail(request.resource.data.email)\n        && request.resource.data.firstName is string //&& isValidFirstName(firstName)\n        && request.resource.data.lastName is string //&& isValidLastName(lastName)\n        && request.resource.data.dob is string && isValidDOB(request.resource.data.dob)\n        && request.resource.data.address is map && isValidAddress(request.resource.data.address)\n        && request.resource.data.phone is string && isValidPhoneNumber(request.resource.data.phone)\n        && request.resource.data.role is list && request.resource.data.role.size() == 0;\n      allow read, write: if isUserAdmin(request.auth.uid);\n    }\n\n    // Rules for /election/{electionId} path\n    match /election/{electionId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidElectionData(request.resource.data);\n\n      // Function to check if the election data is valid\n      function isValidElectionData(data) {\n        return data != null &&\n        data.keys().hasAll(['startTime', 'endTime', 'title']) &&\n        data.startTime is timestamp &&\n        data.endTime is timestamp &&\n        data.title is string &&\n        // Add additional conditions for start time, end time, and title as needed\n        isValidStartTime(data.startTime) &&\n        isValidEndTime(data.endTime) &&\n        isValidTitle(data.title);\n      }\n\n      // Function to check if the start time is valid (customize as needed)\n      function isValidStartTime(startTime) {\n        // Add your specific logic for validating the start time\n        return startTime != null && startTime.toMillis() > now();\n      }\n\n      // Function to check if the end time is valid (customize as needed)\n      function isValidEndTime(endTime) {\n        // Add your specific logic for validating the end time\n        return endTime != null && endTime.toMillis() > now();\n      }\n\n      // Function to check if the title is valid (customize as needed)\n      function isValidTitle(title) {\n        // Add your specific logic for validating the title\n        return title != null && title.matches(\"^[a-zA-Z0-9 ]+$\"); // Example: Alphanumeric with spaces\n      }\n    }\n\n    // Rules for /election/{electionId}/candidate/{candidateId} path\n    match /election/{electionId}/candidate/{candidateId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidCandidateData(request.resource.data);\n\n      // Function to check if the candidate data is valid\n      function isValidCandidateData(data) {\n        return data != null &&\n        data.keys().hasAll(['name', 'description']) &&\n        data.name is string &&\n        data.description is string;\n      }\n    }\n\n    // Rules for /election/{electionId}/vote/{userId} path\n    match /election/{electionId}/vote/{userId} {\n      allow read: if request.auth != null && request.auth.uid == userId; // Allow the user to read their own vote\n\n      allow write: if request.auth != null && isUserAdmin(request.auth.uid) &&\n      isValidVoteData(request.resource.data);\n\n      // Function to check if the vote data is valid\n      function isValidVoteData(data) {\n        return data != null &&\n        data.keys().hasAll(['candidateIds']) &&\n        data.candidateIds is list &&\n        isValidCandidateIds(data.candidateIds);\n        // Add additional conditions if needed (e.g., checking if the candidateIds are valid)\n      }\n\n      // Function to check if the candidateIds are valid\n      function isValidCandidateIds(candidateIds) {\n  // Add your specific logic for validating the list of candidateIds\n  // For example, ensure that each candidateId is a string\n  return candidateIds is list &&\n    candidateIds.size() > 0 &&\n    candidateIds.every(candidateId => (candidateId is string));\n}\n    }\n\n  }\n}\n"}]}}
[debug] [2024-01-04T22:40:45.946Z] Jan 04, 2024 10:40:45 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:40:45 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2024-01-04T22:40:45.982Z] <<< [apiv2][status] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules 200
[debug] [2024-01-04T22:40:45.983Z] <<< [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":146,"column":36,"currentOffset":6534,"endOffset":6534},"description":"Unexpected '='.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":146,"column":62,"currentOffset":6560,"endOffset":6560},"description":"mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', ')', '/', '*', '?', 'in', 'is'}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":151,"column":1,"currentOffset":6576,"endOffset":6576},"description":"Unexpected '}'.","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:146:36 - ERROR Unexpected '='. 
[warn] ⚠  firestore.rules:146:62 - ERROR mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', ')', '/', '*', '?', 'in', 'is'} 
[warn] ⚠  firestore.rules:151:1 - ERROR Unexpected '}'. 
[info] ✔  firestore: Rules updated. 
[debug] [2024-01-04T22:40:47.076Z] Jan 04, 2024 10:40:47 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:40:47 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[info] i  firestore: Change detected, updating rules... 
[debug] [2024-01-04T22:40:47.258Z] >>> [apiv2][query] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules [none]
[debug] [2024-01-04T22:40:47.259Z] >>> [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    // Other rules...\n    function isValidPhoneNumber(phone) {\n      // Define your custom logic to validate the phone number format\n      // For example, you can use regular expressions to check the format\n      // Replace the following regular expression with your own validation logic\n      return phone.matches(\"^\\\\+\\\\([0-9]+\\\\)#\\\\* [0-9]+$\");\n    }\n    function isValidEmail(email) {\n      // Define your custom logic to validate the email address format\n      // Replace the following regular expression with your own validation logic\n      return email.matches(\"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\\\.[a-zA-Z]{2,}$\");\n    }\n\n    function isValidAddress(address) {\n      // Check if the address has the required fields\n      return address is map &&\n      'addressLines' in address &&\n      'postcode' in address &&\n      'locality' in address &&\n      'regionCode' in address &&\n      address.addressLines is list && address.addressLines.size() >= 2 &&\n      address.addressLines[0] is string && \n      address.addressLines[1] is string &&\n      address.addressLines[0].size() >= 1 &&\n      address.addressLines[1].size() >= 1 &&\n      address.addressLines[0].size() <= 255 &&\n      address.addressLines[1].size() <= 255 &&\n      address.postcode is string &&\n      address.locality is string &&\n      address.regionCode is string && address.regionCode.size() == 2;\n    }\n    function isUserAdmin(uid) {\n      return get(/databases/$(database)/documents/users/$(uid)).data.role.hasAny(['admin']);\n    }\n    function isValidDOB(dob) {\n      // Define your custom logic to validate the date of birth format\n      // This is a basic example, you might want to adjust it based on your needs\n      return dob.matches(\"^\\\\d{4}-\\\\d{2}-\\\\d{2}$\");\n    }\n    function isValidFirstName(firstName) {\n      // Define your custom logic to validate the first name\n      // This is a basic example; adjust it based on your needs\n      return firstName is string && firstName.length > 0 && firstName.length < 255;\n    }\n\n    function isValidLastName(lastName) {\n      // Define your custom logic to validate the last name\n      // This is a basic example; adjust it based on your needs\n      return lastName is string && lastName.length > 0 && firstName.length < 255;\n    }\n    // User document rules\n    match /user/{userId} {\n      allow read, write: if request.auth != null && request.auth.uid == userId\n        && request.resource.data.keys().hasAll(['email', 'firstName', 'lastName', 'dob', 'address', 'phone', 'role'])\n        && request.resource.data.email is string // && isValidEmail(request.resource.data.email)\n        && request.resource.data.firstName is string //&& isValidFirstName(firstName)\n        && request.resource.data.lastName is string //&& isValidLastName(lastName)\n        && request.resource.data.dob is string && isValidDOB(request.resource.data.dob)\n        && request.resource.data.address is map && isValidAddress(request.resource.data.address)\n        && request.resource.data.phone is string && isValidPhoneNumber(request.resource.data.phone)\n        && request.resource.data.role is list && request.resource.data.role.size() == 0;\n      allow read, write: if isUserAdmin(request.auth.uid);\n    }\n\n    // Rules for /election/{electionId} path\n    match /election/{electionId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidElectionData(request.resource.data);\n\n      // Function to check if the election data is valid\n      function isValidElectionData(data) {\n        return data != null &&\n        data.keys().hasAll(['startTime', 'endTime', 'title']) &&\n        data.startTime is timestamp &&\n        data.endTime is timestamp &&\n        data.title is string &&\n        // Add additional conditions for start time, end time, and title as needed\n        isValidStartTime(data.startTime) &&\n        isValidEndTime(data.endTime) &&\n        isValidTitle(data.title);\n      }\n\n      // Function to check if the start time is valid (customize as needed)\n      function isValidStartTime(startTime) {\n        // Add your specific logic for validating the start time\n        return startTime != null && startTime.toMillis() > now();\n      }\n\n      // Function to check if the end time is valid (customize as needed)\n      function isValidEndTime(endTime) {\n        // Add your specific logic for validating the end time\n        return endTime != null && endTime.toMillis() > now();\n      }\n\n      // Function to check if the title is valid (customize as needed)\n      function isValidTitle(title) {\n        // Add your specific logic for validating the title\n        return title != null && title.matches(\"^[a-zA-Z0-9 ]+$\"); // Example: Alphanumeric with spaces\n      }\n    }\n\n    // Rules for /election/{electionId}/candidate/{candidateId} path\n    match /election/{electionId}/candidate/{candidateId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidCandidateData(request.resource.data);\n\n      // Function to check if the candidate data is valid\n      function isValidCandidateData(data) {\n        return data != null &&\n        data.keys().hasAll(['name', 'description']) &&\n        data.name is string &&\n        data.description is string;\n      }\n    }\n\n    // Rules for /election/{electionId}/vote/{userId} path\n    match /election/{electionId}/vote/{userId} {\n      allow read: if request.auth != null && request.auth.uid == userId; // Allow the user to read their own vote\n\n      allow write: if request.auth != null && isUserAdmin(request.auth.uid) &&\n      isValidVoteData(request.resource.data);\n\n      // Function to check if the vote data is valid\n      function isValidVoteData(data) {\n        return data != null &&\n        data.keys().hasAll(['candidateIds']) &&\n        data.candidateIds is list &&\n        isValidCandidateIds(data.candidateIds);\n        // Add additional conditions if needed (e.g., checking if the candidateIds are valid)\n      }\n\n      // Function to check if the candidateIds are valid\n      function isValidCandidateIds(candidateIds) {\n  // Add your specific logic for validating the list of candidateIds\n  // For example, ensure that each candidateId is a string\n  return candidateIds is list &&\n    candidateIds.size() > 0 &&\n    candidateIds.every(candidateId => (candidateId is string));\n}\n    }\n\n  }\n}\n"}]}}
[debug] [2024-01-04T22:40:47.260Z] Jan 04, 2024 10:40:47 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:40:47 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2024-01-04T22:40:47.288Z] <<< [apiv2][status] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules 200
[debug] [2024-01-04T22:40:47.288Z] <<< [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":146,"column":36,"currentOffset":6534,"endOffset":6534},"description":"Unexpected '='.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":146,"column":62,"currentOffset":6560,"endOffset":6560},"description":"mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', ')', '/', '*', '?', 'in', 'is'}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":151,"column":1,"currentOffset":6576,"endOffset":6576},"description":"Unexpected '}'.","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:146:36 - ERROR Unexpected '='. 
[warn] ⚠  firestore.rules:146:62 - ERROR mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', ')', '/', '*', '?', 'in', 'is'} 
[warn] ⚠  firestore.rules:151:1 - ERROR Unexpected '}'. 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2024-01-04T22:41:42.024Z] >>> [apiv2][query] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules [none]
[debug] [2024-01-04T22:41:42.024Z] >>> [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    // Other rules...\n    function isValidPhoneNumber(phone) {\n      // Define your custom logic to validate the phone number format\n      // For example, you can use regular expressions to check the format\n      // Replace the following regular expression with your own validation logic\n      return phone.matches(\"^\\\\+\\\\([0-9]+\\\\)#\\\\* [0-9]+$\");\n    }\n    function isValidEmail(email) {\n      // Define your custom logic to validate the email address format\n      // Replace the following regular expression with your own validation logic\n      return email.matches(\"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\\\.[a-zA-Z]{2,}$\");\n    }\n\n    function isValidAddress(address) {\n      // Check if the address has the required fields\n      return address is map &&\n      'addressLines' in address &&\n      'postcode' in address &&\n      'locality' in address &&\n      'regionCode' in address &&\n      address.addressLines is list && address.addressLines.size() >= 2 &&\n      address.addressLines[0] is string && \n      address.addressLines[1] is string &&\n      address.addressLines[0].size() >= 1 &&\n      address.addressLines[1].size() >= 1 &&\n      address.addressLines[0].size() <= 255 &&\n      address.addressLines[1].size() <= 255 &&\n      address.postcode is string &&\n      address.locality is string &&\n      address.regionCode is string && address.regionCode.size() == 2;\n    }\n    function isUserAdmin(uid) {\n      return get(/databases/$(database)/documents/users/$(uid)).data.role.hasAny(['admin']);\n    }\n    function isValidDOB(dob) {\n      // Define your custom logic to validate the date of birth format\n      // This is a basic example, you might want to adjust it based on your needs\n      return dob.matches(\"^\\\\d{4}-\\\\d{2}-\\\\d{2}$\");\n    }\n    function isValidFirstName(firstName) {\n      // Define your custom logic to validate the first name\n      // This is a basic example; adjust it based on your needs\n      return firstName is string && firstName.length > 0 && firstName.length < 255;\n    }\n\n    function isValidLastName(lastName) {\n      // Define your custom logic to validate the last name\n      // This is a basic example; adjust it based on your needs\n      return lastName is string && lastName.length > 0 && firstName.length < 255;\n    }\n    // User document rules\n    match /user/{userId} {\n      allow read, write: if request.auth != null && request.auth.uid == userId\n        && request.resource.data.keys().hasAll(['email', 'firstName', 'lastName', 'dob', 'address', 'phone', 'role'])\n        && request.resource.data.email is string // && isValidEmail(request.resource.data.email)\n        && request.resource.data.firstName is string //&& isValidFirstName(firstName)\n        && request.resource.data.lastName is string //&& isValidLastName(lastName)\n        && request.resource.data.dob is string && isValidDOB(request.resource.data.dob)\n        && request.resource.data.address is map && isValidAddress(request.resource.data.address)\n        && request.resource.data.phone is string && isValidPhoneNumber(request.resource.data.phone)\n        && request.resource.data.role is list && request.resource.data.role.size() == 0;\n      allow read, write: if isUserAdmin(request.auth.uid);\n    }\n\n    // Rules for /election/{electionId} path\n    match /election/{electionId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidElectionData(request.resource.data);\n\n      // Function to check if the election data is valid\n      function isValidElectionData(data) {\n        return data != null &&\n        data.keys().hasAll(['startTime', 'endTime', 'title']) &&\n        data.startTime is timestamp &&\n        data.endTime is timestamp &&\n        data.title is string &&\n        // Add additional conditions for start time, end time, and title as needed\n        isValidStartTime(data.startTime) &&\n        isValidEndTime(data.endTime) &&\n        isValidTitle(data.title);\n      }\n\n      // Function to check if the start time is valid (customize as needed)\n      function isValidStartTime(startTime) {\n        // Add your specific logic for validating the start time\n        return startTime != null && startTime.toMillis() > now();\n      }\n\n      // Function to check if the end time is valid (customize as needed)\n      function isValidEndTime(endTime) {\n        // Add your specific logic for validating the end time\n        return endTime != null && endTime.toMillis() > now();\n      }\n\n      // Function to check if the title is valid (customize as needed)\n      function isValidTitle(title) {\n        // Add your specific logic for validating the title\n        return title != null && title.matches(\"^[a-zA-Z0-9 ]+$\"); // Example: Alphanumeric with spaces\n      }\n    }\n\n    // Rules for /election/{electionId}/candidate/{candidateId} path\n    match /election/{electionId}/candidate/{candidateId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidCandidateData(request.resource.data);\n\n      // Function to check if the candidate data is valid\n      function isValidCandidateData(data) {\n        return data != null &&\n        data.keys().hasAll(['name', 'description']) &&\n        data.name is string &&\n        data.description is string;\n      }\n    }\n\n    // Rules for /election/{electionId}/vote/{userId} path\n    match /election/{electionId}/vote/{userId} {\n      allow read: if request.auth != null && request.auth.uid == userId; // Allow the user to read their own vote\n\n      allow write: if request.auth != null && isUserAdmin(request.auth.uid) &&\n      isValidVoteData(request.resource.data);\n\n      // Function to check if the vote data is valid\n      function isValidVoteData(data) {\n        return data != null &&\n        data.keys().hasAll(['candidateIds']) &&\n        data.candidateIds is list &&\n        isValidCandidateIds(data.candidateIds);\n        // Add additional conditions if needed (e.g., checking if the candidateIds are valid)\n      }\n\n      // Function to check if the candidateIds are valid\n      function isValidCandidateIds(candidateIds) {\n        // Add your specific logic for validating the list of candidateIds\n        // For example, ensure that each candidateId is a string\n\n        if (!(candidateIds is list && candidateIds.size() > 0)) {\n        return false;\n      }\n\n      // Iterate over candidateIds and check the type individually\n      for (var i = 0; i < candidateIds.size(); i++) {\n      if (!(candidateIds[i] is string)) {\n      return false;\n    }\n  }\n\n  return true;\n}\n    }\n\n  }\n}\n"}]}}
[debug] [2024-01-04T22:41:42.028Z] Jan 04, 2024 10:41:42 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:41:42 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2024-01-04T22:41:42.081Z] <<< [apiv2][status] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules 200
[debug] [2024-01-04T22:41:42.081Z] <<< [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":145,"column":9,"currentOffset":6456,"endOffset":6457},"description":"Unexpected 'if'.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":150,"column":7,"currentOffset":6618,"endOffset":6620},"description":"Unexpected 'for'.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":156,"column":3,"currentOffset":6741,"endOffset":6746},"description":"Unexpected 'return'.","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:145:9 - ERROR Unexpected 'if'. 
[warn] ⚠  firestore.rules:150:7 - ERROR Unexpected 'for'. 
[warn] ⚠  firestore.rules:156:3 - ERROR Unexpected 'return'. 
[info] ✔  firestore: Rules updated. 
[debug] [2024-01-04T22:41:47.101Z] Jan 04, 2024 10:41:47 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:41:47 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[info] i  firestore: Change detected, updating rules... 
[debug] [2024-01-04T22:41:54.849Z] >>> [apiv2][query] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules [none]
[debug] [2024-01-04T22:41:54.850Z] >>> [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    // Other rules...\n    function isValidPhoneNumber(phone) {\n      // Define your custom logic to validate the phone number format\n      // For example, you can use regular expressions to check the format\n      // Replace the following regular expression with your own validation logic\n      return phone.matches(\"^\\\\+\\\\([0-9]+\\\\)#\\\\* [0-9]+$\");\n    }\n    function isValidEmail(email) {\n      // Define your custom logic to validate the email address format\n      // Replace the following regular expression with your own validation logic\n      return email.matches(\"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\\\.[a-zA-Z]{2,}$\");\n    }\n\n    function isValidAddress(address) {\n      // Check if the address has the required fields\n      return address is map &&\n      'addressLines' in address &&\n      'postcode' in address &&\n      'locality' in address &&\n      'regionCode' in address &&\n      address.addressLines is list && address.addressLines.size() >= 2 &&\n      address.addressLines[0] is string && \n      address.addressLines[1] is string &&\n      address.addressLines[0].size() >= 1 &&\n      address.addressLines[1].size() >= 1 &&\n      address.addressLines[0].size() <= 255 &&\n      address.addressLines[1].size() <= 255 &&\n      address.postcode is string &&\n      address.locality is string &&\n      address.regionCode is string && address.regionCode.size() == 2;\n    }\n    function isUserAdmin(uid) {\n      return get(/databases/$(database)/documents/users/$(uid)).data.role.hasAny(['admin']);\n    }\n    function isValidDOB(dob) {\n      // Define your custom logic to validate the date of birth format\n      // This is a basic example, you might want to adjust it based on your needs\n      return dob.matches(\"^\\\\d{4}-\\\\d{2}-\\\\d{2}$\");\n    }\n    function isValidFirstName(firstName) {\n      // Define your custom logic to validate the first name\n      // This is a basic example; adjust it based on your needs\n      return firstName is string && firstName.length > 0 && firstName.length < 255;\n    }\n\n    function isValidLastName(lastName) {\n      // Define your custom logic to validate the last name\n      // This is a basic example; adjust it based on your needs\n      return lastName is string && lastName.length > 0 && firstName.length < 255;\n    }\n    // User document rules\n    match /user/{userId} {\n      allow read, write: if request.auth != null && request.auth.uid == userId\n        && request.resource.data.keys().hasAll(['email', 'firstName', 'lastName', 'dob', 'address', 'phone', 'role'])\n        && request.resource.data.email is string // && isValidEmail(request.resource.data.email)\n        && request.resource.data.firstName is string //&& isValidFirstName(firstName)\n        && request.resource.data.lastName is string //&& isValidLastName(lastName)\n        && request.resource.data.dob is string && isValidDOB(request.resource.data.dob)\n        && request.resource.data.address is map && isValidAddress(request.resource.data.address)\n        && request.resource.data.phone is string && isValidPhoneNumber(request.resource.data.phone)\n        && request.resource.data.role is list && request.resource.data.role.size() == 0;\n      allow read, write: if isUserAdmin(request.auth.uid);\n    }\n\n    // Rules for /election/{electionId} path\n    match /election/{electionId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidElectionData(request.resource.data);\n\n      // Function to check if the election data is valid\n      function isValidElectionData(data) {\n        return data != null &&\n        data.keys().hasAll(['startTime', 'endTime', 'title']) &&\n        data.startTime is timestamp &&\n        data.endTime is timestamp &&\n        data.title is string &&\n        // Add additional conditions for start time, end time, and title as needed\n        isValidStartTime(data.startTime) &&\n        isValidEndTime(data.endTime) &&\n        isValidTitle(data.title);\n      }\n\n      // Function to check if the start time is valid (customize as needed)\n      function isValidStartTime(startTime) {\n        // Add your specific logic for validating the start time\n        return startTime != null && startTime.toMillis() > now();\n      }\n\n      // Function to check if the end time is valid (customize as needed)\n      function isValidEndTime(endTime) {\n        // Add your specific logic for validating the end time\n        return endTime != null && endTime.toMillis() > now();\n      }\n\n      // Function to check if the title is valid (customize as needed)\n      function isValidTitle(title) {\n        // Add your specific logic for validating the title\n        return title != null && title.matches(\"^[a-zA-Z0-9 ]+$\"); // Example: Alphanumeric with spaces\n      }\n    }\n\n    // Rules for /election/{electionId}/candidate/{candidateId} path\n    match /election/{electionId}/candidate/{candidateId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidCandidateData(request.resource.data);\n\n      // Function to check if the candidate data is valid\n      function isValidCandidateData(data) {\n        return data != null &&\n        data.keys().hasAll(['name', 'description']) &&\n        data.name is string &&\n        data.description is string;\n      }\n    }\n\n    // Rules for /election/{electionId}/vote/{userId} path\n    match /election/{electionId}/vote/{userId} {\n      allow read: if request.auth != null && request.auth.uid == userId; // Allow the user to read their own vote\n\n      allow write: if request.auth != null && isUserAdmin(request.auth.uid) &&\n      isValidVoteData(request.resource.data);\n\n      // Function to check if the vote data is valid\n      function isValidVoteData(data) {\n        return data != null &&\n        data.keys().hasAll(['candidateIds']) &&\n        data.candidateIds is list &&\n        isValidCandidateIds(data.candidateIds);\n        // Add additional conditions if needed (e.g., checking if the candidateIds are valid)\n      }\n\n      // Function to check if the candidateIds are valid\n      function isValidCandidateIds(candidateIds) {\n        // Add your specific logic for validating the list of candidateIds\n        // For example, ensure that each candidateId is a string\n\n        if (!(candidateIds is list && candidateIds.size() > 0)) {\n        return false;\n      }\n\n      // Iterate over candidateIds and check the type individually\n      for (var i = 0; i < candidateIds.size(); i++) {\n      if (!(candidateIds[i] is string)) {\n      return false;\n    }\n  }\n}\n\nreturn true;\n}\n    }\n\n  }\n}\n"}]}}
[debug] [2024-01-04T22:41:54.858Z] Jan 04, 2024 10:41:54 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:41:54 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2024-01-04T22:41:54.979Z] <<< [apiv2][status] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules 200
[debug] [2024-01-04T22:41:54.979Z] <<< [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":145,"column":9,"currentOffset":6456,"endOffset":6457},"description":"Unexpected 'if'.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":150,"column":7,"currentOffset":6618,"endOffset":6620},"description":"Unexpected 'for'.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":155,"column":1,"currentOffset":6738,"endOffset":6738},"description":"Unexpected '}'.","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:145:9 - ERROR Unexpected 'if'. 
[warn] ⚠  firestore.rules:150:7 - ERROR Unexpected 'for'. 
[warn] ⚠  firestore.rules:155:1 - ERROR Unexpected '}'. 
[info] ✔  firestore: Rules updated. 
[debug] [2024-01-04T22:42:34.119Z] Jan 04, 2024 10:42:34 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:42:34 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[info] i  firestore: Change detected, updating rules... 
[debug] [2024-01-04T22:43:11.995Z] >>> [apiv2][query] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules [none]
[debug] [2024-01-04T22:43:11.995Z] >>> [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    // Other rules...\n    function isValidPhoneNumber(phone) {\n      // Define your custom logic to validate the phone number format\n      // For example, you can use regular expressions to check the format\n      // Replace the following regular expression with your own validation logic\n      return phone.matches(\"^\\\\+\\\\([0-9]+\\\\)#\\\\* [0-9]+$\");\n    }\n    function isValidEmail(email) {\n      // Define your custom logic to validate the email address format\n      // Replace the following regular expression with your own validation logic\n      return email.matches(\"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\\\.[a-zA-Z]{2,}$\");\n    }\n\n    function isValidAddress(address) {\n      // Check if the address has the required fields\n      return address is map &&\n      'addressLines' in address &&\n      'postcode' in address &&\n      'locality' in address &&\n      'regionCode' in address &&\n      address.addressLines is list && address.addressLines.size() >= 2 &&\n      address.addressLines[0] is string && \n      address.addressLines[1] is string &&\n      address.addressLines[0].size() >= 1 &&\n      address.addressLines[1].size() >= 1 &&\n      address.addressLines[0].size() <= 255 &&\n      address.addressLines[1].size() <= 255 &&\n      address.postcode is string &&\n      address.locality is string &&\n      address.regionCode is string && address.regionCode.size() == 2;\n    }\n    function isUserAdmin(uid) {\n      return get(/databases/$(database)/documents/users/$(uid)).data.role.hasAny(['admin']);\n    }\n    function isValidDOB(dob) {\n      // Define your custom logic to validate the date of birth format\n      // This is a basic example, you might want to adjust it based on your needs\n      return dob.matches(\"^\\\\d{4}-\\\\d{2}-\\\\d{2}$\");\n    }\n    function isValidFirstName(firstName) {\n      // Define your custom logic to validate the first name\n      // This is a basic example; adjust it based on your needs\n      return firstName is string && firstName.length > 0 && firstName.length < 255;\n    }\n\n    function isValidLastName(lastName) {\n      // Define your custom logic to validate the last name\n      // This is a basic example; adjust it based on your needs\n      return lastName is string && lastName.length > 0 && firstName.length < 255;\n    }\n    // User document rules\n    match /user/{userId} {\n      allow read, write: if request.auth != null && request.auth.uid == userId\n        && request.resource.data.keys().hasAll(['email', 'firstName', 'lastName', 'dob', 'address', 'phone', 'role'])\n        && request.resource.data.email is string // && isValidEmail(request.resource.data.email)\n        && request.resource.data.firstName is string //&& isValidFirstName(firstName)\n        && request.resource.data.lastName is string //&& isValidLastName(lastName)\n        && request.resource.data.dob is string && isValidDOB(request.resource.data.dob)\n        && request.resource.data.address is map && isValidAddress(request.resource.data.address)\n        && request.resource.data.phone is string && isValidPhoneNumber(request.resource.data.phone)\n        && request.resource.data.role is list && request.resource.data.role.size() == 0;\n      allow read, write: if isUserAdmin(request.auth.uid);\n    }\n\n    // Rules for /election/{electionId} path\n    match /election/{electionId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidElectionData(request.resource.data);\n\n      // Function to check if the election data is valid\n      function isValidElectionData(data) {\n        return data != null &&\n        data.keys().hasAll(['startTime', 'endTime', 'title']) &&\n        data.startTime is timestamp &&\n        data.endTime is timestamp &&\n        data.title is string &&\n        // Add additional conditions for start time, end time, and title as needed\n        isValidStartTime(data.startTime) &&\n        isValidEndTime(data.endTime) &&\n        isValidTitle(data.title);\n      }\n\n      // Function to check if the start time is valid (customize as needed)\n      function isValidStartTime(startTime) {\n        // Add your specific logic for validating the start time\n        return startTime != null && startTime.toMillis() > now();\n      }\n\n      // Function to check if the end time is valid (customize as needed)\n      function isValidEndTime(endTime) {\n        // Add your specific logic for validating the end time\n        return endTime != null && endTime.toMillis() > now();\n      }\n\n      // Function to check if the title is valid (customize as needed)\n      function isValidTitle(title) {\n        // Add your specific logic for validating the title\n        return title != null && title.matches(\"^[a-zA-Z0-9 ]+$\"); // Example: Alphanumeric with spaces\n      }\n    }\n\n    // Rules for /election/{electionId}/candidate/{candidateId} path\n    match /election/{electionId}/candidate/{candidateId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidCandidateData(request.resource.data);\n\n      // Function to check if the candidate data is valid\n      function isValidCandidateData(data) {\n        return data != null &&\n        data.keys().hasAll(['name', 'description']) &&\n        data.name is string &&\n        data.description is string;\n      }\n    }\n\n    // Rules for /election/{electionId}/vote/{userId} path\n    match /election/{electionId}/vote/{userId} {\n      allow read: if request.auth != null && request.auth.uid == userId; // Allow the user to read their own vote\n\n      allow write: if request.auth != null && isUserAdmin(request.auth.uid) &&\n      isValidVoteData(request.resource.data);\n\n      // Function to check if the vote data is valid\n      function isValidVoteData(data) {\n        return data != null &&\n        data.keys().hasAll(['candidateIds']) &&\n        data.candidateIds is list &&\n        isValidCandidateIds(data.candidateIds);\n        // Add additional conditions if needed (e.g., checking if the candidateIds are valid)\n      }\n\n      function isValidCandidateIds(candidateIds) {\n        // Add your specific logic for validating the list of candidateIds\n        // For example, ensure that each candidateId is a string\n\n        if (!(candidateIds is list && candidateIds.size() > 0)) {\n        return false;\n      }\n\n      // Iterate over candidateIds and check the type individually\n      for (var i = 0; i < candidateIds.size(); i++) {\n      if (!(candidateIds[i] is string)) {\n      return false;\n    }\n  }\n\n  return true;\n}\n    }\n\n  }\n}\n"}]}}
[debug] [2024-01-04T22:43:12.005Z] Jan 04, 2024 10:43:12 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:43:12 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2024-01-04T22:43:12.100Z] <<< [apiv2][status] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules 200
[debug] [2024-01-04T22:43:12.100Z] <<< [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":144,"column":9,"currentOffset":6399,"endOffset":6400},"description":"Unexpected 'if'.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":149,"column":7,"currentOffset":6561,"endOffset":6563},"description":"Unexpected 'for'.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":155,"column":3,"currentOffset":6684,"endOffset":6689},"description":"Unexpected 'return'.","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:144:9 - ERROR Unexpected 'if'. 
[warn] ⚠  firestore.rules:149:7 - ERROR Unexpected 'for'. 
[warn] ⚠  firestore.rules:155:3 - ERROR Unexpected 'return'. 
[info] ✔  firestore: Rules updated. 
[debug] [2024-01-04T22:43:34.135Z] Jan 04, 2024 10:43:34 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:43:34 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[info] i  firestore: Change detected, updating rules... 
[debug] [2024-01-04T22:44:06.177Z] >>> [apiv2][query] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules [none]
[debug] [2024-01-04T22:44:06.178Z] >>> [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    // Other rules...\n    function isValidPhoneNumber(phone) {\n      // Define your custom logic to validate the phone number format\n      // For example, you can use regular expressions to check the format\n      // Replace the following regular expression with your own validation logic\n      return phone.matches(\"^\\\\+\\\\([0-9]+\\\\)#\\\\* [0-9]+$\");\n    }\n    function isValidEmail(email) {\n      // Define your custom logic to validate the email address format\n      // Replace the following regular expression with your own validation logic\n      return email.matches(\"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\\\.[a-zA-Z]{2,}$\");\n    }\n\n    function isValidAddress(address) {\n      // Check if the address has the required fields\n      return address is map &&\n      'addressLines' in address &&\n      'postcode' in address &&\n      'locality' in address &&\n      'regionCode' in address &&\n      address.addressLines is list && address.addressLines.size() >= 2 &&\n      address.addressLines[0] is string && \n      address.addressLines[1] is string &&\n      address.addressLines[0].size() >= 1 &&\n      address.addressLines[1].size() >= 1 &&\n      address.addressLines[0].size() <= 255 &&\n      address.addressLines[1].size() <= 255 &&\n      address.postcode is string &&\n      address.locality is string &&\n      address.regionCode is string && address.regionCode.size() == 2;\n    }\n    function isUserAdmin(uid) {\n      return get(/databases/$(database)/documents/users/$(uid)).data.role.hasAny(['admin']);\n    }\n    function isValidDOB(dob) {\n      // Define your custom logic to validate the date of birth format\n      // This is a basic example, you might want to adjust it based on your needs\n      return dob.matches(\"^\\\\d{4}-\\\\d{2}-\\\\d{2}$\");\n    }\n    function isValidFirstName(firstName) {\n      // Define your custom logic to validate the first name\n      // This is a basic example; adjust it based on your needs\n      return firstName is string && firstName.length > 0 && firstName.length < 255;\n    }\n\n    function isValidLastName(lastName) {\n      // Define your custom logic to validate the last name\n      // This is a basic example; adjust it based on your needs\n      return lastName is string && lastName.length > 0 && firstName.length < 255;\n    }\n    // User document rules\n    match /user/{userId} {\n      allow read, write: if request.auth != null && request.auth.uid == userId\n        && request.resource.data.keys().hasAll(['email', 'firstName', 'lastName', 'dob', 'address', 'phone', 'role'])\n        && request.resource.data.email is string // && isValidEmail(request.resource.data.email)\n        && request.resource.data.firstName is string //&& isValidFirstName(firstName)\n        && request.resource.data.lastName is string //&& isValidLastName(lastName)\n        && request.resource.data.dob is string && isValidDOB(request.resource.data.dob)\n        && request.resource.data.address is map && isValidAddress(request.resource.data.address)\n        && request.resource.data.phone is string && isValidPhoneNumber(request.resource.data.phone)\n        && request.resource.data.role is list && request.resource.data.role.size() == 0;\n      allow read, write: if isUserAdmin(request.auth.uid);\n    }\n\n    // Rules for /election/{electionId} path\n    match /election/{electionId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidElectionData(request.resource.data);\n\n      // Function to check if the election data is valid\n      function isValidElectionData(data) {\n        return data != null &&\n        data.keys().hasAll(['startTime', 'endTime', 'title']) &&\n        data.startTime is timestamp &&\n        data.endTime is timestamp &&\n        data.title is string &&\n        // Add additional conditions for start time, end time, and title as needed\n        isValidStartTime(data.startTime) &&\n        isValidEndTime(data.endTime) &&\n        isValidTitle(data.title);\n      }\n\n      // Function to check if the start time is valid (customize as needed)\n      function isValidStartTime(startTime) {\n        // Add your specific logic for validating the start time\n        return startTime != null && startTime.toMillis() > now();\n      }\n\n      // Function to check if the end time is valid (customize as needed)\n      function isValidEndTime(endTime) {\n        // Add your specific logic for validating the end time\n        return endTime != null && endTime.toMillis() > now();\n      }\n\n      // Function to check if the title is valid (customize as needed)\n      function isValidTitle(title) {\n        // Add your specific logic for validating the title\n        return title != null && title.matches(\"^[a-zA-Z0-9 ]+$\"); // Example: Alphanumeric with spaces\n      }\n    }\n\n    // Rules for /election/{electionId}/candidate/{candidateId} path\n    match /election/{electionId}/candidate/{candidateId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidCandidateData(request.resource.data);\n\n      // Function to check if the candidate data is valid\n      function isValidCandidateData(data) {\n        return data != null &&\n        data.keys().hasAll(['name', 'description']) &&\n        data.name is string &&\n        data.description is string;\n      }\n    }\n\n    // Rules for /election/{electionId}/vote/{userId} path\n    match /election/{electionId}/vote/{userId} {\n      allow read: if request.auth != null && request.auth.uid == userId; // Allow the user to read their own vote\n\n      allow write: if request.auth != null && isUserAdmin(request.auth.uid) &&\n      isValidVoteData(request.resource.data);\n\n      // Function to check if the vote data is valid\n      function isValidVoteData(data) {\n        return data != null &&\n        data.keys().hasAll(['candidateIds']) &&\n        data.candidateIds is list &&\n        isValidCandidateIds(data.candidateIds);\n        // Add additional conditions if needed (e.g., checking if the candidateIds are valid)\n      }\n\n     // Function to check if the candidateIds are valid\nfunction isValidCandidateIds(candidateIds) {\n  // Add your specific logic for validating the list of candidateIds\n  // For example, ensure that each candidateId is a string\n\n  function isValidHelper(index) {\n    return index == candidateIds.size() ||\n      (candidateIds[index] is string && isValidHelper(index + 1));\n  }\n\n  return candidateIds is list && candidateIds.size() > 0 && isValidHelper(0);\n}\n    }\n\n  }\n}\n"}]}}
[debug] [2024-01-04T22:44:06.187Z] Jan 04, 2024 10:44:06 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:44:06 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2024-01-04T22:44:06.334Z] <<< [apiv2][status] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules 200
[debug] [2024-01-04T22:44:06.334Z] <<< [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":145,"column":3,"currentOffset":6431,"endOffset":6438},"description":"Unexpected 'function'.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":150,"column":3,"currentOffset":6580,"endOffset":6585},"description":"Unexpected 'return'.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":155,"column":1,"currentOffset":6669,"endOffset":6669},"description":"Unexpected '}'.","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:145:3 - ERROR Unexpected 'function'. 
[warn] ⚠  firestore.rules:150:3 - ERROR Unexpected 'return'. 
[warn] ⚠  firestore.rules:155:1 - ERROR Unexpected '}'. 
[info] ✔  firestore: Rules updated. 
[debug] [2024-01-04T22:44:20.161Z] Jan 04, 2024 10:44:20 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:44:20 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[info] i  firestore: Change detected, updating rules... 
[debug] [2024-01-04T22:44:32.500Z] >>> [apiv2][query] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules [none]
[debug] [2024-01-04T22:44:32.500Z] >>> [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    // Other rules...\n    function isValidPhoneNumber(phone) {\n      // Define your custom logic to validate the phone number format\n      // For example, you can use regular expressions to check the format\n      // Replace the following regular expression with your own validation logic\n      return phone.matches(\"^\\\\+\\\\([0-9]+\\\\)#\\\\* [0-9]+$\");\n    }\n    function isValidEmail(email) {\n      // Define your custom logic to validate the email address format\n      // Replace the following regular expression with your own validation logic\n      return email.matches(\"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\\\.[a-zA-Z]{2,}$\");\n    }\n\n    function isValidAddress(address) {\n      // Check if the address has the required fields\n      return address is map &&\n      'addressLines' in address &&\n      'postcode' in address &&\n      'locality' in address &&\n      'regionCode' in address &&\n      address.addressLines is list && address.addressLines.size() >= 2 &&\n      address.addressLines[0] is string && \n      address.addressLines[1] is string &&\n      address.addressLines[0].size() >= 1 &&\n      address.addressLines[1].size() >= 1 &&\n      address.addressLines[0].size() <= 255 &&\n      address.addressLines[1].size() <= 255 &&\n      address.postcode is string &&\n      address.locality is string &&\n      address.regionCode is string && address.regionCode.size() == 2;\n    }\n    function isUserAdmin(uid) {\n      return get(/databases/$(database)/documents/users/$(uid)).data.role.hasAny(['admin']);\n    }\n    function isValidDOB(dob) {\n      // Define your custom logic to validate the date of birth format\n      // This is a basic example, you might want to adjust it based on your needs\n      return dob.matches(\"^\\\\d{4}-\\\\d{2}-\\\\d{2}$\");\n    }\n    function isValidFirstName(firstName) {\n      // Define your custom logic to validate the first name\n      // This is a basic example; adjust it based on your needs\n      return firstName is string && firstName.length > 0 && firstName.length < 255;\n    }\n\n    function isValidLastName(lastName) {\n      // Define your custom logic to validate the last name\n      // This is a basic example; adjust it based on your needs\n      return lastName is string && lastName.length > 0 && firstName.length < 255;\n    }\n    // User document rules\n    match /user/{userId} {\n      allow read, write: if request.auth != null && request.auth.uid == userId\n        && request.resource.data.keys().hasAll(['email', 'firstName', 'lastName', 'dob', 'address', 'phone', 'role'])\n        && request.resource.data.email is string // && isValidEmail(request.resource.data.email)\n        && request.resource.data.firstName is string //&& isValidFirstName(firstName)\n        && request.resource.data.lastName is string //&& isValidLastName(lastName)\n        && request.resource.data.dob is string && isValidDOB(request.resource.data.dob)\n        && request.resource.data.address is map && isValidAddress(request.resource.data.address)\n        && request.resource.data.phone is string && isValidPhoneNumber(request.resource.data.phone)\n        && request.resource.data.role is list && request.resource.data.role.size() == 0;\n      allow read, write: if isUserAdmin(request.auth.uid);\n    }\n\n    // Rules for /election/{electionId} path\n    match /election/{electionId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidElectionData(request.resource.data);\n\n      // Function to check if the election data is valid\n      function isValidElectionData(data) {\n        return data != null &&\n        data.keys().hasAll(['startTime', 'endTime', 'title']) &&\n        data.startTime is timestamp &&\n        data.endTime is timestamp &&\n        data.title is string &&\n        // Add additional conditions for start time, end time, and title as needed\n        isValidStartTime(data.startTime) &&\n        isValidEndTime(data.endTime) &&\n        isValidTitle(data.title);\n      }\n\n      // Function to check if the start time is valid (customize as needed)\n      function isValidStartTime(startTime) {\n        // Add your specific logic for validating the start time\n        return startTime != null && startTime.toMillis() > now();\n      }\n\n      // Function to check if the end time is valid (customize as needed)\n      function isValidEndTime(endTime) {\n        // Add your specific logic for validating the end time\n        return endTime != null && endTime.toMillis() > now();\n      }\n\n      // Function to check if the title is valid (customize as needed)\n      function isValidTitle(title) {\n        // Add your specific logic for validating the title\n        return title != null && title.matches(\"^[a-zA-Z0-9 ]+$\"); // Example: Alphanumeric with spaces\n      }\n    }\n\n    // Rules for /election/{electionId}/candidate/{candidateId} path\n    match /election/{electionId}/candidate/{candidateId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidCandidateData(request.resource.data);\n\n      // Function to check if the candidate data is valid\n      function isValidCandidateData(data) {\n        return data != null &&\n        data.keys().hasAll(['name', 'description']) &&\n        data.name is string &&\n        data.description is string;\n      }\n    }\n\n    // Rules for /election/{electionId}/vote/{userId} path\n    match /election/{electionId}/vote/{userId} {\n      allow read: if request.auth != null && request.auth.uid == userId; // Allow the user to read their own vote\n\n      allow write: if request.auth != null && isUserAdmin(request.auth.uid) &&\n      isValidVoteData(request.resource.data);\n\n      // Function to check if the vote data is valid\n      function isValidVoteData(data) {\n        return data != null &&\n        data.keys().hasAll(['candidateIds']) &&\n        data.candidateIds is list &&\n        isValidCandidateIds(data.candidateIds);\n        // Add additional conditions if needed (e.g., checking if the candidateIds are valid)\n      }\n\n     // Function to check if the candidateIds are valid\nfunction isValidCandidateIds(candidateIds) {\n  // Add your specific logic for validating the list of candidateIds\n  // For example, ensure that each candidateId is a string\n\n  return candidateIds is list &&\n    candidateIds.size() > 0 &&\n    candidateIds.size() == candidateIds.count(id => id is string);\n}\n    }\n\n  }\n}\n"}]}}
[debug] [2024-01-04T22:44:32.508Z] Jan 04, 2024 10:44:32 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:44:32 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2024-01-04T22:44:32.553Z] <<< [apiv2][status] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules 200
[debug] [2024-01-04T22:44:32.553Z] <<< [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":147,"column":50,"currentOffset":6542,"endOffset":6542},"description":"Unexpected '='.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":147,"column":65,"currentOffset":6557,"endOffset":6557},"description":"mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":152,"column":1,"currentOffset":6573,"endOffset":6573},"description":"Unexpected '}'.","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:147:50 - ERROR Unexpected '='. 
[warn] ⚠  firestore.rules:147:65 - ERROR mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'} 
[warn] ⚠  firestore.rules:152:1 - ERROR Unexpected '}'. 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2024-01-04T22:44:35.436Z] >>> [apiv2][query] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules [none]
[debug] [2024-01-04T22:44:35.436Z] >>> [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    // Other rules...\n    function isValidPhoneNumber(phone) {\n      // Define your custom logic to validate the phone number format\n      // For example, you can use regular expressions to check the format\n      // Replace the following regular expression with your own validation logic\n      return phone.matches(\"^\\\\+\\\\([0-9]+\\\\)#\\\\* [0-9]+$\");\n    }\n    function isValidEmail(email) {\n      // Define your custom logic to validate the email address format\n      // Replace the following regular expression with your own validation logic\n      return email.matches(\"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\\\.[a-zA-Z]{2,}$\");\n    }\n\n    function isValidAddress(address) {\n      // Check if the address has the required fields\n      return address is map &&\n      'addressLines' in address &&\n      'postcode' in address &&\n      'locality' in address &&\n      'regionCode' in address &&\n      address.addressLines is list && address.addressLines.size() >= 2 &&\n      address.addressLines[0] is string && \n      address.addressLines[1] is string &&\n      address.addressLines[0].size() >= 1 &&\n      address.addressLines[1].size() >= 1 &&\n      address.addressLines[0].size() <= 255 &&\n      address.addressLines[1].size() <= 255 &&\n      address.postcode is string &&\n      address.locality is string &&\n      address.regionCode is string && address.regionCode.size() == 2;\n    }\n    function isUserAdmin(uid) {\n      return get(/databases/$(database)/documents/users/$(uid)).data.role.hasAny(['admin']);\n    }\n    function isValidDOB(dob) {\n      // Define your custom logic to validate the date of birth format\n      // This is a basic example, you might want to adjust it based on your needs\n      return dob.matches(\"^\\\\d{4}-\\\\d{2}-\\\\d{2}$\");\n    }\n    function isValidFirstName(firstName) {\n      // Define your custom logic to validate the first name\n      // This is a basic example; adjust it based on your needs\n      return firstName is string && firstName.length > 0 && firstName.length < 255;\n    }\n\n    function isValidLastName(lastName) {\n      // Define your custom logic to validate the last name\n      // This is a basic example; adjust it based on your needs\n      return lastName is string && lastName.length > 0 && firstName.length < 255;\n    }\n    // User document rules\n    match /user/{userId} {\n      allow read, write: if request.auth != null && request.auth.uid == userId\n        && request.resource.data.keys().hasAll(['email', 'firstName', 'lastName', 'dob', 'address', 'phone', 'role'])\n        && request.resource.data.email is string // && isValidEmail(request.resource.data.email)\n        && request.resource.data.firstName is string //&& isValidFirstName(firstName)\n        && request.resource.data.lastName is string //&& isValidLastName(lastName)\n        && request.resource.data.dob is string && isValidDOB(request.resource.data.dob)\n        && request.resource.data.address is map && isValidAddress(request.resource.data.address)\n        && request.resource.data.phone is string && isValidPhoneNumber(request.resource.data.phone)\n        && request.resource.data.role is list && request.resource.data.role.size() == 0;\n      allow read, write: if isUserAdmin(request.auth.uid);\n    }\n\n    // Rules for /election/{electionId} path\n    match /election/{electionId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidElectionData(request.resource.data);\n\n      // Function to check if the election data is valid\n      function isValidElectionData(data) {\n        return data != null &&\n        data.keys().hasAll(['startTime', 'endTime', 'title']) &&\n        data.startTime is timestamp &&\n        data.endTime is timestamp &&\n        data.title is string &&\n        // Add additional conditions for start time, end time, and title as needed\n        isValidStartTime(data.startTime) &&\n        isValidEndTime(data.endTime) &&\n        isValidTitle(data.title);\n      }\n\n      // Function to check if the start time is valid (customize as needed)\n      function isValidStartTime(startTime) {\n        // Add your specific logic for validating the start time\n        return startTime != null && startTime.toMillis() > now();\n      }\n\n      // Function to check if the end time is valid (customize as needed)\n      function isValidEndTime(endTime) {\n        // Add your specific logic for validating the end time\n        return endTime != null && endTime.toMillis() > now();\n      }\n\n      // Function to check if the title is valid (customize as needed)\n      function isValidTitle(title) {\n        // Add your specific logic for validating the title\n        return title != null && title.matches(\"^[a-zA-Z0-9 ]+$\"); // Example: Alphanumeric with spaces\n      }\n    }\n\n    // Rules for /election/{electionId}/candidate/{candidateId} path\n    match /election/{electionId}/candidate/{candidateId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidCandidateData(request.resource.data);\n\n      // Function to check if the candidate data is valid\n      function isValidCandidateData(data) {\n        return data != null &&\n        data.keys().hasAll(['name', 'description']) &&\n        data.name is string &&\n        data.description is string;\n      }\n    }\n\n    // Rules for /election/{electionId}/vote/{userId} path\n    match /election/{electionId}/vote/{userId} {\n      allow read: if request.auth != null && request.auth.uid == userId; // Allow the user to read their own vote\n\n      allow write: if request.auth != null && isUserAdmin(request.auth.uid) &&\n      isValidVoteData(request.resource.data);\n\n      // Function to check if the vote data is valid\n      function isValidVoteData(data) {\n        return data != null &&\n        data.keys().hasAll(['candidateIds']) &&\n        data.candidateIds is list &&\n        isValidCandidateIds(data.candidateIds);\n        // Add additional conditions if needed (e.g., checking if the candidateIds are valid)\n      }\n\n     // Function to check if the candidateIds are valid\nfunction isValidCandidateIds(candidateIds) {\n  // Add your specific logic for validating the list of candidateIds\n  // For example, ensure that each candidateId is a string\n\n  return candidateIds is list &&\n    candidateIds.size() > 0 &&\n    candidateIds.size() == candidateIds.count(id => id is string);\n}\n    }\n\n  }\n}\n"}]}}
[debug] [2024-01-04T22:44:35.444Z] Jan 04, 2024 10:44:35 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:44:35 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2024-01-04T22:44:35.493Z] <<< [apiv2][status] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules 200
[debug] [2024-01-04T22:44:35.493Z] <<< [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":147,"column":50,"currentOffset":6542,"endOffset":6542},"description":"Unexpected '='.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":147,"column":65,"currentOffset":6557,"endOffset":6557},"description":"mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":152,"column":1,"currentOffset":6573,"endOffset":6573},"description":"Unexpected '}'.","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:147:50 - ERROR Unexpected '='. 
[warn] ⚠  firestore.rules:147:65 - ERROR mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'} 
[warn] ⚠  firestore.rules:152:1 - ERROR Unexpected '}'. 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2024-01-04T22:44:36.138Z] >>> [apiv2][query] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules [none]
[debug] [2024-01-04T22:44:36.139Z] >>> [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    // Other rules...\n    function isValidPhoneNumber(phone) {\n      // Define your custom logic to validate the phone number format\n      // For example, you can use regular expressions to check the format\n      // Replace the following regular expression with your own validation logic\n      return phone.matches(\"^\\\\+\\\\([0-9]+\\\\)#\\\\* [0-9]+$\");\n    }\n    function isValidEmail(email) {\n      // Define your custom logic to validate the email address format\n      // Replace the following regular expression with your own validation logic\n      return email.matches(\"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\\\.[a-zA-Z]{2,}$\");\n    }\n\n    function isValidAddress(address) {\n      // Check if the address has the required fields\n      return address is map &&\n      'addressLines' in address &&\n      'postcode' in address &&\n      'locality' in address &&\n      'regionCode' in address &&\n      address.addressLines is list && address.addressLines.size() >= 2 &&\n      address.addressLines[0] is string && \n      address.addressLines[1] is string &&\n      address.addressLines[0].size() >= 1 &&\n      address.addressLines[1].size() >= 1 &&\n      address.addressLines[0].size() <= 255 &&\n      address.addressLines[1].size() <= 255 &&\n      address.postcode is string &&\n      address.locality is string &&\n      address.regionCode is string && address.regionCode.size() == 2;\n    }\n    function isUserAdmin(uid) {\n      return get(/databases/$(database)/documents/users/$(uid)).data.role.hasAny(['admin']);\n    }\n    function isValidDOB(dob) {\n      // Define your custom logic to validate the date of birth format\n      // This is a basic example, you might want to adjust it based on your needs\n      return dob.matches(\"^\\\\d{4}-\\\\d{2}-\\\\d{2}$\");\n    }\n    function isValidFirstName(firstName) {\n      // Define your custom logic to validate the first name\n      // This is a basic example; adjust it based on your needs\n      return firstName is string && firstName.length > 0 && firstName.length < 255;\n    }\n\n    function isValidLastName(lastName) {\n      // Define your custom logic to validate the last name\n      // This is a basic example; adjust it based on your needs\n      return lastName is string && lastName.length > 0 && firstName.length < 255;\n    }\n    // User document rules\n    match /user/{userId} {\n      allow read, write: if request.auth != null && request.auth.uid == userId\n        && request.resource.data.keys().hasAll(['email', 'firstName', 'lastName', 'dob', 'address', 'phone', 'role'])\n        && request.resource.data.email is string // && isValidEmail(request.resource.data.email)\n        && request.resource.data.firstName is string //&& isValidFirstName(firstName)\n        && request.resource.data.lastName is string //&& isValidLastName(lastName)\n        && request.resource.data.dob is string && isValidDOB(request.resource.data.dob)\n        && request.resource.data.address is map && isValidAddress(request.resource.data.address)\n        && request.resource.data.phone is string && isValidPhoneNumber(request.resource.data.phone)\n        && request.resource.data.role is list && request.resource.data.role.size() == 0;\n      allow read, write: if isUserAdmin(request.auth.uid);\n    }\n\n    // Rules for /election/{electionId} path\n    match /election/{electionId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidElectionData(request.resource.data);\n\n      // Function to check if the election data is valid\n      function isValidElectionData(data) {\n        return data != null &&\n        data.keys().hasAll(['startTime', 'endTime', 'title']) &&\n        data.startTime is timestamp &&\n        data.endTime is timestamp &&\n        data.title is string &&\n        // Add additional conditions for start time, end time, and title as needed\n        isValidStartTime(data.startTime) &&\n        isValidEndTime(data.endTime) &&\n        isValidTitle(data.title);\n      }\n\n      // Function to check if the start time is valid (customize as needed)\n      function isValidStartTime(startTime) {\n        // Add your specific logic for validating the start time\n        return startTime != null && startTime.toMillis() > now();\n      }\n\n      // Function to check if the end time is valid (customize as needed)\n      function isValidEndTime(endTime) {\n        // Add your specific logic for validating the end time\n        return endTime != null && endTime.toMillis() > now();\n      }\n\n      // Function to check if the title is valid (customize as needed)\n      function isValidTitle(title) {\n        // Add your specific logic for validating the title\n        return title != null && title.matches(\"^[a-zA-Z0-9 ]+$\"); // Example: Alphanumeric with spaces\n      }\n    }\n\n    // Rules for /election/{electionId}/candidate/{candidateId} path\n    match /election/{electionId}/candidate/{candidateId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidCandidateData(request.resource.data);\n\n      // Function to check if the candidate data is valid\n      function isValidCandidateData(data) {\n        return data != null &&\n        data.keys().hasAll(['name', 'description']) &&\n        data.name is string &&\n        data.description is string;\n      }\n    }\n\n    // Rules for /election/{electionId}/vote/{userId} path\n    match /election/{electionId}/vote/{userId} {\n      allow read: if request.auth != null && request.auth.uid == userId; // Allow the user to read their own vote\n\n      allow write: if request.auth != null && isUserAdmin(request.auth.uid) &&\n      isValidVoteData(request.resource.data);\n\n      // Function to check if the vote data is valid\n      function isValidVoteData(data) {\n        return data != null &&\n        data.keys().hasAll(['candidateIds']) &&\n        data.candidateIds is list &&\n        isValidCandidateIds(data.candidateIds);\n        // Add additional conditions if needed (e.g., checking if the candidateIds are valid)\n      }\n\n     // Function to check if the candidateIds are valid\nfunction isValidCandidateIds(candidateIds) {\n  // Add your specific logic for validating the list of candidateIds\n  // For example, ensure that each candidateId is a string\n\n  return candidateIds is list &&\n    candidateIds.size() > 0 &&\n    candidateIds.size() == candidateIds.count(id => id is string);\n}\n    }\n\n  }\n}\n"}]}}
[debug] [2024-01-04T22:44:36.148Z] Jan 04, 2024 10:44:36 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:44:36 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2024-01-04T22:44:36.264Z] <<< [apiv2][status] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules 200
[debug] [2024-01-04T22:44:36.264Z] <<< [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":147,"column":50,"currentOffset":6542,"endOffset":6542},"description":"Unexpected '='.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":147,"column":65,"currentOffset":6557,"endOffset":6557},"description":"mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":152,"column":1,"currentOffset":6573,"endOffset":6573},"description":"Unexpected '}'.","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:147:50 - ERROR Unexpected '='. 
[warn] ⚠  firestore.rules:147:65 - ERROR mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'} 
[warn] ⚠  firestore.rules:152:1 - ERROR Unexpected '}'. 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2024-01-04T22:44:36.441Z] >>> [apiv2][query] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules [none]
[debug] [2024-01-04T22:44:36.441Z] >>> [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    // Other rules...\n    function isValidPhoneNumber(phone) {\n      // Define your custom logic to validate the phone number format\n      // For example, you can use regular expressions to check the format\n      // Replace the following regular expression with your own validation logic\n      return phone.matches(\"^\\\\+\\\\([0-9]+\\\\)#\\\\* [0-9]+$\");\n    }\n    function isValidEmail(email) {\n      // Define your custom logic to validate the email address format\n      // Replace the following regular expression with your own validation logic\n      return email.matches(\"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\\\.[a-zA-Z]{2,}$\");\n    }\n\n    function isValidAddress(address) {\n      // Check if the address has the required fields\n      return address is map &&\n      'addressLines' in address &&\n      'postcode' in address &&\n      'locality' in address &&\n      'regionCode' in address &&\n      address.addressLines is list && address.addressLines.size() >= 2 &&\n      address.addressLines[0] is string && \n      address.addressLines[1] is string &&\n      address.addressLines[0].size() >= 1 &&\n      address.addressLines[1].size() >= 1 &&\n      address.addressLines[0].size() <= 255 &&\n      address.addressLines[1].size() <= 255 &&\n      address.postcode is string &&\n      address.locality is string &&\n      address.regionCode is string && address.regionCode.size() == 2;\n    }\n    function isUserAdmin(uid) {\n      return get(/databases/$(database)/documents/users/$(uid)).data.role.hasAny(['admin']);\n    }\n    function isValidDOB(dob) {\n      // Define your custom logic to validate the date of birth format\n      // This is a basic example, you might want to adjust it based on your needs\n      return dob.matches(\"^\\\\d{4}-\\\\d{2}-\\\\d{2}$\");\n    }\n    function isValidFirstName(firstName) {\n      // Define your custom logic to validate the first name\n      // This is a basic example; adjust it based on your needs\n      return firstName is string && firstName.length > 0 && firstName.length < 255;\n    }\n\n    function isValidLastName(lastName) {\n      // Define your custom logic to validate the last name\n      // This is a basic example; adjust it based on your needs\n      return lastName is string && lastName.length > 0 && firstName.length < 255;\n    }\n    // User document rules\n    match /user/{userId} {\n      allow read, write: if request.auth != null && request.auth.uid == userId\n        && request.resource.data.keys().hasAll(['email', 'firstName', 'lastName', 'dob', 'address', 'phone', 'role'])\n        && request.resource.data.email is string // && isValidEmail(request.resource.data.email)\n        && request.resource.data.firstName is string //&& isValidFirstName(firstName)\n        && request.resource.data.lastName is string //&& isValidLastName(lastName)\n        && request.resource.data.dob is string && isValidDOB(request.resource.data.dob)\n        && request.resource.data.address is map && isValidAddress(request.resource.data.address)\n        && request.resource.data.phone is string && isValidPhoneNumber(request.resource.data.phone)\n        && request.resource.data.role is list && request.resource.data.role.size() == 0;\n      allow read, write: if isUserAdmin(request.auth.uid);\n    }\n\n    // Rules for /election/{electionId} path\n    match /election/{electionId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidElectionData(request.resource.data);\n\n      // Function to check if the election data is valid\n      function isValidElectionData(data) {\n        return data != null &&\n        data.keys().hasAll(['startTime', 'endTime', 'title']) &&\n        data.startTime is timestamp &&\n        data.endTime is timestamp &&\n        data.title is string &&\n        // Add additional conditions for start time, end time, and title as needed\n        isValidStartTime(data.startTime) &&\n        isValidEndTime(data.endTime) &&\n        isValidTitle(data.title);\n      }\n\n      // Function to check if the start time is valid (customize as needed)\n      function isValidStartTime(startTime) {\n        // Add your specific logic for validating the start time\n        return startTime != null && startTime.toMillis() > now();\n      }\n\n      // Function to check if the end time is valid (customize as needed)\n      function isValidEndTime(endTime) {\n        // Add your specific logic for validating the end time\n        return endTime != null && endTime.toMillis() > now();\n      }\n\n      // Function to check if the title is valid (customize as needed)\n      function isValidTitle(title) {\n        // Add your specific logic for validating the title\n        return title != null && title.matches(\"^[a-zA-Z0-9 ]+$\"); // Example: Alphanumeric with spaces\n      }\n    }\n\n    // Rules for /election/{electionId}/candidate/{candidateId} path\n    match /election/{electionId}/candidate/{candidateId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidCandidateData(request.resource.data);\n\n      // Function to check if the candidate data is valid\n      function isValidCandidateData(data) {\n        return data != null &&\n        data.keys().hasAll(['name', 'description']) &&\n        data.name is string &&\n        data.description is string;\n      }\n    }\n\n    // Rules for /election/{electionId}/vote/{userId} path\n    match /election/{electionId}/vote/{userId} {\n      allow read: if request.auth != null && request.auth.uid == userId; // Allow the user to read their own vote\n\n      allow write: if request.auth != null && isUserAdmin(request.auth.uid) &&\n      isValidVoteData(request.resource.data);\n\n      // Function to check if the vote data is valid\n      function isValidVoteData(data) {\n        return data != null &&\n        data.keys().hasAll(['candidateIds']) &&\n        data.candidateIds is list &&\n        isValidCandidateIds(data.candidateIds);\n        // Add additional conditions if needed (e.g., checking if the candidateIds are valid)\n      }\n\n     // Function to check if the candidateIds are valid\nfunction isValidCandidateIds(candidateIds) {\n  // Add your specific logic for validating the list of candidateIds\n  // For example, ensure that each candidateId is a string\n\n  return candidateIds is list &&\n    candidateIds.size() > 0 &&\n    candidateIds.size() == candidateIds.count(id => id is string);\n}\n    }\n\n  }\n}\n"}]}}
[debug] [2024-01-04T22:44:36.445Z] Jan 04, 2024 10:44:36 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:44:36 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2024-01-04T22:44:36.470Z] <<< [apiv2][status] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules 200
[debug] [2024-01-04T22:44:36.470Z] <<< [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":147,"column":50,"currentOffset":6542,"endOffset":6542},"description":"Unexpected '='.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":147,"column":65,"currentOffset":6557,"endOffset":6557},"description":"mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":152,"column":1,"currentOffset":6573,"endOffset":6573},"description":"Unexpected '}'.","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:147:50 - ERROR Unexpected '='. 
[warn] ⚠  firestore.rules:147:65 - ERROR mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'} 
[warn] ⚠  firestore.rules:152:1 - ERROR Unexpected '}'. 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2024-01-04T22:44:36.627Z] >>> [apiv2][query] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules [none]
[debug] [2024-01-04T22:44:36.628Z] >>> [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    // Other rules...\n    function isValidPhoneNumber(phone) {\n      // Define your custom logic to validate the phone number format\n      // For example, you can use regular expressions to check the format\n      // Replace the following regular expression with your own validation logic\n      return phone.matches(\"^\\\\+\\\\([0-9]+\\\\)#\\\\* [0-9]+$\");\n    }\n    function isValidEmail(email) {\n      // Define your custom logic to validate the email address format\n      // Replace the following regular expression with your own validation logic\n      return email.matches(\"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\\\.[a-zA-Z]{2,}$\");\n    }\n\n    function isValidAddress(address) {\n      // Check if the address has the required fields\n      return address is map &&\n      'addressLines' in address &&\n      'postcode' in address &&\n      'locality' in address &&\n      'regionCode' in address &&\n      address.addressLines is list && address.addressLines.size() >= 2 &&\n      address.addressLines[0] is string && \n      address.addressLines[1] is string &&\n      address.addressLines[0].size() >= 1 &&\n      address.addressLines[1].size() >= 1 &&\n      address.addressLines[0].size() <= 255 &&\n      address.addressLines[1].size() <= 255 &&\n      address.postcode is string &&\n      address.locality is string &&\n      address.regionCode is string && address.regionCode.size() == 2;\n    }\n    function isUserAdmin(uid) {\n      return get(/databases/$(database)/documents/users/$(uid)).data.role.hasAny(['admin']);\n    }\n    function isValidDOB(dob) {\n      // Define your custom logic to validate the date of birth format\n      // This is a basic example, you might want to adjust it based on your needs\n      return dob.matches(\"^\\\\d{4}-\\\\d{2}-\\\\d{2}$\");\n    }\n    function isValidFirstName(firstName) {\n      // Define your custom logic to validate the first name\n      // This is a basic example; adjust it based on your needs\n      return firstName is string && firstName.length > 0 && firstName.length < 255;\n    }\n\n    function isValidLastName(lastName) {\n      // Define your custom logic to validate the last name\n      // This is a basic example; adjust it based on your needs\n      return lastName is string && lastName.length > 0 && firstName.length < 255;\n    }\n    // User document rules\n    match /user/{userId} {\n      allow read, write: if request.auth != null && request.auth.uid == userId\n        && request.resource.data.keys().hasAll(['email', 'firstName', 'lastName', 'dob', 'address', 'phone', 'role'])\n        && request.resource.data.email is string // && isValidEmail(request.resource.data.email)\n        && request.resource.data.firstName is string //&& isValidFirstName(firstName)\n        && request.resource.data.lastName is string //&& isValidLastName(lastName)\n        && request.resource.data.dob is string && isValidDOB(request.resource.data.dob)\n        && request.resource.data.address is map && isValidAddress(request.resource.data.address)\n        && request.resource.data.phone is string && isValidPhoneNumber(request.resource.data.phone)\n        && request.resource.data.role is list && request.resource.data.role.size() == 0;\n      allow read, write: if isUserAdmin(request.auth.uid);\n    }\n\n    // Rules for /election/{electionId} path\n    match /election/{electionId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidElectionData(request.resource.data);\n\n      // Function to check if the election data is valid\n      function isValidElectionData(data) {\n        return data != null &&\n        data.keys().hasAll(['startTime', 'endTime', 'title']) &&\n        data.startTime is timestamp &&\n        data.endTime is timestamp &&\n        data.title is string &&\n        // Add additional conditions for start time, end time, and title as needed\n        isValidStartTime(data.startTime) &&\n        isValidEndTime(data.endTime) &&\n        isValidTitle(data.title);\n      }\n\n      // Function to check if the start time is valid (customize as needed)\n      function isValidStartTime(startTime) {\n        // Add your specific logic for validating the start time\n        return startTime != null && startTime.toMillis() > now();\n      }\n\n      // Function to check if the end time is valid (customize as needed)\n      function isValidEndTime(endTime) {\n        // Add your specific logic for validating the end time\n        return endTime != null && endTime.toMillis() > now();\n      }\n\n      // Function to check if the title is valid (customize as needed)\n      function isValidTitle(title) {\n        // Add your specific logic for validating the title\n        return title != null && title.matches(\"^[a-zA-Z0-9 ]+$\"); // Example: Alphanumeric with spaces\n      }\n    }\n\n    // Rules for /election/{electionId}/candidate/{candidateId} path\n    match /election/{electionId}/candidate/{candidateId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidCandidateData(request.resource.data);\n\n      // Function to check if the candidate data is valid\n      function isValidCandidateData(data) {\n        return data != null &&\n        data.keys().hasAll(['name', 'description']) &&\n        data.name is string &&\n        data.description is string;\n      }\n    }\n\n    // Rules for /election/{electionId}/vote/{userId} path\n    match /election/{electionId}/vote/{userId} {\n      allow read: if request.auth != null && request.auth.uid == userId; // Allow the user to read their own vote\n\n      allow write: if request.auth != null && isUserAdmin(request.auth.uid) &&\n      isValidVoteData(request.resource.data);\n\n      // Function to check if the vote data is valid\n      function isValidVoteData(data) {\n        return data != null &&\n        data.keys().hasAll(['candidateIds']) &&\n        data.candidateIds is list &&\n        isValidCandidateIds(data.candidateIds);\n        // Add additional conditions if needed (e.g., checking if the candidateIds are valid)\n      }\n\n     // Function to check if the candidateIds are valid\nfunction isValidCandidateIds(candidateIds) {\n  // Add your specific logic for validating the list of candidateIds\n  // For example, ensure that each candidateId is a string\n\n  return candidateIds is list &&\n    candidateIds.size() > 0 &&\n    candidateIds.size() == candidateIds.count(id => id is string);\n}\n    }\n\n  }\n}\n"}]}}
[debug] [2024-01-04T22:44:36.644Z] Jan 04, 2024 10:44:36 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:44:36 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2024-01-04T22:44:36.729Z] <<< [apiv2][status] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules 200
[debug] [2024-01-04T22:44:36.729Z] <<< [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":147,"column":50,"currentOffset":6542,"endOffset":6542},"description":"Unexpected '='.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":147,"column":65,"currentOffset":6557,"endOffset":6557},"description":"mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":152,"column":1,"currentOffset":6573,"endOffset":6573},"description":"Unexpected '}'.","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:147:50 - ERROR Unexpected '='. 
[warn] ⚠  firestore.rules:147:65 - ERROR mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'} 
[warn] ⚠  firestore.rules:152:1 - ERROR Unexpected '}'. 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2024-01-04T22:44:36.883Z] >>> [apiv2][query] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules [none]
[debug] [2024-01-04T22:44:36.884Z] >>> [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    // Other rules...\n    function isValidPhoneNumber(phone) {\n      // Define your custom logic to validate the phone number format\n      // For example, you can use regular expressions to check the format\n      // Replace the following regular expression with your own validation logic\n      return phone.matches(\"^\\\\+\\\\([0-9]+\\\\)#\\\\* [0-9]+$\");\n    }\n    function isValidEmail(email) {\n      // Define your custom logic to validate the email address format\n      // Replace the following regular expression with your own validation logic\n      return email.matches(\"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\\\.[a-zA-Z]{2,}$\");\n    }\n\n    function isValidAddress(address) {\n      // Check if the address has the required fields\n      return address is map &&\n      'addressLines' in address &&\n      'postcode' in address &&\n      'locality' in address &&\n      'regionCode' in address &&\n      address.addressLines is list && address.addressLines.size() >= 2 &&\n      address.addressLines[0] is string && \n      address.addressLines[1] is string &&\n      address.addressLines[0].size() >= 1 &&\n      address.addressLines[1].size() >= 1 &&\n      address.addressLines[0].size() <= 255 &&\n      address.addressLines[1].size() <= 255 &&\n      address.postcode is string &&\n      address.locality is string &&\n      address.regionCode is string && address.regionCode.size() == 2;\n    }\n    function isUserAdmin(uid) {\n      return get(/databases/$(database)/documents/users/$(uid)).data.role.hasAny(['admin']);\n    }\n    function isValidDOB(dob) {\n      // Define your custom logic to validate the date of birth format\n      // This is a basic example, you might want to adjust it based on your needs\n      return dob.matches(\"^\\\\d{4}-\\\\d{2}-\\\\d{2}$\");\n    }\n    function isValidFirstName(firstName) {\n      // Define your custom logic to validate the first name\n      // This is a basic example; adjust it based on your needs\n      return firstName is string && firstName.length > 0 && firstName.length < 255;\n    }\n\n    function isValidLastName(lastName) {\n      // Define your custom logic to validate the last name\n      // This is a basic example; adjust it based on your needs\n      return lastName is string && lastName.length > 0 && firstName.length < 255;\n    }\n    // User document rules\n    match /user/{userId} {\n      allow read, write: if request.auth != null && request.auth.uid == userId\n        && request.resource.data.keys().hasAll(['email', 'firstName', 'lastName', 'dob', 'address', 'phone', 'role'])\n        && request.resource.data.email is string // && isValidEmail(request.resource.data.email)\n        && request.resource.data.firstName is string //&& isValidFirstName(firstName)\n        && request.resource.data.lastName is string //&& isValidLastName(lastName)\n        && request.resource.data.dob is string && isValidDOB(request.resource.data.dob)\n        && request.resource.data.address is map && isValidAddress(request.resource.data.address)\n        && request.resource.data.phone is string && isValidPhoneNumber(request.resource.data.phone)\n        && request.resource.data.role is list && request.resource.data.role.size() == 0;\n      allow read, write: if isUserAdmin(request.auth.uid);\n    }\n\n    // Rules for /election/{electionId} path\n    match /election/{electionId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidElectionData(request.resource.data);\n\n      // Function to check if the election data is valid\n      function isValidElectionData(data) {\n        return data != null &&\n        data.keys().hasAll(['startTime', 'endTime', 'title']) &&\n        data.startTime is timestamp &&\n        data.endTime is timestamp &&\n        data.title is string &&\n        // Add additional conditions for start time, end time, and title as needed\n        isValidStartTime(data.startTime) &&\n        isValidEndTime(data.endTime) &&\n        isValidTitle(data.title);\n      }\n\n      // Function to check if the start time is valid (customize as needed)\n      function isValidStartTime(startTime) {\n        // Add your specific logic for validating the start time\n        return startTime != null && startTime.toMillis() > now();\n      }\n\n      // Function to check if the end time is valid (customize as needed)\n      function isValidEndTime(endTime) {\n        // Add your specific logic for validating the end time\n        return endTime != null && endTime.toMillis() > now();\n      }\n\n      // Function to check if the title is valid (customize as needed)\n      function isValidTitle(title) {\n        // Add your specific logic for validating the title\n        return title != null && title.matches(\"^[a-zA-Z0-9 ]+$\"); // Example: Alphanumeric with spaces\n      }\n    }\n\n    // Rules for /election/{electionId}/candidate/{candidateId} path\n    match /election/{electionId}/candidate/{candidateId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidCandidateData(request.resource.data);\n\n      // Function to check if the candidate data is valid\n      function isValidCandidateData(data) {\n        return data != null &&\n        data.keys().hasAll(['name', 'description']) &&\n        data.name is string &&\n        data.description is string;\n      }\n    }\n\n    // Rules for /election/{electionId}/vote/{userId} path\n    match /election/{electionId}/vote/{userId} {\n      allow read: if request.auth != null && request.auth.uid == userId; // Allow the user to read their own vote\n\n      allow write: if request.auth != null && isUserAdmin(request.auth.uid) &&\n      isValidVoteData(request.resource.data);\n\n      // Function to check if the vote data is valid\n      function isValidVoteData(data) {\n        return data != null &&\n        data.keys().hasAll(['candidateIds']) &&\n        data.candidateIds is list &&\n        isValidCandidateIds(data.candidateIds);\n        // Add additional conditions if needed (e.g., checking if the candidateIds are valid)\n      }\n\n     // Function to check if the candidateIds are valid\nfunction isValidCandidateIds(candidateIds) {\n  // Add your specific logic for validating the list of candidateIds\n  // For example, ensure that each candidateId is a string\n\n  return candidateIds is list &&\n    candidateIds.size() > 0 &&\n    candidateIds.size() == candidateIds.count(id => id is string);\n}\n    }\n\n  }\n}\n"}]}}
[debug] [2024-01-04T22:44:36.890Z] Jan 04, 2024 10:44:36 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:44:36 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2024-01-04T22:44:37.006Z] <<< [apiv2][status] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules 200
[debug] [2024-01-04T22:44:37.006Z] <<< [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":147,"column":50,"currentOffset":6542,"endOffset":6542},"description":"Unexpected '='.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":147,"column":65,"currentOffset":6557,"endOffset":6557},"description":"mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":152,"column":1,"currentOffset":6573,"endOffset":6573},"description":"Unexpected '}'.","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:147:50 - ERROR Unexpected '='. 
[warn] ⚠  firestore.rules:147:65 - ERROR mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'} 
[warn] ⚠  firestore.rules:152:1 - ERROR Unexpected '}'. 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2024-01-04T22:44:37.178Z] >>> [apiv2][query] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules [none]
[debug] [2024-01-04T22:44:37.178Z] >>> [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    // Other rules...\n    function isValidPhoneNumber(phone) {\n      // Define your custom logic to validate the phone number format\n      // For example, you can use regular expressions to check the format\n      // Replace the following regular expression with your own validation logic\n      return phone.matches(\"^\\\\+\\\\([0-9]+\\\\)#\\\\* [0-9]+$\");\n    }\n    function isValidEmail(email) {\n      // Define your custom logic to validate the email address format\n      // Replace the following regular expression with your own validation logic\n      return email.matches(\"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\\\.[a-zA-Z]{2,}$\");\n    }\n\n    function isValidAddress(address) {\n      // Check if the address has the required fields\n      return address is map &&\n      'addressLines' in address &&\n      'postcode' in address &&\n      'locality' in address &&\n      'regionCode' in address &&\n      address.addressLines is list && address.addressLines.size() >= 2 &&\n      address.addressLines[0] is string && \n      address.addressLines[1] is string &&\n      address.addressLines[0].size() >= 1 &&\n      address.addressLines[1].size() >= 1 &&\n      address.addressLines[0].size() <= 255 &&\n      address.addressLines[1].size() <= 255 &&\n      address.postcode is string &&\n      address.locality is string &&\n      address.regionCode is string && address.regionCode.size() == 2;\n    }\n    function isUserAdmin(uid) {\n      return get(/databases/$(database)/documents/users/$(uid)).data.role.hasAny(['admin']);\n    }\n    function isValidDOB(dob) {\n      // Define your custom logic to validate the date of birth format\n      // This is a basic example, you might want to adjust it based on your needs\n      return dob.matches(\"^\\\\d{4}-\\\\d{2}-\\\\d{2}$\");\n    }\n    function isValidFirstName(firstName) {\n      // Define your custom logic to validate the first name\n      // This is a basic example; adjust it based on your needs\n      return firstName is string && firstName.length > 0 && firstName.length < 255;\n    }\n\n    function isValidLastName(lastName) {\n      // Define your custom logic to validate the last name\n      // This is a basic example; adjust it based on your needs\n      return lastName is string && lastName.length > 0 && firstName.length < 255;\n    }\n    // User document rules\n    match /user/{userId} {\n      allow read, write: if request.auth != null && request.auth.uid == userId\n        && request.resource.data.keys().hasAll(['email', 'firstName', 'lastName', 'dob', 'address', 'phone', 'role'])\n        && request.resource.data.email is string // && isValidEmail(request.resource.data.email)\n        && request.resource.data.firstName is string //&& isValidFirstName(firstName)\n        && request.resource.data.lastName is string //&& isValidLastName(lastName)\n        && request.resource.data.dob is string && isValidDOB(request.resource.data.dob)\n        && request.resource.data.address is map && isValidAddress(request.resource.data.address)\n        && request.resource.data.phone is string && isValidPhoneNumber(request.resource.data.phone)\n        && request.resource.data.role is list && request.resource.data.role.size() == 0;\n      allow read, write: if isUserAdmin(request.auth.uid);\n    }\n\n    // Rules for /election/{electionId} path\n    match /election/{electionId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidElectionData(request.resource.data);\n\n      // Function to check if the election data is valid\n      function isValidElectionData(data) {\n        return data != null &&\n        data.keys().hasAll(['startTime', 'endTime', 'title']) &&\n        data.startTime is timestamp &&\n        data.endTime is timestamp &&\n        data.title is string &&\n        // Add additional conditions for start time, end time, and title as needed\n        isValidStartTime(data.startTime) &&\n        isValidEndTime(data.endTime) &&\n        isValidTitle(data.title);\n      }\n\n      // Function to check if the start time is valid (customize as needed)\n      function isValidStartTime(startTime) {\n        // Add your specific logic for validating the start time\n        return startTime != null && startTime.toMillis() > now();\n      }\n\n      // Function to check if the end time is valid (customize as needed)\n      function isValidEndTime(endTime) {\n        // Add your specific logic for validating the end time\n        return endTime != null && endTime.toMillis() > now();\n      }\n\n      // Function to check if the title is valid (customize as needed)\n      function isValidTitle(title) {\n        // Add your specific logic for validating the title\n        return title != null && title.matches(\"^[a-zA-Z0-9 ]+$\"); // Example: Alphanumeric with spaces\n      }\n    }\n\n    // Rules for /election/{electionId}/candidate/{candidateId} path\n    match /election/{electionId}/candidate/{candidateId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidCandidateData(request.resource.data);\n\n      // Function to check if the candidate data is valid\n      function isValidCandidateData(data) {\n        return data != null &&\n        data.keys().hasAll(['name', 'description']) &&\n        data.name is string &&\n        data.description is string;\n      }\n    }\n\n    // Rules for /election/{electionId}/vote/{userId} path\n    match /election/{electionId}/vote/{userId} {\n      allow read: if request.auth != null && request.auth.uid == userId; // Allow the user to read their own vote\n\n      allow write: if request.auth != null && isUserAdmin(request.auth.uid) &&\n      isValidVoteData(request.resource.data);\n\n      // Function to check if the vote data is valid\n      function isValidVoteData(data) {\n        return data != null &&\n        data.keys().hasAll(['candidateIds']) &&\n        data.candidateIds is list &&\n        isValidCandidateIds(data.candidateIds);\n        // Add additional conditions if needed (e.g., checking if the candidateIds are valid)\n      }\n\n     // Function to check if the candidateIds are valid\nfunction isValidCandidateIds(candidateIds) {\n  // Add your specific logic for validating the list of candidateIds\n  // For example, ensure that each candidateId is a string\n\n  return candidateIds is list &&\n    candidateIds.size() > 0 &&\n    candidateIds.size() == candidateIds.count(id => id is string);\n}\n    }\n\n  }\n}\n"}]}}
[debug] [2024-01-04T22:44:37.183Z] Jan 04, 2024 10:44:37 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:44:37 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2024-01-04T22:44:37.286Z] <<< [apiv2][status] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules 200
[debug] [2024-01-04T22:44:37.286Z] <<< [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":147,"column":50,"currentOffset":6542,"endOffset":6542},"description":"Unexpected '='.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":147,"column":65,"currentOffset":6557,"endOffset":6557},"description":"mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":152,"column":1,"currentOffset":6573,"endOffset":6573},"description":"Unexpected '}'.","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:147:50 - ERROR Unexpected '='. 
[warn] ⚠  firestore.rules:147:65 - ERROR mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'} 
[warn] ⚠  firestore.rules:152:1 - ERROR Unexpected '}'. 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2024-01-04T22:44:37.493Z] >>> [apiv2][query] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules [none]
[debug] [2024-01-04T22:44:37.494Z] >>> [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    // Other rules...\n    function isValidPhoneNumber(phone) {\n      // Define your custom logic to validate the phone number format\n      // For example, you can use regular expressions to check the format\n      // Replace the following regular expression with your own validation logic\n      return phone.matches(\"^\\\\+\\\\([0-9]+\\\\)#\\\\* [0-9]+$\");\n    }\n    function isValidEmail(email) {\n      // Define your custom logic to validate the email address format\n      // Replace the following regular expression with your own validation logic\n      return email.matches(\"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\\\.[a-zA-Z]{2,}$\");\n    }\n\n    function isValidAddress(address) {\n      // Check if the address has the required fields\n      return address is map &&\n      'addressLines' in address &&\n      'postcode' in address &&\n      'locality' in address &&\n      'regionCode' in address &&\n      address.addressLines is list && address.addressLines.size() >= 2 &&\n      address.addressLines[0] is string && \n      address.addressLines[1] is string &&\n      address.addressLines[0].size() >= 1 &&\n      address.addressLines[1].size() >= 1 &&\n      address.addressLines[0].size() <= 255 &&\n      address.addressLines[1].size() <= 255 &&\n      address.postcode is string &&\n      address.locality is string &&\n      address.regionCode is string && address.regionCode.size() == 2;\n    }\n    function isUserAdmin(uid) {\n      return get(/databases/$(database)/documents/users/$(uid)).data.role.hasAny(['admin']);\n    }\n    function isValidDOB(dob) {\n      // Define your custom logic to validate the date of birth format\n      // This is a basic example, you might want to adjust it based on your needs\n      return dob.matches(\"^\\\\d{4}-\\\\d{2}-\\\\d{2}$\");\n    }\n    function isValidFirstName(firstName) {\n      // Define your custom logic to validate the first name\n      // This is a basic example; adjust it based on your needs\n      return firstName is string && firstName.length > 0 && firstName.length < 255;\n    }\n\n    function isValidLastName(lastName) {\n      // Define your custom logic to validate the last name\n      // This is a basic example; adjust it based on your needs\n      return lastName is string && lastName.length > 0 && firstName.length < 255;\n    }\n    // User document rules\n    match /user/{userId} {\n      allow read, write: if request.auth != null && request.auth.uid == userId\n        && request.resource.data.keys().hasAll(['email', 'firstName', 'lastName', 'dob', 'address', 'phone', 'role'])\n        && request.resource.data.email is string // && isValidEmail(request.resource.data.email)\n        && request.resource.data.firstName is string //&& isValidFirstName(firstName)\n        && request.resource.data.lastName is string //&& isValidLastName(lastName)\n        && request.resource.data.dob is string && isValidDOB(request.resource.data.dob)\n        && request.resource.data.address is map && isValidAddress(request.resource.data.address)\n        && request.resource.data.phone is string && isValidPhoneNumber(request.resource.data.phone)\n        && request.resource.data.role is list && request.resource.data.role.size() == 0;\n      allow read, write: if isUserAdmin(request.auth.uid);\n    }\n\n    // Rules for /election/{electionId} path\n    match /election/{electionId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidElectionData(request.resource.data);\n\n      // Function to check if the election data is valid\n      function isValidElectionData(data) {\n        return data != null &&\n        data.keys().hasAll(['startTime', 'endTime', 'title']) &&\n        data.startTime is timestamp &&\n        data.endTime is timestamp &&\n        data.title is string &&\n        // Add additional conditions for start time, end time, and title as needed\n        isValidStartTime(data.startTime) &&\n        isValidEndTime(data.endTime) &&\n        isValidTitle(data.title);\n      }\n\n      // Function to check if the start time is valid (customize as needed)\n      function isValidStartTime(startTime) {\n        // Add your specific logic for validating the start time\n        return startTime != null && startTime.toMillis() > now();\n      }\n\n      // Function to check if the end time is valid (customize as needed)\n      function isValidEndTime(endTime) {\n        // Add your specific logic for validating the end time\n        return endTime != null && endTime.toMillis() > now();\n      }\n\n      // Function to check if the title is valid (customize as needed)\n      function isValidTitle(title) {\n        // Add your specific logic for validating the title\n        return title != null && title.matches(\"^[a-zA-Z0-9 ]+$\"); // Example: Alphanumeric with spaces\n      }\n    }\n\n    // Rules for /election/{electionId}/candidate/{candidateId} path\n    match /election/{electionId}/candidate/{candidateId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidCandidateData(request.resource.data);\n\n      // Function to check if the candidate data is valid\n      function isValidCandidateData(data) {\n        return data != null &&\n        data.keys().hasAll(['name', 'description']) &&\n        data.name is string &&\n        data.description is string;\n      }\n    }\n\n    // Rules for /election/{electionId}/vote/{userId} path\n    match /election/{electionId}/vote/{userId} {\n      allow read: if request.auth != null && request.auth.uid == userId; // Allow the user to read their own vote\n\n      allow write: if request.auth != null && isUserAdmin(request.auth.uid) &&\n      isValidVoteData(request.resource.data);\n\n      // Function to check if the vote data is valid\n      function isValidVoteData(data) {\n        return data != null &&\n        data.keys().hasAll(['candidateIds']) &&\n        data.candidateIds is list &&\n        isValidCandidateIds(data.candidateIds);\n        // Add additional conditions if needed (e.g., checking if the candidateIds are valid)\n      }\n\n     // Function to check if the candidateIds are valid\nfunction isValidCandidateIds(candidateIds) {\n  // Add your specific logic for validating the list of candidateIds\n  // For example, ensure that each candidateId is a string\n\n  return candidateIds is list &&\n    candidateIds.size() > 0 &&\n    candidateIds.size() == candidateIds.count(id => id is string);\n}\n    }\n\n  }\n}\n"}]}}
[debug] [2024-01-04T22:44:37.495Z] Jan 04, 2024 10:44:37 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:44:37 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2024-01-04T22:44:37.533Z] <<< [apiv2][status] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules 200
[debug] [2024-01-04T22:44:37.534Z] <<< [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":147,"column":50,"currentOffset":6542,"endOffset":6542},"description":"Unexpected '='.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":147,"column":65,"currentOffset":6557,"endOffset":6557},"description":"mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":152,"column":1,"currentOffset":6573,"endOffset":6573},"description":"Unexpected '}'.","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:147:50 - ERROR Unexpected '='. 
[warn] ⚠  firestore.rules:147:65 - ERROR mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'} 
[warn] ⚠  firestore.rules:152:1 - ERROR Unexpected '}'. 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2024-01-04T22:44:37.681Z] >>> [apiv2][query] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules [none]
[debug] [2024-01-04T22:44:37.681Z] >>> [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    // Other rules...\n    function isValidPhoneNumber(phone) {\n      // Define your custom logic to validate the phone number format\n      // For example, you can use regular expressions to check the format\n      // Replace the following regular expression with your own validation logic\n      return phone.matches(\"^\\\\+\\\\([0-9]+\\\\)#\\\\* [0-9]+$\");\n    }\n    function isValidEmail(email) {\n      // Define your custom logic to validate the email address format\n      // Replace the following regular expression with your own validation logic\n      return email.matches(\"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\\\.[a-zA-Z]{2,}$\");\n    }\n\n    function isValidAddress(address) {\n      // Check if the address has the required fields\n      return address is map &&\n      'addressLines' in address &&\n      'postcode' in address &&\n      'locality' in address &&\n      'regionCode' in address &&\n      address.addressLines is list && address.addressLines.size() >= 2 &&\n      address.addressLines[0] is string && \n      address.addressLines[1] is string &&\n      address.addressLines[0].size() >= 1 &&\n      address.addressLines[1].size() >= 1 &&\n      address.addressLines[0].size() <= 255 &&\n      address.addressLines[1].size() <= 255 &&\n      address.postcode is string &&\n      address.locality is string &&\n      address.regionCode is string && address.regionCode.size() == 2;\n    }\n    function isUserAdmin(uid) {\n      return get(/databases/$(database)/documents/users/$(uid)).data.role.hasAny(['admin']);\n    }\n    function isValidDOB(dob) {\n      // Define your custom logic to validate the date of birth format\n      // This is a basic example, you might want to adjust it based on your needs\n      return dob.matches(\"^\\\\d{4}-\\\\d{2}-\\\\d{2}$\");\n    }\n    function isValidFirstName(firstName) {\n      // Define your custom logic to validate the first name\n      // This is a basic example; adjust it based on your needs\n      return firstName is string && firstName.length > 0 && firstName.length < 255;\n    }\n\n    function isValidLastName(lastName) {\n      // Define your custom logic to validate the last name\n      // This is a basic example; adjust it based on your needs\n      return lastName is string && lastName.length > 0 && firstName.length < 255;\n    }\n    // User document rules\n    match /user/{userId} {\n      allow read, write: if request.auth != null && request.auth.uid == userId\n        && request.resource.data.keys().hasAll(['email', 'firstName', 'lastName', 'dob', 'address', 'phone', 'role'])\n        && request.resource.data.email is string // && isValidEmail(request.resource.data.email)\n        && request.resource.data.firstName is string //&& isValidFirstName(firstName)\n        && request.resource.data.lastName is string //&& isValidLastName(lastName)\n        && request.resource.data.dob is string && isValidDOB(request.resource.data.dob)\n        && request.resource.data.address is map && isValidAddress(request.resource.data.address)\n        && request.resource.data.phone is string && isValidPhoneNumber(request.resource.data.phone)\n        && request.resource.data.role is list && request.resource.data.role.size() == 0;\n      allow read, write: if isUserAdmin(request.auth.uid);\n    }\n\n    // Rules for /election/{electionId} path\n    match /election/{electionId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidElectionData(request.resource.data);\n\n      // Function to check if the election data is valid\n      function isValidElectionData(data) {\n        return data != null &&\n        data.keys().hasAll(['startTime', 'endTime', 'title']) &&\n        data.startTime is timestamp &&\n        data.endTime is timestamp &&\n        data.title is string &&\n        // Add additional conditions for start time, end time, and title as needed\n        isValidStartTime(data.startTime) &&\n        isValidEndTime(data.endTime) &&\n        isValidTitle(data.title);\n      }\n\n      // Function to check if the start time is valid (customize as needed)\n      function isValidStartTime(startTime) {\n        // Add your specific logic for validating the start time\n        return startTime != null && startTime.toMillis() > now();\n      }\n\n      // Function to check if the end time is valid (customize as needed)\n      function isValidEndTime(endTime) {\n        // Add your specific logic for validating the end time\n        return endTime != null && endTime.toMillis() > now();\n      }\n\n      // Function to check if the title is valid (customize as needed)\n      function isValidTitle(title) {\n        // Add your specific logic for validating the title\n        return title != null && title.matches(\"^[a-zA-Z0-9 ]+$\"); // Example: Alphanumeric with spaces\n      }\n    }\n\n    // Rules for /election/{electionId}/candidate/{candidateId} path\n    match /election/{electionId}/candidate/{candidateId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidCandidateData(request.resource.data);\n\n      // Function to check if the candidate data is valid\n      function isValidCandidateData(data) {\n        return data != null &&\n        data.keys().hasAll(['name', 'description']) &&\n        data.name is string &&\n        data.description is string;\n      }\n    }\n\n    // Rules for /election/{electionId}/vote/{userId} path\n    match /election/{electionId}/vote/{userId} {\n      allow read: if request.auth != null && request.auth.uid == userId; // Allow the user to read their own vote\n\n      allow write: if request.auth != null && isUserAdmin(request.auth.uid) &&\n      isValidVoteData(request.resource.data);\n\n      // Function to check if the vote data is valid\n      function isValidVoteData(data) {\n        return data != null &&\n        data.keys().hasAll(['candidateIds']) &&\n        data.candidateIds is list &&\n        isValidCandidateIds(data.candidateIds);\n        // Add additional conditions if needed (e.g., checking if the candidateIds are valid)\n      }\n\n     // Function to check if the candidateIds are valid\nfunction isValidCandidateIds(candidateIds) {\n  // Add your specific logic for validating the list of candidateIds\n  // For example, ensure that each candidateId is a string\n\n  return candidateIds is list &&\n    candidateIds.size() > 0 &&\n    candidateIds.size() == candidateIds.count(id => id is string);\n}\n    }\n\n  }\n}\n"}]}}
[debug] [2024-01-04T22:44:37.682Z] Jan 04, 2024 10:44:37 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:44:37 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2024-01-04T22:44:37.707Z] <<< [apiv2][status] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules 200
[debug] [2024-01-04T22:44:37.707Z] <<< [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":147,"column":50,"currentOffset":6542,"endOffset":6542},"description":"Unexpected '='.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":147,"column":65,"currentOffset":6557,"endOffset":6557},"description":"mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":152,"column":1,"currentOffset":6573,"endOffset":6573},"description":"Unexpected '}'.","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:147:50 - ERROR Unexpected '='. 
[warn] ⚠  firestore.rules:147:65 - ERROR mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'} 
[warn] ⚠  firestore.rules:152:1 - ERROR Unexpected '}'. 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2024-01-04T22:44:38.086Z] >>> [apiv2][query] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules [none]
[debug] [2024-01-04T22:44:38.086Z] >>> [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    // Other rules...\n    function isValidPhoneNumber(phone) {\n      // Define your custom logic to validate the phone number format\n      // For example, you can use regular expressions to check the format\n      // Replace the following regular expression with your own validation logic\n      return phone.matches(\"^\\\\+\\\\([0-9]+\\\\)#\\\\* [0-9]+$\");\n    }\n    function isValidEmail(email) {\n      // Define your custom logic to validate the email address format\n      // Replace the following regular expression with your own validation logic\n      return email.matches(\"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\\\.[a-zA-Z]{2,}$\");\n    }\n\n    function isValidAddress(address) {\n      // Check if the address has the required fields\n      return address is map &&\n      'addressLines' in address &&\n      'postcode' in address &&\n      'locality' in address &&\n      'regionCode' in address &&\n      address.addressLines is list && address.addressLines.size() >= 2 &&\n      address.addressLines[0] is string && \n      address.addressLines[1] is string &&\n      address.addressLines[0].size() >= 1 &&\n      address.addressLines[1].size() >= 1 &&\n      address.addressLines[0].size() <= 255 &&\n      address.addressLines[1].size() <= 255 &&\n      address.postcode is string &&\n      address.locality is string &&\n      address.regionCode is string && address.regionCode.size() == 2;\n    }\n    function isUserAdmin(uid) {\n      return get(/databases/$(database)/documents/users/$(uid)).data.role.hasAny(['admin']);\n    }\n    function isValidDOB(dob) {\n      // Define your custom logic to validate the date of birth format\n      // This is a basic example, you might want to adjust it based on your needs\n      return dob.matches(\"^\\\\d{4}-\\\\d{2}-\\\\d{2}$\");\n    }\n    function isValidFirstName(firstName) {\n      // Define your custom logic to validate the first name\n      // This is a basic example; adjust it based on your needs\n      return firstName is string && firstName.length > 0 && firstName.length < 255;\n    }\n\n    function isValidLastName(lastName) {\n      // Define your custom logic to validate the last name\n      // This is a basic example; adjust it based on your needs\n      return lastName is string && lastName.length > 0 && firstName.length < 255;\n    }\n    // User document rules\n    match /user/{userId} {\n      allow read, write: if request.auth != null && request.auth.uid == userId\n        && request.resource.data.keys().hasAll(['email', 'firstName', 'lastName', 'dob', 'address', 'phone', 'role'])\n        && request.resource.data.email is string // && isValidEmail(request.resource.data.email)\n        && request.resource.data.firstName is string //&& isValidFirstName(firstName)\n        && request.resource.data.lastName is string //&& isValidLastName(lastName)\n        && request.resource.data.dob is string && isValidDOB(request.resource.data.dob)\n        && request.resource.data.address is map && isValidAddress(request.resource.data.address)\n        && request.resource.data.phone is string && isValidPhoneNumber(request.resource.data.phone)\n        && request.resource.data.role is list && request.resource.data.role.size() == 0;\n      allow read, write: if isUserAdmin(request.auth.uid);\n    }\n\n    // Rules for /election/{electionId} path\n    match /election/{electionId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidElectionData(request.resource.data);\n\n      // Function to check if the election data is valid\n      function isValidElectionData(data) {\n        return data != null &&\n        data.keys().hasAll(['startTime', 'endTime', 'title']) &&\n        data.startTime is timestamp &&\n        data.endTime is timestamp &&\n        data.title is string &&\n        // Add additional conditions for start time, end time, and title as needed\n        isValidStartTime(data.startTime) &&\n        isValidEndTime(data.endTime) &&\n        isValidTitle(data.title);\n      }\n\n      // Function to check if the start time is valid (customize as needed)\n      function isValidStartTime(startTime) {\n        // Add your specific logic for validating the start time\n        return startTime != null && startTime.toMillis() > now();\n      }\n\n      // Function to check if the end time is valid (customize as needed)\n      function isValidEndTime(endTime) {\n        // Add your specific logic for validating the end time\n        return endTime != null && endTime.toMillis() > now();\n      }\n\n      // Function to check if the title is valid (customize as needed)\n      function isValidTitle(title) {\n        // Add your specific logic for validating the title\n        return title != null && title.matches(\"^[a-zA-Z0-9 ]+$\"); // Example: Alphanumeric with spaces\n      }\n    }\n\n    // Rules for /election/{electionId}/candidate/{candidateId} path\n    match /election/{electionId}/candidate/{candidateId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidCandidateData(request.resource.data);\n\n      // Function to check if the candidate data is valid\n      function isValidCandidateData(data) {\n        return data != null &&\n        data.keys().hasAll(['name', 'description']) &&\n        data.name is string &&\n        data.description is string;\n      }\n    }\n\n    // Rules for /election/{electionId}/vote/{userId} path\n    match /election/{electionId}/vote/{userId} {\n      allow read: if request.auth != null && request.auth.uid == userId; // Allow the user to read their own vote\n\n      allow write: if request.auth != null && isUserAdmin(request.auth.uid) &&\n      isValidVoteData(request.resource.data);\n\n      // Function to check if the vote data is valid\n      function isValidVoteData(data) {\n        return data != null &&\n        data.keys().hasAll(['candidateIds']) &&\n        data.candidateIds is list &&\n        isValidCandidateIds(data.candidateIds);\n        // Add additional conditions if needed (e.g., checking if the candidateIds are valid)\n      }\n\n     // Function to check if the candidateIds are valid\nfunction isValidCandidateIds(candidateIds) {\n  // Add your specific logic for validating the list of candidateIds\n  // For example, ensure that each candidateId is a string\n\n  return candidateIds is list &&\n    candidateIds.size() > 0 &&\n    candidateIds.size() == candidateIds.count(id => id is string);\n}\n    }\n\n  }\n}\n"}]}}
[debug] [2024-01-04T22:44:38.087Z] Jan 04, 2024 10:44:38 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:44:38 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2024-01-04T22:44:38.113Z] <<< [apiv2][status] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules 200
[debug] [2024-01-04T22:44:38.113Z] <<< [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":147,"column":50,"currentOffset":6542,"endOffset":6542},"description":"Unexpected '='.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":147,"column":65,"currentOffset":6557,"endOffset":6557},"description":"mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":152,"column":1,"currentOffset":6573,"endOffset":6573},"description":"Unexpected '}'.","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:147:50 - ERROR Unexpected '='. 
[warn] ⚠  firestore.rules:147:65 - ERROR mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'} 
[warn] ⚠  firestore.rules:152:1 - ERROR Unexpected '}'. 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2024-01-04T22:44:38.341Z] >>> [apiv2][query] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules [none]
[debug] [2024-01-04T22:44:38.341Z] >>> [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    // Other rules...\n    function isValidPhoneNumber(phone) {\n      // Define your custom logic to validate the phone number format\n      // For example, you can use regular expressions to check the format\n      // Replace the following regular expression with your own validation logic\n      return phone.matches(\"^\\\\+\\\\([0-9]+\\\\)#\\\\* [0-9]+$\");\n    }\n    function isValidEmail(email) {\n      // Define your custom logic to validate the email address format\n      // Replace the following regular expression with your own validation logic\n      return email.matches(\"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\\\.[a-zA-Z]{2,}$\");\n    }\n\n    function isValidAddress(address) {\n      // Check if the address has the required fields\n      return address is map &&\n      'addressLines' in address &&\n      'postcode' in address &&\n      'locality' in address &&\n      'regionCode' in address &&\n      address.addressLines is list && address.addressLines.size() >= 2 &&\n      address.addressLines[0] is string && \n      address.addressLines[1] is string &&\n      address.addressLines[0].size() >= 1 &&\n      address.addressLines[1].size() >= 1 &&\n      address.addressLines[0].size() <= 255 &&\n      address.addressLines[1].size() <= 255 &&\n      address.postcode is string &&\n      address.locality is string &&\n      address.regionCode is string && address.regionCode.size() == 2;\n    }\n    function isUserAdmin(uid) {\n      return get(/databases/$(database)/documents/users/$(uid)).data.role.hasAny(['admin']);\n    }\n    function isValidDOB(dob) {\n      // Define your custom logic to validate the date of birth format\n      // This is a basic example, you might want to adjust it based on your needs\n      return dob.matches(\"^\\\\d{4}-\\\\d{2}-\\\\d{2}$\");\n    }\n    function isValidFirstName(firstName) {\n      // Define your custom logic to validate the first name\n      // This is a basic example; adjust it based on your needs\n      return firstName is string && firstName.length > 0 && firstName.length < 255;\n    }\n\n    function isValidLastName(lastName) {\n      // Define your custom logic to validate the last name\n      // This is a basic example; adjust it based on your needs\n      return lastName is string && lastName.length > 0 && firstName.length < 255;\n    }\n    // User document rules\n    match /user/{userId} {\n      allow read, write: if request.auth != null && request.auth.uid == userId\n        && request.resource.data.keys().hasAll(['email', 'firstName', 'lastName', 'dob', 'address', 'phone', 'role'])\n        && request.resource.data.email is string // && isValidEmail(request.resource.data.email)\n        && request.resource.data.firstName is string //&& isValidFirstName(firstName)\n        && request.resource.data.lastName is string //&& isValidLastName(lastName)\n        && request.resource.data.dob is string && isValidDOB(request.resource.data.dob)\n        && request.resource.data.address is map && isValidAddress(request.resource.data.address)\n        && request.resource.data.phone is string && isValidPhoneNumber(request.resource.data.phone)\n        && request.resource.data.role is list && request.resource.data.role.size() == 0;\n      allow read, write: if isUserAdmin(request.auth.uid);\n    }\n\n    // Rules for /election/{electionId} path\n    match /election/{electionId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidElectionData(request.resource.data);\n\n      // Function to check if the election data is valid\n      function isValidElectionData(data) {\n        return data != null &&\n        data.keys().hasAll(['startTime', 'endTime', 'title']) &&\n        data.startTime is timestamp &&\n        data.endTime is timestamp &&\n        data.title is string &&\n        // Add additional conditions for start time, end time, and title as needed\n        isValidStartTime(data.startTime) &&\n        isValidEndTime(data.endTime) &&\n        isValidTitle(data.title);\n      }\n\n      // Function to check if the start time is valid (customize as needed)\n      function isValidStartTime(startTime) {\n        // Add your specific logic for validating the start time\n        return startTime != null && startTime.toMillis() > now();\n      }\n\n      // Function to check if the end time is valid (customize as needed)\n      function isValidEndTime(endTime) {\n        // Add your specific logic for validating the end time\n        return endTime != null && endTime.toMillis() > now();\n      }\n\n      // Function to check if the title is valid (customize as needed)\n      function isValidTitle(title) {\n        // Add your specific logic for validating the title\n        return title != null && title.matches(\"^[a-zA-Z0-9 ]+$\"); // Example: Alphanumeric with spaces\n      }\n    }\n\n    // Rules for /election/{electionId}/candidate/{candidateId} path\n    match /election/{electionId}/candidate/{candidateId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidCandidateData(request.resource.data);\n\n      // Function to check if the candidate data is valid\n      function isValidCandidateData(data) {\n        return data != null &&\n        data.keys().hasAll(['name', 'description']) &&\n        data.name is string &&\n        data.description is string;\n      }\n    }\n\n    // Rules for /election/{electionId}/vote/{userId} path\n    match /election/{electionId}/vote/{userId} {\n      allow read: if request.auth != null && request.auth.uid == userId; // Allow the user to read their own vote\n\n      allow write: if request.auth != null && isUserAdmin(request.auth.uid) &&\n      isValidVoteData(request.resource.data);\n\n      // Function to check if the vote data is valid\n      function isValidVoteData(data) {\n        return data != null &&\n        data.keys().hasAll(['candidateIds']) &&\n        data.candidateIds is list &&\n        isValidCandidateIds(data.candidateIds);\n        // Add additional conditions if needed (e.g., checking if the candidateIds are valid)\n      }\n\n     // Function to check if the candidateIds are valid\nfunction isValidCandidateIds(candidateIds) {\n  // Add your specific logic for validating the list of candidateIds\n  // For example, ensure that each candidateId is a string\n\n  return candidateIds is list &&\n    candidateIds.size() > 0 &&\n    candidateIds.size() == candidateIds.count(id => id is string);\n}\n    }\n\n  }\n}\n"}]}}
[debug] [2024-01-04T22:44:38.347Z] Jan 04, 2024 10:44:38 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:44:38 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2024-01-04T22:44:38.387Z] <<< [apiv2][status] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules 200
[debug] [2024-01-04T22:44:38.387Z] <<< [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":147,"column":50,"currentOffset":6542,"endOffset":6542},"description":"Unexpected '='.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":147,"column":65,"currentOffset":6557,"endOffset":6557},"description":"mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":152,"column":1,"currentOffset":6573,"endOffset":6573},"description":"Unexpected '}'.","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:147:50 - ERROR Unexpected '='. 
[warn] ⚠  firestore.rules:147:65 - ERROR mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'} 
[warn] ⚠  firestore.rules:152:1 - ERROR Unexpected '}'. 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2024-01-04T22:44:38.622Z] >>> [apiv2][query] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules [none]
[debug] [2024-01-04T22:44:38.622Z] >>> [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    // Other rules...\n    function isValidPhoneNumber(phone) {\n      // Define your custom logic to validate the phone number format\n      // For example, you can use regular expressions to check the format\n      // Replace the following regular expression with your own validation logic\n      return phone.matches(\"^\\\\+\\\\([0-9]+\\\\)#\\\\* [0-9]+$\");\n    }\n    function isValidEmail(email) {\n      // Define your custom logic to validate the email address format\n      // Replace the following regular expression with your own validation logic\n      return email.matches(\"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\\\.[a-zA-Z]{2,}$\");\n    }\n\n    function isValidAddress(address) {\n      // Check if the address has the required fields\n      return address is map &&\n      'addressLines' in address &&\n      'postcode' in address &&\n      'locality' in address &&\n      'regionCode' in address &&\n      address.addressLines is list && address.addressLines.size() >= 2 &&\n      address.addressLines[0] is string && \n      address.addressLines[1] is string &&\n      address.addressLines[0].size() >= 1 &&\n      address.addressLines[1].size() >= 1 &&\n      address.addressLines[0].size() <= 255 &&\n      address.addressLines[1].size() <= 255 &&\n      address.postcode is string &&\n      address.locality is string &&\n      address.regionCode is string && address.regionCode.size() == 2;\n    }\n    function isUserAdmin(uid) {\n      return get(/databases/$(database)/documents/users/$(uid)).data.role.hasAny(['admin']);\n    }\n    function isValidDOB(dob) {\n      // Define your custom logic to validate the date of birth format\n      // This is a basic example, you might want to adjust it based on your needs\n      return dob.matches(\"^\\\\d{4}-\\\\d{2}-\\\\d{2}$\");\n    }\n    function isValidFirstName(firstName) {\n      // Define your custom logic to validate the first name\n      // This is a basic example; adjust it based on your needs\n      return firstName is string && firstName.length > 0 && firstName.length < 255;\n    }\n\n    function isValidLastName(lastName) {\n      // Define your custom logic to validate the last name\n      // This is a basic example; adjust it based on your needs\n      return lastName is string && lastName.length > 0 && firstName.length < 255;\n    }\n    // User document rules\n    match /user/{userId} {\n      allow read, write: if request.auth != null && request.auth.uid == userId\n        && request.resource.data.keys().hasAll(['email', 'firstName', 'lastName', 'dob', 'address', 'phone', 'role'])\n        && request.resource.data.email is string // && isValidEmail(request.resource.data.email)\n        && request.resource.data.firstName is string //&& isValidFirstName(firstName)\n        && request.resource.data.lastName is string //&& isValidLastName(lastName)\n        && request.resource.data.dob is string && isValidDOB(request.resource.data.dob)\n        && request.resource.data.address is map && isValidAddress(request.resource.data.address)\n        && request.resource.data.phone is string && isValidPhoneNumber(request.resource.data.phone)\n        && request.resource.data.role is list && request.resource.data.role.size() == 0;\n      allow read, write: if isUserAdmin(request.auth.uid);\n    }\n\n    // Rules for /election/{electionId} path\n    match /election/{electionId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidElectionData(request.resource.data);\n\n      // Function to check if the election data is valid\n      function isValidElectionData(data) {\n        return data != null &&\n        data.keys().hasAll(['startTime', 'endTime', 'title']) &&\n        data.startTime is timestamp &&\n        data.endTime is timestamp &&\n        data.title is string &&\n        // Add additional conditions for start time, end time, and title as needed\n        isValidStartTime(data.startTime) &&\n        isValidEndTime(data.endTime) &&\n        isValidTitle(data.title);\n      }\n\n      // Function to check if the start time is valid (customize as needed)\n      function isValidStartTime(startTime) {\n        // Add your specific logic for validating the start time\n        return startTime != null && startTime.toMillis() > now();\n      }\n\n      // Function to check if the end time is valid (customize as needed)\n      function isValidEndTime(endTime) {\n        // Add your specific logic for validating the end time\n        return endTime != null && endTime.toMillis() > now();\n      }\n\n      // Function to check if the title is valid (customize as needed)\n      function isValidTitle(title) {\n        // Add your specific logic for validating the title\n        return title != null && title.matches(\"^[a-zA-Z0-9 ]+$\"); // Example: Alphanumeric with spaces\n      }\n    }\n\n    // Rules for /election/{electionId}/candidate/{candidateId} path\n    match /election/{electionId}/candidate/{candidateId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidCandidateData(request.resource.data);\n\n      // Function to check if the candidate data is valid\n      function isValidCandidateData(data) {\n        return data != null &&\n        data.keys().hasAll(['name', 'description']) &&\n        data.name is string &&\n        data.description is string;\n      }\n    }\n\n    // Rules for /election/{electionId}/vote/{userId} path\n    match /election/{electionId}/vote/{userId} {\n      allow read: if request.auth != null && request.auth.uid == userId; // Allow the user to read their own vote\n\n      allow write: if request.auth != null && isUserAdmin(request.auth.uid) &&\n      isValidVoteData(request.resource.data);\n\n      // Function to check if the vote data is valid\n      function isValidVoteData(data) {\n        return data != null &&\n        data.keys().hasAll(['candidateIds']) &&\n        data.candidateIds is list &&\n        isValidCandidateIds(data.candidateIds);\n        // Add additional conditions if needed (e.g., checking if the candidateIds are valid)\n      }\n\n     // Function to check if the candidateIds are valid\nfunction isValidCandidateIds(candidateIds) {\n  // Add your specific logic for validating the list of candidateIds\n  // For example, ensure that each candidateId is a string\n\n  return candidateIds is list &&\n    candidateIds.size() > 0 &&\n    candidateIds.size() == candidateIds.count(id => id is string);\n}\n    }\n\n  }\n}\n"}]}}
[debug] [2024-01-04T22:44:38.625Z] Jan 04, 2024 10:44:38 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:44:38 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2024-01-04T22:44:38.651Z] <<< [apiv2][status] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules 200
[debug] [2024-01-04T22:44:38.651Z] <<< [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":147,"column":50,"currentOffset":6542,"endOffset":6542},"description":"Unexpected '='.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":147,"column":65,"currentOffset":6557,"endOffset":6557},"description":"mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":152,"column":1,"currentOffset":6573,"endOffset":6573},"description":"Unexpected '}'.","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:147:50 - ERROR Unexpected '='. 
[warn] ⚠  firestore.rules:147:65 - ERROR mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'} 
[warn] ⚠  firestore.rules:152:1 - ERROR Unexpected '}'. 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2024-01-04T22:44:39.041Z] >>> [apiv2][query] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules [none]
[debug] [2024-01-04T22:44:39.041Z] >>> [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    // Other rules...\n    function isValidPhoneNumber(phone) {\n      // Define your custom logic to validate the phone number format\n      // For example, you can use regular expressions to check the format\n      // Replace the following regular expression with your own validation logic\n      return phone.matches(\"^\\\\+\\\\([0-9]+\\\\)#\\\\* [0-9]+$\");\n    }\n    function isValidEmail(email) {\n      // Define your custom logic to validate the email address format\n      // Replace the following regular expression with your own validation logic\n      return email.matches(\"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\\\.[a-zA-Z]{2,}$\");\n    }\n\n    function isValidAddress(address) {\n      // Check if the address has the required fields\n      return address is map &&\n      'addressLines' in address &&\n      'postcode' in address &&\n      'locality' in address &&\n      'regionCode' in address &&\n      address.addressLines is list && address.addressLines.size() >= 2 &&\n      address.addressLines[0] is string && \n      address.addressLines[1] is string &&\n      address.addressLines[0].size() >= 1 &&\n      address.addressLines[1].size() >= 1 &&\n      address.addressLines[0].size() <= 255 &&\n      address.addressLines[1].size() <= 255 &&\n      address.postcode is string &&\n      address.locality is string &&\n      address.regionCode is string && address.regionCode.size() == 2;\n    }\n    function isUserAdmin(uid) {\n      return get(/databases/$(database)/documents/users/$(uid)).data.role.hasAny(['admin']);\n    }\n    function isValidDOB(dob) {\n      // Define your custom logic to validate the date of birth format\n      // This is a basic example, you might want to adjust it based on your needs\n      return dob.matches(\"^\\\\d{4}-\\\\d{2}-\\\\d{2}$\");\n    }\n    function isValidFirstName(firstName) {\n      // Define your custom logic to validate the first name\n      // This is a basic example; adjust it based on your needs\n      return firstName is string && firstName.length > 0 && firstName.length < 255;\n    }\n\n    function isValidLastName(lastName) {\n      // Define your custom logic to validate the last name\n      // This is a basic example; adjust it based on your needs\n      return lastName is string && lastName.length > 0 && firstName.length < 255;\n    }\n    // User document rules\n    match /user/{userId} {\n      allow read, write: if request.auth != null && request.auth.uid == userId\n        && request.resource.data.keys().hasAll(['email', 'firstName', 'lastName', 'dob', 'address', 'phone', 'role'])\n        && request.resource.data.email is string // && isValidEmail(request.resource.data.email)\n        && request.resource.data.firstName is string //&& isValidFirstName(firstName)\n        && request.resource.data.lastName is string //&& isValidLastName(lastName)\n        && request.resource.data.dob is string && isValidDOB(request.resource.data.dob)\n        && request.resource.data.address is map && isValidAddress(request.resource.data.address)\n        && request.resource.data.phone is string && isValidPhoneNumber(request.resource.data.phone)\n        && request.resource.data.role is list && request.resource.data.role.size() == 0;\n      allow read, write: if isUserAdmin(request.auth.uid);\n    }\n\n    // Rules for /election/{electionId} path\n    match /election/{electionId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidElectionData(request.resource.data);\n\n      // Function to check if the election data is valid\n      function isValidElectionData(data) {\n        return data != null &&\n        data.keys().hasAll(['startTime', 'endTime', 'title']) &&\n        data.startTime is timestamp &&\n        data.endTime is timestamp &&\n        data.title is string &&\n        // Add additional conditions for start time, end time, and title as needed\n        isValidStartTime(data.startTime) &&\n        isValidEndTime(data.endTime) &&\n        isValidTitle(data.title);\n      }\n\n      // Function to check if the start time is valid (customize as needed)\n      function isValidStartTime(startTime) {\n        // Add your specific logic for validating the start time\n        return startTime != null && startTime.toMillis() > now();\n      }\n\n      // Function to check if the end time is valid (customize as needed)\n      function isValidEndTime(endTime) {\n        // Add your specific logic for validating the end time\n        return endTime != null && endTime.toMillis() > now();\n      }\n\n      // Function to check if the title is valid (customize as needed)\n      function isValidTitle(title) {\n        // Add your specific logic for validating the title\n        return title != null && title.matches(\"^[a-zA-Z0-9 ]+$\"); // Example: Alphanumeric with spaces\n      }\n    }\n\n    // Rules for /election/{electionId}/candidate/{candidateId} path\n    match /election/{electionId}/candidate/{candidateId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidCandidateData(request.resource.data);\n\n      // Function to check if the candidate data is valid\n      function isValidCandidateData(data) {\n        return data != null &&\n        data.keys().hasAll(['name', 'description']) &&\n        data.name is string &&\n        data.description is string;\n      }\n    }\n\n    // Rules for /election/{electionId}/vote/{userId} path\n    match /election/{electionId}/vote/{userId} {\n      allow read: if request.auth != null && request.auth.uid == userId; // Allow the user to read their own vote\n\n      allow write: if request.auth != null && isUserAdmin(request.auth.uid) &&\n      isValidVoteData(request.resource.data);\n\n      // Function to check if the vote data is valid\n      function isValidVoteData(data) {\n        return data != null &&\n        data.keys().hasAll(['candidateIds']) &&\n        data.candidateIds is list &&\n        isValidCandidateIds(data.candidateIds);\n        // Add additional conditions if needed (e.g., checking if the candidateIds are valid)\n      }\n\n     // Function to check if the candidateIds are valid\nfunction isValidCandidateIds(candidateIds) {\n  // Add your specific logic for validating the list of candidateIds\n  // For example, ensure that each candidateId is a string\n\n  return candidateIds is list &&\n    candidateIds.size() > 0 &&\n    candidateIds.size() == candidateIds.count(id => id is string);\n}\n    }\n\n  }\n}\n"}]}}
[debug] [2024-01-04T22:44:39.043Z] Jan 04, 2024 10:44:39 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:44:39 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2024-01-04T22:44:39.068Z] <<< [apiv2][status] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules 200
[debug] [2024-01-04T22:44:39.068Z] <<< [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":147,"column":50,"currentOffset":6542,"endOffset":6542},"description":"Unexpected '='.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":147,"column":65,"currentOffset":6557,"endOffset":6557},"description":"mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":152,"column":1,"currentOffset":6573,"endOffset":6573},"description":"Unexpected '}'.","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:147:50 - ERROR Unexpected '='. 
[warn] ⚠  firestore.rules:147:65 - ERROR mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'} 
[warn] ⚠  firestore.rules:152:1 - ERROR Unexpected '}'. 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2024-01-04T22:44:39.598Z] >>> [apiv2][query] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules [none]
[debug] [2024-01-04T22:44:39.598Z] >>> [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    // Other rules...\n    function isValidPhoneNumber(phone) {\n      // Define your custom logic to validate the phone number format\n      // For example, you can use regular expressions to check the format\n      // Replace the following regular expression with your own validation logic\n      return phone.matches(\"^\\\\+\\\\([0-9]+\\\\)#\\\\* [0-9]+$\");\n    }\n    function isValidEmail(email) {\n      // Define your custom logic to validate the email address format\n      // Replace the following regular expression with your own validation logic\n      return email.matches(\"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\\\.[a-zA-Z]{2,}$\");\n    }\n\n    function isValidAddress(address) {\n      // Check if the address has the required fields\n      return address is map &&\n      'addressLines' in address &&\n      'postcode' in address &&\n      'locality' in address &&\n      'regionCode' in address &&\n      address.addressLines is list && address.addressLines.size() >= 2 &&\n      address.addressLines[0] is string && \n      address.addressLines[1] is string &&\n      address.addressLines[0].size() >= 1 &&\n      address.addressLines[1].size() >= 1 &&\n      address.addressLines[0].size() <= 255 &&\n      address.addressLines[1].size() <= 255 &&\n      address.postcode is string &&\n      address.locality is string &&\n      address.regionCode is string && address.regionCode.size() == 2;\n    }\n    function isUserAdmin(uid) {\n      return get(/databases/$(database)/documents/users/$(uid)).data.role.hasAny(['admin']);\n    }\n    function isValidDOB(dob) {\n      // Define your custom logic to validate the date of birth format\n      // This is a basic example, you might want to adjust it based on your needs\n      return dob.matches(\"^\\\\d{4}-\\\\d{2}-\\\\d{2}$\");\n    }\n    function isValidFirstName(firstName) {\n      // Define your custom logic to validate the first name\n      // This is a basic example; adjust it based on your needs\n      return firstName is string && firstName.length > 0 && firstName.length < 255;\n    }\n\n    function isValidLastName(lastName) {\n      // Define your custom logic to validate the last name\n      // This is a basic example; adjust it based on your needs\n      return lastName is string && lastName.length > 0 && firstName.length < 255;\n    }\n    // User document rules\n    match /user/{userId} {\n      allow read, write: if request.auth != null && request.auth.uid == userId\n        && request.resource.data.keys().hasAll(['email', 'firstName', 'lastName', 'dob', 'address', 'phone', 'role'])\n        && request.resource.data.email is string // && isValidEmail(request.resource.data.email)\n        && request.resource.data.firstName is string //&& isValidFirstName(firstName)\n        && request.resource.data.lastName is string //&& isValidLastName(lastName)\n        && request.resource.data.dob is string && isValidDOB(request.resource.data.dob)\n        && request.resource.data.address is map && isValidAddress(request.resource.data.address)\n        && request.resource.data.phone is string && isValidPhoneNumber(request.resource.data.phone)\n        && request.resource.data.role is list && request.resource.data.role.size() == 0;\n      allow read, write: if isUserAdmin(request.auth.uid);\n    }\n\n    // Rules for /election/{electionId} path\n    match /election/{electionId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidElectionData(request.resource.data);\n\n      // Function to check if the election data is valid\n      function isValidElectionData(data) {\n        return data != null &&\n        data.keys().hasAll(['startTime', 'endTime', 'title']) &&\n        data.startTime is timestamp &&\n        data.endTime is timestamp &&\n        data.title is string &&\n        // Add additional conditions for start time, end time, and title as needed\n        isValidStartTime(data.startTime) &&\n        isValidEndTime(data.endTime) &&\n        isValidTitle(data.title);\n      }\n\n      // Function to check if the start time is valid (customize as needed)\n      function isValidStartTime(startTime) {\n        // Add your specific logic for validating the start time\n        return startTime != null && startTime.toMillis() > now();\n      }\n\n      // Function to check if the end time is valid (customize as needed)\n      function isValidEndTime(endTime) {\n        // Add your specific logic for validating the end time\n        return endTime != null && endTime.toMillis() > now();\n      }\n\n      // Function to check if the title is valid (customize as needed)\n      function isValidTitle(title) {\n        // Add your specific logic for validating the title\n        return title != null && title.matches(\"^[a-zA-Z0-9 ]+$\"); // Example: Alphanumeric with spaces\n      }\n    }\n\n    // Rules for /election/{electionId}/candidate/{candidateId} path\n    match /election/{electionId}/candidate/{candidateId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidCandidateData(request.resource.data);\n\n      // Function to check if the candidate data is valid\n      function isValidCandidateData(data) {\n        return data != null &&\n        data.keys().hasAll(['name', 'description']) &&\n        data.name is string &&\n        data.description is string;\n      }\n    }\n\n    // Rules for /election/{electionId}/vote/{userId} path\n    match /election/{electionId}/vote/{userId} {\n      allow read: if request.auth != null && request.auth.uid == userId; // Allow the user to read their own vote\n\n      allow write: if request.auth != null && isUserAdmin(request.auth.uid) &&\n      isValidVoteData(request.resource.data);\n\n      // Function to check if the vote data is valid\n      function isValidVoteData(data) {\n        return data != null &&\n        data.keys().hasAll(['candidateIds']) &&\n        data.candidateIds is list &&\n        isValidCandidateIds(data.candidateIds);\n        // Add additional conditions if needed (e.g., checking if the candidateIds are valid)\n      }\n\n     // Function to check if the candidateIds are valid\nfunction isValidCandidateIds(candidateIds) {\n  // Add your specific logic for validating the list of candidateIds\n  // For example, ensure that each candidateId is a string\n\n  return candidateIds is list &&\n    candidateIds.size() > 0 &&\n    candidateIds.size() == candidateIds.count(id => id is string);\n}\n    }\n\n  }\n}\n"}]}}
[debug] [2024-01-04T22:44:39.610Z] Jan 04, 2024 10:44:39 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:44:39 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2024-01-04T22:44:39.641Z] <<< [apiv2][status] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules 200
[debug] [2024-01-04T22:44:39.641Z] <<< [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":147,"column":50,"currentOffset":6542,"endOffset":6542},"description":"Unexpected '='.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":147,"column":65,"currentOffset":6557,"endOffset":6557},"description":"mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":152,"column":1,"currentOffset":6573,"endOffset":6573},"description":"Unexpected '}'.","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:147:50 - ERROR Unexpected '='. 
[warn] ⚠  firestore.rules:147:65 - ERROR mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'} 
[warn] ⚠  firestore.rules:152:1 - ERROR Unexpected '}'. 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2024-01-04T22:44:39.999Z] >>> [apiv2][query] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules [none]
[debug] [2024-01-04T22:44:39.999Z] >>> [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    // Other rules...\n    function isValidPhoneNumber(phone) {\n      // Define your custom logic to validate the phone number format\n      // For example, you can use regular expressions to check the format\n      // Replace the following regular expression with your own validation logic\n      return phone.matches(\"^\\\\+\\\\([0-9]+\\\\)#\\\\* [0-9]+$\");\n    }\n    function isValidEmail(email) {\n      // Define your custom logic to validate the email address format\n      // Replace the following regular expression with your own validation logic\n      return email.matches(\"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\\\.[a-zA-Z]{2,}$\");\n    }\n\n    function isValidAddress(address) {\n      // Check if the address has the required fields\n      return address is map &&\n      'addressLines' in address &&\n      'postcode' in address &&\n      'locality' in address &&\n      'regionCode' in address &&\n      address.addressLines is list && address.addressLines.size() >= 2 &&\n      address.addressLines[0] is string && \n      address.addressLines[1] is string &&\n      address.addressLines[0].size() >= 1 &&\n      address.addressLines[1].size() >= 1 &&\n      address.addressLines[0].size() <= 255 &&\n      address.addressLines[1].size() <= 255 &&\n      address.postcode is string &&\n      address.locality is string &&\n      address.regionCode is string && address.regionCode.size() == 2;\n    }\n    function isUserAdmin(uid) {\n      return get(/databases/$(database)/documents/users/$(uid)).data.role.hasAny(['admin']);\n    }\n    function isValidDOB(dob) {\n      // Define your custom logic to validate the date of birth format\n      // This is a basic example, you might want to adjust it based on your needs\n      return dob.matches(\"^\\\\d{4}-\\\\d{2}-\\\\d{2}$\");\n    }\n    function isValidFirstName(firstName) {\n      // Define your custom logic to validate the first name\n      // This is a basic example; adjust it based on your needs\n      return firstName is string && firstName.length > 0 && firstName.length < 255;\n    }\n\n    function isValidLastName(lastName) {\n      // Define your custom logic to validate the last name\n      // This is a basic example; adjust it based on your needs\n      return lastName is string && lastName.length > 0 && firstName.length < 255;\n    }\n    // User document rules\n    match /user/{userId} {\n      allow read, write: if request.auth != null && request.auth.uid == userId\n        && request.resource.data.keys().hasAll(['email', 'firstName', 'lastName', 'dob', 'address', 'phone', 'role'])\n        && request.resource.data.email is string // && isValidEmail(request.resource.data.email)\n        && request.resource.data.firstName is string //&& isValidFirstName(firstName)\n        && request.resource.data.lastName is string //&& isValidLastName(lastName)\n        && request.resource.data.dob is string && isValidDOB(request.resource.data.dob)\n        && request.resource.data.address is map && isValidAddress(request.resource.data.address)\n        && request.resource.data.phone is string && isValidPhoneNumber(request.resource.data.phone)\n        && request.resource.data.role is list && request.resource.data.role.size() == 0;\n      allow read, write: if isUserAdmin(request.auth.uid);\n    }\n\n    // Rules for /election/{electionId} path\n    match /election/{electionId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidElectionData(request.resource.data);\n\n      // Function to check if the election data is valid\n      function isValidElectionData(data) {\n        return data != null &&\n        data.keys().hasAll(['startTime', 'endTime', 'title']) &&\n        data.startTime is timestamp &&\n        data.endTime is timestamp &&\n        data.title is string &&\n        // Add additional conditions for start time, end time, and title as needed\n        isValidStartTime(data.startTime) &&\n        isValidEndTime(data.endTime) &&\n        isValidTitle(data.title);\n      }\n\n      // Function to check if the start time is valid (customize as needed)\n      function isValidStartTime(startTime) {\n        // Add your specific logic for validating the start time\n        return startTime != null && startTime.toMillis() > now();\n      }\n\n      // Function to check if the end time is valid (customize as needed)\n      function isValidEndTime(endTime) {\n        // Add your specific logic for validating the end time\n        return endTime != null && endTime.toMillis() > now();\n      }\n\n      // Function to check if the title is valid (customize as needed)\n      function isValidTitle(title) {\n        // Add your specific logic for validating the title\n        return title != null && title.matches(\"^[a-zA-Z0-9 ]+$\"); // Example: Alphanumeric with spaces\n      }\n    }\n\n    // Rules for /election/{electionId}/candidate/{candidateId} path\n    match /election/{electionId}/candidate/{candidateId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidCandidateData(request.resource.data);\n\n      // Function to check if the candidate data is valid\n      function isValidCandidateData(data) {\n        return data != null &&\n        data.keys().hasAll(['name', 'description']) &&\n        data.name is string &&\n        data.description is string;\n      }\n    }\n\n    // Rules for /election/{electionId}/vote/{userId} path\n    match /election/{electionId}/vote/{userId} {\n      allow read: if request.auth != null && request.auth.uid == userId; // Allow the user to read their own vote\n\n      allow write: if request.auth != null && isUserAdmin(request.auth.uid) &&\n      isValidVoteData(request.resource.data);\n\n      // Function to check if the vote data is valid\n      function isValidVoteData(data) {\n        return data != null &&\n        data.keys().hasAll(['candidateIds']) &&\n        data.candidateIds is list &&\n        isValidCandidateIds(data.candidateIds);\n        // Add additional conditions if needed (e.g., checking if the candidateIds are valid)\n      }\n\n     // Function to check if the candidateIds are valid\nfunction isValidCandidateIds(candidateIds) {\n  // Add your specific logic for validating the list of candidateIds\n  // For example, ensure that each candidateId is a string\n\n  return candidateIds is list &&\n    candidateIds.size() > 0 &&\n    candidateIds.size() == candidateIds.count(id => id is string);\n}\n    }\n\n  }\n}\n"}]}}
[debug] [2024-01-04T22:44:40.001Z] Jan 04, 2024 10:44:40 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:44:40 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2024-01-04T22:44:40.025Z] <<< [apiv2][status] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules 200
[debug] [2024-01-04T22:44:40.025Z] <<< [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":147,"column":50,"currentOffset":6542,"endOffset":6542},"description":"Unexpected '='.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":147,"column":65,"currentOffset":6557,"endOffset":6557},"description":"mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":152,"column":1,"currentOffset":6573,"endOffset":6573},"description":"Unexpected '}'.","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:147:50 - ERROR Unexpected '='. 
[warn] ⚠  firestore.rules:147:65 - ERROR mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'} 
[warn] ⚠  firestore.rules:152:1 - ERROR Unexpected '}'. 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2024-01-04T22:44:40.373Z] >>> [apiv2][query] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules [none]
[debug] [2024-01-04T22:44:40.373Z] >>> [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    // Other rules...\n    function isValidPhoneNumber(phone) {\n      // Define your custom logic to validate the phone number format\n      // For example, you can use regular expressions to check the format\n      // Replace the following regular expression with your own validation logic\n      return phone.matches(\"^\\\\+\\\\([0-9]+\\\\)#\\\\* [0-9]+$\");\n    }\n    function isValidEmail(email) {\n      // Define your custom logic to validate the email address format\n      // Replace the following regular expression with your own validation logic\n      return email.matches(\"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\\\.[a-zA-Z]{2,}$\");\n    }\n\n    function isValidAddress(address) {\n      // Check if the address has the required fields\n      return address is map &&\n      'addressLines' in address &&\n      'postcode' in address &&\n      'locality' in address &&\n      'regionCode' in address &&\n      address.addressLines is list && address.addressLines.size() >= 2 &&\n      address.addressLines[0] is string && \n      address.addressLines[1] is string &&\n      address.addressLines[0].size() >= 1 &&\n      address.addressLines[1].size() >= 1 &&\n      address.addressLines[0].size() <= 255 &&\n      address.addressLines[1].size() <= 255 &&\n      address.postcode is string &&\n      address.locality is string &&\n      address.regionCode is string && address.regionCode.size() == 2;\n    }\n    function isUserAdmin(uid) {\n      return get(/databases/$(database)/documents/users/$(uid)).data.role.hasAny(['admin']);\n    }\n    function isValidDOB(dob) {\n      // Define your custom logic to validate the date of birth format\n      // This is a basic example, you might want to adjust it based on your needs\n      return dob.matches(\"^\\\\d{4}-\\\\d{2}-\\\\d{2}$\");\n    }\n    function isValidFirstName(firstName) {\n      // Define your custom logic to validate the first name\n      // This is a basic example; adjust it based on your needs\n      return firstName is string && firstName.length > 0 && firstName.length < 255;\n    }\n\n    function isValidLastName(lastName) {\n      // Define your custom logic to validate the last name\n      // This is a basic example; adjust it based on your needs\n      return lastName is string && lastName.length > 0 && firstName.length < 255;\n    }\n    // User document rules\n    match /user/{userId} {\n      allow read, write: if request.auth != null && request.auth.uid == userId\n        && request.resource.data.keys().hasAll(['email', 'firstName', 'lastName', 'dob', 'address', 'phone', 'role'])\n        && request.resource.data.email is string // && isValidEmail(request.resource.data.email)\n        && request.resource.data.firstName is string //&& isValidFirstName(firstName)\n        && request.resource.data.lastName is string //&& isValidLastName(lastName)\n        && request.resource.data.dob is string && isValidDOB(request.resource.data.dob)\n        && request.resource.data.address is map && isValidAddress(request.resource.data.address)\n        && request.resource.data.phone is string && isValidPhoneNumber(request.resource.data.phone)\n        && request.resource.data.role is list && request.resource.data.role.size() == 0;\n      allow read, write: if isUserAdmin(request.auth.uid);\n    }\n\n    // Rules for /election/{electionId} path\n    match /election/{electionId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidElectionData(request.resource.data);\n\n      // Function to check if the election data is valid\n      function isValidElectionData(data) {\n        return data != null &&\n        data.keys().hasAll(['startTime', 'endTime', 'title']) &&\n        data.startTime is timestamp &&\n        data.endTime is timestamp &&\n        data.title is string &&\n        // Add additional conditions for start time, end time, and title as needed\n        isValidStartTime(data.startTime) &&\n        isValidEndTime(data.endTime) &&\n        isValidTitle(data.title);\n      }\n\n      // Function to check if the start time is valid (customize as needed)\n      function isValidStartTime(startTime) {\n        // Add your specific logic for validating the start time\n        return startTime != null && startTime.toMillis() > now();\n      }\n\n      // Function to check if the end time is valid (customize as needed)\n      function isValidEndTime(endTime) {\n        // Add your specific logic for validating the end time\n        return endTime != null && endTime.toMillis() > now();\n      }\n\n      // Function to check if the title is valid (customize as needed)\n      function isValidTitle(title) {\n        // Add your specific logic for validating the title\n        return title != null && title.matches(\"^[a-zA-Z0-9 ]+$\"); // Example: Alphanumeric with spaces\n      }\n    }\n\n    // Rules for /election/{electionId}/candidate/{candidateId} path\n    match /election/{electionId}/candidate/{candidateId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidCandidateData(request.resource.data);\n\n      // Function to check if the candidate data is valid\n      function isValidCandidateData(data) {\n        return data != null &&\n        data.keys().hasAll(['name', 'description']) &&\n        data.name is string &&\n        data.description is string;\n      }\n    }\n\n    // Rules for /election/{electionId}/vote/{userId} path\n    match /election/{electionId}/vote/{userId} {\n      allow read: if request.auth != null && request.auth.uid == userId; // Allow the user to read their own vote\n\n      allow write: if request.auth != null && isUserAdmin(request.auth.uid) &&\n      isValidVoteData(request.resource.data);\n\n      // Function to check if the vote data is valid\n      function isValidVoteData(data) {\n        return data != null &&\n        data.keys().hasAll(['candidateIds']) &&\n        data.candidateIds is list &&\n        isValidCandidateIds(data.candidateIds);\n        // Add additional conditions if needed (e.g., checking if the candidateIds are valid)\n      }\n\n     // Function to check if the candidateIds are valid\nfunction isValidCandidateIds(candidateIds) {\n  // Add your specific logic for validating the list of candidateIds\n  // For example, ensure that each candidateId is a string\n\n  return candidateIds is list &&\n    candidateIds.size() > 0 &&\n    candidateIds.size() == candidateIds.count(id => id is string);\n}\n    }\n\n  }\n}\n"}]}}
[debug] [2024-01-04T22:44:40.375Z] Jan 04, 2024 10:44:40 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:44:40 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2024-01-04T22:44:40.400Z] <<< [apiv2][status] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules 200
[debug] [2024-01-04T22:44:40.400Z] <<< [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":147,"column":50,"currentOffset":6542,"endOffset":6542},"description":"Unexpected '='.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":147,"column":65,"currentOffset":6557,"endOffset":6557},"description":"mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":152,"column":1,"currentOffset":6573,"endOffset":6573},"description":"Unexpected '}'.","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:147:50 - ERROR Unexpected '='. 
[warn] ⚠  firestore.rules:147:65 - ERROR mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'} 
[warn] ⚠  firestore.rules:152:1 - ERROR Unexpected '}'. 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2024-01-04T22:44:40.668Z] >>> [apiv2][query] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules [none]
[debug] [2024-01-04T22:44:40.669Z] >>> [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    // Other rules...\n    function isValidPhoneNumber(phone) {\n      // Define your custom logic to validate the phone number format\n      // For example, you can use regular expressions to check the format\n      // Replace the following regular expression with your own validation logic\n      return phone.matches(\"^\\\\+\\\\([0-9]+\\\\)#\\\\* [0-9]+$\");\n    }\n    function isValidEmail(email) {\n      // Define your custom logic to validate the email address format\n      // Replace the following regular expression with your own validation logic\n      return email.matches(\"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\\\.[a-zA-Z]{2,}$\");\n    }\n\n    function isValidAddress(address) {\n      // Check if the address has the required fields\n      return address is map &&\n      'addressLines' in address &&\n      'postcode' in address &&\n      'locality' in address &&\n      'regionCode' in address &&\n      address.addressLines is list && address.addressLines.size() >= 2 &&\n      address.addressLines[0] is string && \n      address.addressLines[1] is string &&\n      address.addressLines[0].size() >= 1 &&\n      address.addressLines[1].size() >= 1 &&\n      address.addressLines[0].size() <= 255 &&\n      address.addressLines[1].size() <= 255 &&\n      address.postcode is string &&\n      address.locality is string &&\n      address.regionCode is string && address.regionCode.size() == 2;\n    }\n    function isUserAdmin(uid) {\n      return get(/databases/$(database)/documents/users/$(uid)).data.role.hasAny(['admin']);\n    }\n    function isValidDOB(dob) {\n      // Define your custom logic to validate the date of birth format\n      // This is a basic example, you might want to adjust it based on your needs\n      return dob.matches(\"^\\\\d{4}-\\\\d{2}-\\\\d{2}$\");\n    }\n    function isValidFirstName(firstName) {\n      // Define your custom logic to validate the first name\n      // This is a basic example; adjust it based on your needs\n      return firstName is string && firstName.length > 0 && firstName.length < 255;\n    }\n\n    function isValidLastName(lastName) {\n      // Define your custom logic to validate the last name\n      // This is a basic example; adjust it based on your needs\n      return lastName is string && lastName.length > 0 && firstName.length < 255;\n    }\n    // User document rules\n    match /user/{userId} {\n      allow read, write: if request.auth != null && request.auth.uid == userId\n        && request.resource.data.keys().hasAll(['email', 'firstName', 'lastName', 'dob', 'address', 'phone', 'role'])\n        && request.resource.data.email is string // && isValidEmail(request.resource.data.email)\n        && request.resource.data.firstName is string //&& isValidFirstName(firstName)\n        && request.resource.data.lastName is string //&& isValidLastName(lastName)\n        && request.resource.data.dob is string && isValidDOB(request.resource.data.dob)\n        && request.resource.data.address is map && isValidAddress(request.resource.data.address)\n        && request.resource.data.phone is string && isValidPhoneNumber(request.resource.data.phone)\n        && request.resource.data.role is list && request.resource.data.role.size() == 0;\n      allow read, write: if isUserAdmin(request.auth.uid);\n    }\n\n    // Rules for /election/{electionId} path\n    match /election/{electionId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidElectionData(request.resource.data);\n\n      // Function to check if the election data is valid\n      function isValidElectionData(data) {\n        return data != null &&\n        data.keys().hasAll(['startTime', 'endTime', 'title']) &&\n        data.startTime is timestamp &&\n        data.endTime is timestamp &&\n        data.title is string &&\n        // Add additional conditions for start time, end time, and title as needed\n        isValidStartTime(data.startTime) &&\n        isValidEndTime(data.endTime) &&\n        isValidTitle(data.title);\n      }\n\n      // Function to check if the start time is valid (customize as needed)\n      function isValidStartTime(startTime) {\n        // Add your specific logic for validating the start time\n        return startTime != null && startTime.toMillis() > now();\n      }\n\n      // Function to check if the end time is valid (customize as needed)\n      function isValidEndTime(endTime) {\n        // Add your specific logic for validating the end time\n        return endTime != null && endTime.toMillis() > now();\n      }\n\n      // Function to check if the title is valid (customize as needed)\n      function isValidTitle(title) {\n        // Add your specific logic for validating the title\n        return title != null && title.matches(\"^[a-zA-Z0-9 ]+$\"); // Example: Alphanumeric with spaces\n      }\n    }\n\n    // Rules for /election/{electionId}/candidate/{candidateId} path\n    match /election/{electionId}/candidate/{candidateId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidCandidateData(request.resource.data);\n\n      // Function to check if the candidate data is valid\n      function isValidCandidateData(data) {\n        return data != null &&\n        data.keys().hasAll(['name', 'description']) &&\n        data.name is string &&\n        data.description is string;\n      }\n    }\n\n    // Rules for /election/{electionId}/vote/{userId} path\n    match /election/{electionId}/vote/{userId} {\n      allow read: if request.auth != null && request.auth.uid == userId; // Allow the user to read their own vote\n\n      allow write: if request.auth != null && isUserAdmin(request.auth.uid) &&\n      isValidVoteData(request.resource.data);\n\n      // Function to check if the vote data is valid\n      function isValidVoteData(data) {\n        return data != null &&\n        data.keys().hasAll(['candidateIds']) &&\n        data.candidateIds is list &&\n        isValidCandidateIds(data.candidateIds);\n        // Add additional conditions if needed (e.g., checking if the candidateIds are valid)\n      }\n\n     // Function to check if the candidateIds are valid\nfunction isValidCandidateIds(candidateIds) {\n  // Add your specific logic for validating the list of candidateIds\n  // For example, ensure that each candidateId is a string\n\n  return candidateIds is list &&\n    candidateIds.size() > 0 &&\n    candidateIds.size() == candidateIds.count(id => id is string);\n}\n    }\n\n  }\n}\n"}]}}
[debug] [2024-01-04T22:44:40.676Z] Jan 04, 2024 10:44:40 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:44:40 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2024-01-04T22:44:40.723Z] <<< [apiv2][status] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules 200
[debug] [2024-01-04T22:44:40.724Z] <<< [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":147,"column":50,"currentOffset":6542,"endOffset":6542},"description":"Unexpected '='.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":147,"column":65,"currentOffset":6557,"endOffset":6557},"description":"mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":152,"column":1,"currentOffset":6573,"endOffset":6573},"description":"Unexpected '}'.","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:147:50 - ERROR Unexpected '='. 
[warn] ⚠  firestore.rules:147:65 - ERROR mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'} 
[warn] ⚠  firestore.rules:152:1 - ERROR Unexpected '}'. 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2024-01-04T22:44:43.915Z] >>> [apiv2][query] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules [none]
[debug] [2024-01-04T22:44:43.915Z] >>> [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    // Other rules...\n    function isValidPhoneNumber(phone) {\n      // Define your custom logic to validate the phone number format\n      // For example, you can use regular expressions to check the format\n      // Replace the following regular expression with your own validation logic\n      return phone.matches(\"^\\\\+\\\\([0-9]+\\\\)#\\\\* [0-9]+$\");\n    }\n    function isValidEmail(email) {\n      // Define your custom logic to validate the email address format\n      // Replace the following regular expression with your own validation logic\n      return email.matches(\"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\\\.[a-zA-Z]{2,}$\");\n    }\n\n    function isValidAddress(address) {\n      // Check if the address has the required fields\n      return address is map &&\n      'addressLines' in address &&\n      'postcode' in address &&\n      'locality' in address &&\n      'regionCode' in address &&\n      address.addressLines is list && address.addressLines.size() >= 2 &&\n      address.addressLines[0] is string && \n      address.addressLines[1] is string &&\n      address.addressLines[0].size() >= 1 &&\n      address.addressLines[1].size() >= 1 &&\n      address.addressLines[0].size() <= 255 &&\n      address.addressLines[1].size() <= 255 &&\n      address.postcode is string &&\n      address.locality is string &&\n      address.regionCode is string && address.regionCode.size() == 2;\n    }\n    function isUserAdmin(uid) {\n      return get(/databases/$(database)/documents/users/$(uid)).data.role.hasAny(['admin']);\n    }\n    function isValidDOB(dob) {\n      // Define your custom logic to validate the date of birth format\n      // This is a basic example, you might want to adjust it based on your needs\n      return dob.matches(\"^\\\\d{4}-\\\\d{2}-\\\\d{2}$\");\n    }\n    function isValidFirstName(firstName) {\n      // Define your custom logic to validate the first name\n      // This is a basic example; adjust it based on your needs\n      return firstName is string && firstName.length > 0 && firstName.length < 255;\n    }\n\n    function isValidLastName(lastName) {\n      // Define your custom logic to validate the last name\n      // This is a basic example; adjust it based on your needs\n      return lastName is string && lastName.length > 0 && firstName.length < 255;\n    }\n    // User document rules\n    match /user/{userId} {\n      allow read, write: if request.auth != null && request.auth.uid == userId\n        && request.resource.data.keys().hasAll(['email', 'firstName', 'lastName', 'dob', 'address', 'phone', 'role'])\n        && request.resource.data.email is string // && isValidEmail(request.resource.data.email)\n        && request.resource.data.firstName is string //&& isValidFirstName(firstName)\n        && request.resource.data.lastName is string //&& isValidLastName(lastName)\n        && request.resource.data.dob is string && isValidDOB(request.resource.data.dob)\n        && request.resource.data.address is map && isValidAddress(request.resource.data.address)\n        && request.resource.data.phone is string && isValidPhoneNumber(request.resource.data.phone)\n        && request.resource.data.role is list && request.resource.data.role.size() == 0;\n      allow read, write: if isUserAdmin(request.auth.uid);\n    }\n\n    // Rules for /election/{electionId} path\n    match /election/{electionId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidElectionData(request.resource.data);\n\n      // Function to check if the election data is valid\n      function isValidElectionData(data) {\n        return data != null &&\n        data.keys().hasAll(['startTime', 'endTime', 'title']) &&\n        data.startTime is timestamp &&\n        data.endTime is timestamp &&\n        data.title is string &&\n        // Add additional conditions for start time, end time, and title as needed\n        isValidStartTime(data.startTime) &&\n        isValidEndTime(data.endTime) &&\n        isValidTitle(data.title);\n      }\n\n      // Function to check if the start time is valid (customize as needed)\n      function isValidStartTime(startTime) {\n        // Add your specific logic for validating the start time\n        return startTime != null && startTime.toMillis() > now();\n      }\n\n      // Function to check if the end time is valid (customize as needed)\n      function isValidEndTime(endTime) {\n        // Add your specific logic for validating the end time\n        return endTime != null && endTime.toMillis() > now();\n      }\n\n      // Function to check if the title is valid (customize as needed)\n      function isValidTitle(title) {\n        // Add your specific logic for validating the title\n        return title != null && title.matches(\"^[a-zA-Z0-9 ]+$\"); // Example: Alphanumeric with spaces\n      }\n    }\n\n    // Rules for /election/{electionId}/candidate/{candidateId} path\n    match /election/{electionId}/candidate/{candidateId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidCandidateData(request.resource.data);\n\n      // Function to check if the candidate data is valid\n      function isValidCandidateData(data) {\n        return data != null &&\n        data.keys().hasAll(['name', 'description']) &&\n        data.name is string &&\n        data.description is string;\n      }\n    }\n\n    // Rules for /election/{electionId}/vote/{userId} path\n    match /election/{electionId}/vote/{userId} {\n      allow read: if request.auth != null && request.auth.uid == userId; // Allow the user to read their own vote\n\n      allow write: if request.auth != null && isUserAdmin(request.auth.uid) &&\n      isValidVoteData(request.resource.data);\n\n      // Function to check if the vote data is valid\n      function isValidVoteData(data) {\n        return data != null &&\n        data.keys().hasAll(['candidateIds']) &&\n        data.candidateIds is list &&\n        isValidCandidateIds(data.candidateIds);\n        // Add additional conditions if needed (e.g., checking if the candidateIds are valid)\n      }\n\n      // Function to check if the candidateIds are valid\n      function isValidCandidateIds(candidateIds) {\n        // Add your specific logic for validating the list of candidateIds\n        // For example, ensure that each candidateId is a string\n\n        return candidateIds is list &&\n        candidateIds.size() > 0 &&\n        candidateIds.size() == candidateIds.count(id => id is string);\n      }\n    }\n\n  }\n}\n"}]}}
[debug] [2024-01-04T22:44:43.925Z] Jan 04, 2024 10:44:43 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:44:43 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2024-01-04T22:44:43.974Z] <<< [apiv2][status] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules 200
[debug] [2024-01-04T22:44:43.974Z] <<< [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":147,"column":54,"currentOffset":6575,"endOffset":6575},"description":"Unexpected '='.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":147,"column":69,"currentOffset":6590,"endOffset":6590},"description":"mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":152,"column":1,"currentOffset":6612,"endOffset":6612},"description":"Unexpected '}'.","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:147:54 - ERROR Unexpected '='. 
[warn] ⚠  firestore.rules:147:69 - ERROR mismatched input ')' expecting {'&&', '==', '>', '>=', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'} 
[warn] ⚠  firestore.rules:152:1 - ERROR Unexpected '}'. 
[info] ✔  firestore: Rules updated. 
[debug] [2024-01-04T22:45:20.171Z] Jan 04, 2024 10:45:20 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:45:20 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[info] i  firestore: Change detected, updating rules... 
[debug] [2024-01-04T22:45:41.027Z] >>> [apiv2][query] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules [none]
[debug] [2024-01-04T22:45:41.028Z] >>> [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    // Other rules...\n    function isValidPhoneNumber(phone) {\n      // Define your custom logic to validate the phone number format\n      // For example, you can use regular expressions to check the format\n      // Replace the following regular expression with your own validation logic\n      return phone.matches(\"^\\\\+\\\\([0-9]+\\\\)#\\\\* [0-9]+$\");\n    }\n    function isValidEmail(email) {\n      // Define your custom logic to validate the email address format\n      // Replace the following regular expression with your own validation logic\n      return email.matches(\"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\\\.[a-zA-Z]{2,}$\");\n    }\n\n    function isValidAddress(address) {\n      // Check if the address has the required fields\n      return address is map &&\n      'addressLines' in address &&\n      'postcode' in address &&\n      'locality' in address &&\n      'regionCode' in address &&\n      address.addressLines is list && address.addressLines.size() >= 2 &&\n      address.addressLines[0] is string && \n      address.addressLines[1] is string &&\n      address.addressLines[0].size() >= 1 &&\n      address.addressLines[1].size() >= 1 &&\n      address.addressLines[0].size() <= 255 &&\n      address.addressLines[1].size() <= 255 &&\n      address.postcode is string &&\n      address.locality is string &&\n      address.regionCode is string && address.regionCode.size() == 2;\n    }\n    function isUserAdmin(uid) {\n      return get(/databases/$(database)/documents/users/$(uid)).data.role.hasAny(['admin']);\n    }\n    function isValidDOB(dob) {\n      // Define your custom logic to validate the date of birth format\n      // This is a basic example, you might want to adjust it based on your needs\n      return dob.matches(\"^\\\\d{4}-\\\\d{2}-\\\\d{2}$\");\n    }\n    function isValidFirstName(firstName) {\n      // Define your custom logic to validate the first name\n      // This is a basic example; adjust it based on your needs\n      return firstName is string && firstName.length > 0 && firstName.length < 255;\n    }\n\n    function isValidLastName(lastName) {\n      // Define your custom logic to validate the last name\n      // This is a basic example; adjust it based on your needs\n      return lastName is string && lastName.length > 0 && firstName.length < 255;\n    }\n    // User document rules\n    match /user/{userId} {\n      allow read, write: if request.auth != null && request.auth.uid == userId\n        && request.resource.data.keys().hasAll(['email', 'firstName', 'lastName', 'dob', 'address', 'phone', 'role'])\n        && request.resource.data.email is string // && isValidEmail(request.resource.data.email)\n        && request.resource.data.firstName is string //&& isValidFirstName(firstName)\n        && request.resource.data.lastName is string //&& isValidLastName(lastName)\n        && request.resource.data.dob is string && isValidDOB(request.resource.data.dob)\n        && request.resource.data.address is map && isValidAddress(request.resource.data.address)\n        && request.resource.data.phone is string && isValidPhoneNumber(request.resource.data.phone)\n        && request.resource.data.role is list && request.resource.data.role.size() == 0;\n      allow read, write: if isUserAdmin(request.auth.uid);\n    }\n\n    // Rules for /election/{electionId} path\n    match /election/{electionId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidElectionData(request.resource.data);\n\n      // Function to check if the election data is valid\n      function isValidElectionData(data) {\n        return data != null &&\n        data.keys().hasAll(['startTime', 'endTime', 'title']) &&\n        data.startTime is timestamp &&\n        data.endTime is timestamp &&\n        data.title is string &&\n        // Add additional conditions for start time, end time, and title as needed\n        isValidStartTime(data.startTime) &&\n        isValidEndTime(data.endTime) &&\n        isValidTitle(data.title);\n      }\n\n      // Function to check if the start time is valid (customize as needed)\n      function isValidStartTime(startTime) {\n        // Add your specific logic for validating the start time\n        return startTime != null && startTime.toMillis() > now();\n      }\n\n      // Function to check if the end time is valid (customize as needed)\n      function isValidEndTime(endTime) {\n        // Add your specific logic for validating the end time\n        return endTime != null && endTime.toMillis() > now();\n      }\n\n      // Function to check if the title is valid (customize as needed)\n      function isValidTitle(title) {\n        // Add your specific logic for validating the title\n        return title != null && title.matches(\"^[a-zA-Z0-9 ]+$\"); // Example: Alphanumeric with spaces\n      }\n    }\n\n    // Rules for /election/{electionId}/candidate/{candidateId} path\n    match /election/{electionId}/candidate/{candidateId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidCandidateData(request.resource.data);\n\n      // Function to check if the candidate data is valid\n      function isValidCandidateData(data) {\n        return data != null &&\n        data.keys().hasAll(['name', 'description']) &&\n        data.name is string &&\n        data.description is string;\n      }\n    }\n\n    // Rules for /election/{electionId}/vote/{userId} path\n    match /election/{electionId}/vote/{userId} {\n      allow read: if request.auth != null && request.auth.uid == userId; // Allow the user to read their own vote\n\n      allow write: if request.auth != null && isUserAdmin(request.auth.uid) &&\n      isValidVoteData(request.resource.data);\n\n      // Function to check if the vote data is valid\n      function isValidVoteData(data) {\n        return data != null &&\n        data.keys().hasAll(['candidateIds']) &&\n        data.candidateIds is list &&\n        isValidCandidateIds(data.candidateIds);\n        // Add additional conditions if needed (e.g., checking if the candidateIds are valid)\n      }\n\n      // Function to check if the candidateIds are valid\n      function isValidCandidateIds(candidateIds) {\n        // Add your specific logic for validating the list of candidateIds\n        // For example, ensure that each candidateId is a string\n        return candidateIds is list &&\n        candidateIds.size() > 0 &&\n        candidateIds.size() == candidateIds.each(function(candidateId) {\n          return candidateId is string;\n        }).size();\n        \n      }\n    }\n  }\n}\n"}]}}
[debug] [2024-01-04T22:45:41.034Z] Jan 04, 2024 10:45:41 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:45:41 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2024-01-04T22:45:41.084Z] <<< [apiv2][status] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules 200
[debug] [2024-01-04T22:45:41.084Z] <<< [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":146,"column":49,"currentOffset":6569,"endOffset":6569},"description":"mismatched input '(' expecting {'&&', '.', '==', '>', '>=', '[', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'}","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":146,"column":58,"currentOffset":6578,"endOffset":6578},"description":"Missing 'function' id","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":148,"column":10,"currentOffset":6643,"endOffset":6643},"description":"Unexpected ')'.","severity":"ERROR"},{"sourcePosition":{"fileName":"security.rules","line":153,"column":1,"currentOffset":6680,"endOffset":6680},"description":"Unexpected '}'.","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:146:49 - ERROR mismatched input '(' expecting {'&&', '.', '==', '>', '>=', '[', '<', '<=', '-', '%', '!=', '||', '+', '}', ';', '/', '*', '?', 'in', 'is'} 
[warn] ⚠  firestore.rules:146:58 - ERROR Missing 'function' id 
[warn] ⚠  firestore.rules:148:10 - ERROR Unexpected ')'. 
[warn] ⚠  firestore.rules:153:1 - ERROR Unexpected '}'. 
[info] ✔  firestore: Rules updated. 
[debug] [2024-01-04T22:46:06.196Z] Jan 04, 2024 10:46:06 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:46:06 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[info] i  firestore: Change detected, updating rules... 
[debug] [2024-01-04T22:46:06.918Z] >>> [apiv2][query] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules [none]
[debug] [2024-01-04T22:46:06.918Z] >>> [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    // Other rules...\n    function isValidPhoneNumber(phone) {\n      // Define your custom logic to validate the phone number format\n      // For example, you can use regular expressions to check the format\n      // Replace the following regular expression with your own validation logic\n      return phone.matches(\"^\\\\+\\\\([0-9]+\\\\)#\\\\* [0-9]+$\");\n    }\n    function isValidEmail(email) {\n      // Define your custom logic to validate the email address format\n      // Replace the following regular expression with your own validation logic\n      return email.matches(\"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\\\.[a-zA-Z]{2,}$\");\n    }\n\n    function isValidAddress(address) {\n      // Check if the address has the required fields\n      return address is map &&\n      'addressLines' in address &&\n      'postcode' in address &&\n      'locality' in address &&\n      'regionCode' in address &&\n      address.addressLines is list && address.addressLines.size() >= 2 &&\n      address.addressLines[0] is string && \n      address.addressLines[1] is string &&\n      address.addressLines[0].size() >= 1 &&\n      address.addressLines[1].size() >= 1 &&\n      address.addressLines[0].size() <= 255 &&\n      address.addressLines[1].size() <= 255 &&\n      address.postcode is string &&\n      address.locality is string &&\n      address.regionCode is string && address.regionCode.size() == 2;\n    }\n    function isUserAdmin(uid) {\n      return get(/databases/$(database)/documents/users/$(uid)).data.role.hasAny(['admin']);\n    }\n    function isValidDOB(dob) {\n      // Define your custom logic to validate the date of birth format\n      // This is a basic example, you might want to adjust it based on your needs\n      return dob.matches(\"^\\\\d{4}-\\\\d{2}-\\\\d{2}$\");\n    }\n    function isValidFirstName(firstName) {\n      // Define your custom logic to validate the first name\n      // This is a basic example; adjust it based on your needs\n      return firstName is string && firstName.length > 0 && firstName.length < 255;\n    }\n\n    function isValidLastName(lastName) {\n      // Define your custom logic to validate the last name\n      // This is a basic example; adjust it based on your needs\n      return lastName is string && lastName.length > 0 && firstName.length < 255;\n    }\n    // User document rules\n    match /user/{userId} {\n      allow read, write: if request.auth != null && request.auth.uid == userId\n        && request.resource.data.keys().hasAll(['email', 'firstName', 'lastName', 'dob', 'address', 'phone', 'role'])\n        && request.resource.data.email is string // && isValidEmail(request.resource.data.email)\n        && request.resource.data.firstName is string //&& isValidFirstName(firstName)\n        && request.resource.data.lastName is string //&& isValidLastName(lastName)\n        && request.resource.data.dob is string && isValidDOB(request.resource.data.dob)\n        && request.resource.data.address is map && isValidAddress(request.resource.data.address)\n        && request.resource.data.phone is string && isValidPhoneNumber(request.resource.data.phone)\n        && request.resource.data.role is list && request.resource.data.role.size() == 0;\n      allow read, write: if isUserAdmin(request.auth.uid);\n    }\n\n    // Rules for /election/{electionId} path\n    match /election/{electionId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidElectionData(request.resource.data);\n\n      // Function to check if the election data is valid\n      function isValidElectionData(data) {\n        return data != null &&\n        data.keys().hasAll(['startTime', 'endTime', 'title']) &&\n        data.startTime is timestamp &&\n        data.endTime is timestamp &&\n        data.title is string &&\n        // Add additional conditions for start time, end time, and title as needed\n        isValidStartTime(data.startTime) &&\n        isValidEndTime(data.endTime) &&\n        isValidTitle(data.title);\n      }\n\n      // Function to check if the start time is valid (customize as needed)\n      function isValidStartTime(startTime) {\n        // Add your specific logic for validating the start time\n        return startTime != null && startTime.toMillis() > now();\n      }\n\n      // Function to check if the end time is valid (customize as needed)\n      function isValidEndTime(endTime) {\n        // Add your specific logic for validating the end time\n        return endTime != null && endTime.toMillis() > now();\n      }\n\n      // Function to check if the title is valid (customize as needed)\n      function isValidTitle(title) {\n        // Add your specific logic for validating the title\n        return title != null && title.matches(\"^[a-zA-Z0-9 ]+$\"); // Example: Alphanumeric with spaces\n      }\n    }\n\n    // Rules for /election/{electionId}/candidate/{candidateId} path\n    match /election/{electionId}/candidate/{candidateId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidCandidateData(request.resource.data);\n\n      // Function to check if the candidate data is valid\n      function isValidCandidateData(data) {\n        return data != null &&\n        data.keys().hasAll(['name', 'description']) &&\n        data.name is string &&\n        data.description is string;\n      }\n    }\n\n    // Rules for /election/{electionId}/vote/{userId} path\n    match /election/{electionId}/vote/{userId} {\n      allow read: if request.auth != null && request.auth.uid == userId; // Allow the user to read their own vote\n\n      allow write: if request.auth != null && isUserAdmin(request.auth.uid) &&\n      isValidVoteData(request.resource.data);\n\n      // Function to check if the vote data is valid\n      function isValidVoteData(data) {\n        return data != null &&\n        data.keys().hasAll(['candidateIds']) &&\n        data.candidateIds is list &&\n        isValidCandidateIds(data.candidateIds);\n        // Add additional conditions if needed (e.g., checking if the candidateIds are valid)\n      }\n\n      // Function to check if the candidateIds are valid\n      function isValidCandidateIds(candidateIds) {\n        // Add your specific logic for validating the list of candidateIds\n        // For example, ensure that each candidateId is a string\n        return candidateIds is list &&\n        candidateIds.size() > 0 &&\n        \n      }\n    }\n  }\n}\n"}]}}
[debug] [2024-01-04T22:46:06.949Z] Jan 04, 2024 10:46:06 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:46:06 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2024-01-04T22:46:06.967Z] <<< [apiv2][status] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules 200
[debug] [2024-01-04T22:46:06.968Z] <<< [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":147,"column":7,"currentOffset":6536,"endOffset":6536},"description":"mismatched input '}' expecting {'--', '++', '{', '[', '(', '-', '!', '/', 'false', 'null', 'true', PATH_SEGMENT, IDENTIFIER, NUM_INT, NUM_FLOAT, UNPAIRED_DOUBLE_QUOTE, UNPAIRED_SINGLE_QUOTE, STRING, BYTES}","severity":"ERROR"}]}
[warn] ⚠  firestore.rules:147:7 - ERROR mismatched input '}' expecting {'--', '++', '{', '[', '(', '-', '!', '/', 'false', 'null', 'true', PATH_SEGMENT, IDENTIFIER, NUM_INT, NUM_FLOAT, UNPAIRED_DOUBLE_QUOTE, UNPAIRED_SINGLE_QUOTE, STRING, BYTES} 
[info] ✔  firestore: Rules updated. 
[info] i  firestore: Change detected, updating rules... 
[debug] [2024-01-04T22:46:16.357Z] >>> [apiv2][query] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules [none]
[debug] [2024-01-04T22:46:16.357Z] >>> [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"ignore_errors":true,"rules":{"files":[{"name":"security.rules","content":"\nrules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    // Other rules...\n    function isValidPhoneNumber(phone) {\n      // Define your custom logic to validate the phone number format\n      // For example, you can use regular expressions to check the format\n      // Replace the following regular expression with your own validation logic\n      return phone.matches(\"^\\\\+\\\\([0-9]+\\\\)#\\\\* [0-9]+$\");\n    }\n    function isValidEmail(email) {\n      // Define your custom logic to validate the email address format\n      // Replace the following regular expression with your own validation logic\n      return email.matches(\"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\\\.[a-zA-Z]{2,}$\");\n    }\n\n    function isValidAddress(address) {\n      // Check if the address has the required fields\n      return address is map &&\n      'addressLines' in address &&\n      'postcode' in address &&\n      'locality' in address &&\n      'regionCode' in address &&\n      address.addressLines is list && address.addressLines.size() >= 2 &&\n      address.addressLines[0] is string && \n      address.addressLines[1] is string &&\n      address.addressLines[0].size() >= 1 &&\n      address.addressLines[1].size() >= 1 &&\n      address.addressLines[0].size() <= 255 &&\n      address.addressLines[1].size() <= 255 &&\n      address.postcode is string &&\n      address.locality is string &&\n      address.regionCode is string && address.regionCode.size() == 2;\n    }\n    function isUserAdmin(uid) {\n      return get(/databases/$(database)/documents/users/$(uid)).data.role.hasAny(['admin']);\n    }\n    function isValidDOB(dob) {\n      // Define your custom logic to validate the date of birth format\n      // This is a basic example, you might want to adjust it based on your needs\n      return dob.matches(\"^\\\\d{4}-\\\\d{2}-\\\\d{2}$\");\n    }\n    function isValidFirstName(firstName) {\n      // Define your custom logic to validate the first name\n      // This is a basic example; adjust it based on your needs\n      return firstName is string && firstName.length > 0 && firstName.length < 255;\n    }\n\n    function isValidLastName(lastName) {\n      // Define your custom logic to validate the last name\n      // This is a basic example; adjust it based on your needs\n      return lastName is string && lastName.length > 0 && firstName.length < 255;\n    }\n    // User document rules\n    match /user/{userId} {\n      allow read, write: if request.auth != null && request.auth.uid == userId\n        && request.resource.data.keys().hasAll(['email', 'firstName', 'lastName', 'dob', 'address', 'phone', 'role'])\n        && request.resource.data.email is string // && isValidEmail(request.resource.data.email)\n        && request.resource.data.firstName is string //&& isValidFirstName(firstName)\n        && request.resource.data.lastName is string //&& isValidLastName(lastName)\n        && request.resource.data.dob is string && isValidDOB(request.resource.data.dob)\n        && request.resource.data.address is map && isValidAddress(request.resource.data.address)\n        && request.resource.data.phone is string && isValidPhoneNumber(request.resource.data.phone)\n        && request.resource.data.role is list && request.resource.data.role.size() == 0;\n      allow read, write: if isUserAdmin(request.auth.uid);\n    }\n\n    // Rules for /election/{electionId} path\n    match /election/{electionId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidElectionData(request.resource.data);\n\n      // Function to check if the election data is valid\n      function isValidElectionData(data) {\n        return data != null &&\n        data.keys().hasAll(['startTime', 'endTime', 'title']) &&\n        data.startTime is timestamp &&\n        data.endTime is timestamp &&\n        data.title is string &&\n        // Add additional conditions for start time, end time, and title as needed\n        isValidStartTime(data.startTime) &&\n        isValidEndTime(data.endTime) &&\n        isValidTitle(data.title);\n      }\n\n      // Function to check if the start time is valid (customize as needed)\n      function isValidStartTime(startTime) {\n        // Add your specific logic for validating the start time\n        return startTime != null && startTime.toMillis() > now();\n      }\n\n      // Function to check if the end time is valid (customize as needed)\n      function isValidEndTime(endTime) {\n        // Add your specific logic for validating the end time\n        return endTime != null && endTime.toMillis() > now();\n      }\n\n      // Function to check if the title is valid (customize as needed)\n      function isValidTitle(title) {\n        // Add your specific logic for validating the title\n        return title != null && title.matches(\"^[a-zA-Z0-9 ]+$\"); // Example: Alphanumeric with spaces\n      }\n    }\n\n    // Rules for /election/{electionId}/candidate/{candidateId} path\n    match /election/{electionId}/candidate/{candidateId} {\n      allow read: if request.auth != null; // Add your specific conditions for read\n\n      allow read, write: if isUserAdmin(request.auth.uid) &&\n      isValidCandidateData(request.resource.data);\n\n      // Function to check if the candidate data is valid\n      function isValidCandidateData(data) {\n        return data != null &&\n        data.keys().hasAll(['name', 'description']) &&\n        data.name is string &&\n        data.description is string;\n      }\n    }\n\n    // Rules for /election/{electionId}/vote/{userId} path\n    match /election/{electionId}/vote/{userId} {\n      allow read: if request.auth != null && request.auth.uid == userId; // Allow the user to read their own vote\n\n      allow write: if request.auth != null && isUserAdmin(request.auth.uid) &&\n      isValidVoteData(request.resource.data);\n\n      // Function to check if the vote data is valid\n      function isValidVoteData(data) {\n        return data != null &&\n        data.keys().hasAll(['candidateIds']) &&\n        data.candidateIds is list &&\n        isValidCandidateIds(data.candidateIds);\n        // Add additional conditions if needed (e.g., checking if the candidateIds are valid)\n      }\n\n      // Function to check if the candidateIds are valid\n      function isValidCandidateIds(candidateIds) {\n        // Add your specific logic for validating the list of candidateIds\n        // For example, ensure that each candidateId is a string\n        return candidateIds is list &&\n        candidateIds.size() > 0;\n        \n      }\n    }\n  }\n}\n"}]}}
[debug] [2024-01-04T22:46:16.362Z] Jan 04, 2024 10:46:16 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead
INFO: Detected non-HTTP/2 connection.
 {"metadata":{"emulator":{"name":"firestore"},"message":"Jan 04, 2024 10:46:16 PM io.gapi.emulators.netty.HttpVersionRoutingHandler channelRead\nINFO: Detected non-HTTP/2 connection.\n"}}
[debug] [2024-01-04T22:46:16.532Z] <<< [apiv2][status] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules 200
[debug] [2024-01-04T22:46:16.532Z] <<< [apiv2][body] PUT http://127.0.0.1:8081/emulator/v1/projects/ptate-df901:securityRules {"issues":[{"sourcePosition":{"fileName":"security.rules","line":12,"column":14,"currentOffset":457,"endOffset":468},"description":"Unused function: isValidEmail.","severity":"WARNING"},{"sourcePosition":{"fileName":"security.rules","line":44,"column":14,"currentOffset":1852,"endOffset":1867},"description":"Unused function: isValidFirstName.","severity":"WARNING"},{"sourcePosition":{"fileName":"security.rules","line":50,"column":14,"currentOffset":2111,"endOffset":2125},"description":"Unused function: isValidLastName.","severity":"WARNING"},{"sourcePosition":{"fileName":"security.rules","line":53,"column":59,"currentOffset":2321,"endOffset":2329},"description":"Invalid variable name: firstName.","severity":"WARNING"},{"sourcePosition":{"fileName":"security.rules","line":92,"column":60,"currentOffset":4344,"endOffset":4346},"description":"Invalid function name: now.","severity":"WARNING"},{"sourcePosition":{"fileName":"security.rules","line":98,"column":56,"currentOffset":4593,"endOffset":4595},"description":"Invalid function name: now.","severity":"WARNING"}]}
[warn] ⚠  firestore.rules:12:14 - WARNING Unused function: isValidEmail. 
[warn] ⚠  firestore.rules:44:14 - WARNING Unused function: isValidFirstName. 
[warn] ⚠  firestore.rules:50:14 - WARNING Unused function: isValidLastName. 
[warn] ⚠  firestore.rules:53:59 - WARNING Invalid variable name: firstName. 
[warn] ⚠  firestore.rules:92:60 - WARNING Invalid function name: now. 
[warn] ⚠  firestore.rules:98:56 - WARNING Invalid function name: now. 
[info] ✔  firestore: Rules updated. 
